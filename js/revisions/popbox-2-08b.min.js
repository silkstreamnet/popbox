(function(e){function m(a,b){return"undefined"!==typeof a?a:b}function r(a,b){b=m(b,!1);return!isNaN(a-0)&&null!=a&&""!=a&&(!b||0<a)}function l(a,b){b=m(b,!1);return"string"===typeof a&&null!=a&&(!b||""!=a)}function w(a,b){if(a.properties.animating)switch(a.properties.animating=!1,b){case "close":a.container.remove();a.container=!1;a.properties.isopen=!1;a.popup=!1;a.shadow=!1;e("body").css({overflow:a.properties.bodyOverflow,"margin-right":a.properties.bodyMarginRight});e(document).off("scroll.popbox touchmove.popbox mousewheel.popbox");break;case "open":a.properties.isopen=!0}}function n(a,b){var a=m(a,!1),b=m(b,!1),d=!0;if(a&&a.popup){var k=a.popup.find("img");0<k.length&&k.each(function(a,b){!b.complete&&(4!==b.readyState&&"complete"!==b.readyState)&&(d=!1)})}"gallery"==a.settings.mode&&(d?(a.content_area.css({visibility:"",height:"",overflow:""}),a.gallery_loading&&a.gallery_loading.hide()):(a.content_area.css({visibility:"hidden",height:"0",overflow:"hidden"}),a.gallery_loading&&a.gallery_loading.show()));d&&b&&x(a);return d}function y(a){var b=e("body"),a=a.container.clone().stop(!0,!0).addClass("popbox-rsc-clone").css({display:"block",visibility:"hidden","z-index":"-1",overflow:"hidden"});a.find("iframe").attr("src","");a.appendTo(b);b=b.find(".popbox-rsc-clone");return{container:b,popup:b.find(".popbox-popup").eq(0),content:b.find(".popbox-content").eq(0)}}function x(a,b){b=m(b,!1);if((a=m(a,!1))&&a.popup){var d=a.settings,k=a.popup,h=a.container,s=a.content_area;k.stop(!0,!1);var i=0,g=0,c=0,j=0,e=0,f=0,p=0,l=h.outerWidth(!1),n=h.outerHeight(!1),j=c=g=0,t=!1,c=!1;if(d.autoScale)c=y(a),c.popup.css({height:"auto",width:"auto",top:"auto",left:"auto"}),c.content.attr("style",""),c.content.find("img").css({"max-width":"none",height:"auto",display:"block"}),c.content.find("iframe").css({"max-height":"none","max-width":"none"}),j=c.popup.width(),e=c.popup.height(),f=c.popup.outerWidth(!1)-j,p=c.popup.outerHeight(!1)-e,c&&c.container&&c.container.remove(),g=0.8*l-f,c=0.8*n-p,e>c||j>g?e/j>c/g?(g=c,i=j*(c/e)):(i=g,g=e*(g/j)):(i=j,g=e),k.find("img").css({"max-width":"100%",height:"auto",display:"block"}),k.find("iframe").css({"max-height":"100%","max-width":"100%"});else{g=0.8*l;c=0.8*n;f=k.outerWidth(!1)-k.width();p=k.outerHeight(!1)-k.height();i=g-f;g=c-p;r(d.width)?i=d.width:r(d.maxwidth)&&i>d.maxwidth&&(i=d.maxwidth);c=y(a);c.popup.css({height:"auto",width:i,top:"0",left:"0"});c.content.attr("style","");r(d.height)?g=d.height:r(d.maxheight)&&g>d.maxheight?g=d.maxheight:d.innerOverflow||(g=c.popup.height());0==parseInt(c.content.css("margin-top"))&&c.content.css({"margin-top":"-1px",top:"1px"});var j=c.content.outerHeight(!0),e=j-c.content.height(),q=parseInt(c.popup.css("padding-top")),u=parseInt(c.popup.css("border-top-width")),v=parseInt(c.popup.css("margin-top"));isNaN(q)&&(q=0);isNaN(u)&&(u=0);isNaN(v)&&(v=0);q=g-(c.content.position().top-(q+u+v));!0===b&&0<d.animateSpeed?s.stop(!0,!1).height(s.height()).animate({height:q-e},d.animateSpeed):s.css({height:q-e});j>q&&d.innerOverflow&&s.css("overflow-y","scroll");c&&c.container&&c.container.remove();j=0.05*n;c=g+p;c>0.9*n?(t=j,h.css("overflow","auto"),a.bottom_push.css({top:j+c+"px",height:j+"px",width:"1px"}),a.shadow.css({height:2*j+c+"px"})):(h.css("overflow",""),a.bottom_push.css({top:"0px",height:"0px",width:"0px"}),a.shadow.css({height:"100%"}))}h=(l-(i+f))/2;p=(n-(g+p))/2;!1!==t&&(p=t);!0===b&&0<d.animateSpeed?k.animate({left:h,top:p,width:i,height:g},d.animateSpeed).css("overflow",""):k.css({left:h,top:p,width:i,height:g})}}var f=function(a){a=m(a,{});"gallery"==a.mode&&null==a.autoScale&&(a.autoScale=!0);this.settings=e.extend({},this.defaultSettings,a);this.shadow=this.popup=this.container=!1;this.properties={animating:!1,isopen:!1,resizepause:!1,loaded_content:-1,bodyMarginRight:"",bodyOverflow:""}};f.prototype.adjust=function(a){var a=m(a,!1),b=this;if(!b.properties.resizepause&&(!a||b.properties.isopen))if(b.properties.resizepause=!0,setTimeout(function(){x(b,a);b.properties.resizepause=!1},b.properties.updatePositionDelay),b.properties.loaded_content!==b.settings.content){if(!n(b)){var d=b;if((d=m(d,!1))&&d.popup){var e=d.popup.find("img");if(0<e.length){var h=0;e.each(function(a,b){b.complete||4===b.readyState||"complete"===b.readyState?h++:"undefined"!==typeof b.onload?b.onload=function(){"undefined"!==typeof b.readyState?setTimeout(function(){n(d,!0)},10):n(d,!0)}:"undefined"!==typeof b.onreadystatechange&&(b.onreadystatechange=function(){setTimeout(function(){n(d,!0)},10)})});e.length==h&&n(d,!0)}}}b.properties.loaded_content=b.settings.content}};f.prototype.checkImages=function(){this.properties.loaded_content=-1};f.prototype.close=function(){var a=this;if(!a.properties.animating&&a.properties.isopen){if("function"===typeof a.settings.onClose)a.settings.onClose(a);a.properties.animating=!0;a.container.fadeOut(a.settings.fadeOutSpeed,function(){w(a,"close")});e(window).off("resize.popbox.adjust");a.properties.isopen=!1;a.checkImages();"function"===typeof a.settings.afterClose&&a.settings.afterClose(a)}};f.prototype.open=function(){var a=this;if(!a.properties.animating&&!a.properties.isopen){if("function"===typeof a.settings.onOpen)a.settings.onOpen(a);a.properties.animating=!0;var b=l(this.settings.close,!0)?a.settings.close:a.defaultSettings.close,d=l(this.settings.content,!0)?a.settings.content:"",k=l(this.settings.title,!0)?'<div class="popbox-title">'+a.settings.title+"</div>":"",h=l(this.settings.customClass,!0)?" "+a.settings.customClass:"",f=e("body");a.properties.bodyOverflow=f.css("overflow");var i=f.width();f.css("overflow","hidden");var g=f.width();g>i&&(a.properties.bodyMarginRight=f.css("margin-right"),i=parseInt(a.properties.bodyMarginRight)+(g-i),f.css("margin-right",i+"px"));e(document).on("scroll.popbox touchmove.popbox mousewheel.popbox",function(){});f.append('<div class="popbox-container'+h+'" style="display: none;"><div class="popbox-bottom-push"></div><a class="popbox-shadow" href="javascript:void(0);"></a><div class="popbox-popup">'+k+'<a class="popbox-close">'+b+'</a><div class="popbox-content">'+d+"</div></div></div>");a.container=e(".popbox-container");a.popup=a.container.find(".popbox-popup");a.shadow=a.container.find(".popbox-shadow");a.bottom_push=a.container.find(".popbox-bottom-push");a.close_button=a.container.find(".popbox-close");a.title_area=a.container.find(".popbox-title");a.content_area=a.container.find(".popbox-content");"gallery"==a.settings.mode&&(a.content_area.css({visibility:"hidden",height:"0"}),b=l(this.settings.gallery.loading,!0)?a.settings.gallery.loading:a.defaultSettings.gallery.loading,a.content_area.after('<div class="popbox-gallery-loading">'+b+"</div>"),a.gallery_loading=a.container.find(".popbox-gallery-loading"));a.container.css({display:"none",height:"100%",width:"100%",position:"fixed",left:"0px",top:"0px","z-index":"990","background-color":"rgba(0,0,0,0.4)"});a.bottom_push.css({display:"block",position:"absolute",left:"0px",top:"0px",height:"0px",width:"1px","z-index":"992"});a.popup.css({display:"block",position:"absolute",top:"0px",left:"0px","z-index":"993"});a.shadow.css({display:"block",position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%","z-index":"991",background:"#fff",opacity:"0",cursor:"default"});a.content_area.css({overflow:"hidden",height:"100%"});a.adjust();a.container.fadeIn(a.settings.fadeInSpeed,function(){w(a,"open")});a.shadow.click(function(b){a.close();b.preventDefault()});a.close_button.click(function(b){a.close();b.preventDefault()});e(window).on("resize.popbox.adjust",function(){a.adjust(!0)});a.properties.isopen=!0;"function"===typeof a.settings.afterOpen&&a.settings.afterOpen(a)}};f.prototype.update=function(a,b){a=m(a,{});b=m(b,!0);this.settings=e.extend({},this.settings,a);if(this.properties.isopen){var d=l(this.settings.close,!0)?this.settings.close:this.defaultSettings.close,f=l(this.settings.content,!0)?this.settings.content:"",h=l(this.settings.title,!0)?this.settings.title:"";0<this.close_button.length&&this.close_button.html(d);0<this.content_area.length&&this.content_area.html(f);0<this.title_area.length?""!=h?this.title_area.html(h):(this.title_area.remove(),this.title_area=this.popup.find(".popbox-title")):""!=h&&(this.popup.prepend('<div class="popbox-title">'+h+"</div>"),this.title_area=this.popup.find(".popbox-title"));b&&this.adjust(!0)}};f.prototype.isOpen=function(){return!0==this.properties.isopen};f.prototype.isClose=function(){return!1==this.properties.isopen};f.prototype.defaultSettings={width:"auto",height:"auto",maxwidth:"none",maxheight:"none",innerOverflow:!1,content:"",close:"X",title:"",onOpen:!1,onClose:!1,afterOpen:!1,afterClose:!1,fadeInSpeed:400,fadeOutSpeed:400,updatePositionDelay:200,autoScale:!1,customClass:"",animateSpeed:400,mode:"normal",gallery:{loading:"Loading"}};window.PopBox=f})(jQuery);
