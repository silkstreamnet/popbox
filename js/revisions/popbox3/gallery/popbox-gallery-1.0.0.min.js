!function($,window){!function(){for(var minimum_required_popbox_version="3.0.0".split("."),pvi=0,pvl=$.Popbox.prototype.version.split(".").length;pvl>pvi;pvi++)if($.Popbox.prototype.version.split(".")[pvi]<minimum_required_popbox_version[pvi])return void console.log("Error: Popbox "+minimum_required_popbox_version.join(".")+"+ required.")}();var _static=$.Popbox.prototype._static,extend_default_settings={gallery:{selector:"",clickable:!0,error:'<div class="popbox-gallery-error">There was an error loading the image.</div>',next:"<span>&#x25B6;</span>",prev:"<span>&#x25C0;</span>"}};$.extend(!0,$.Popbox.prototype.default_settings,extend_default_settings);var gallery=function(){};gallery.prototype.updateItems=function(){var popbox=this.self;if(popbox.settings.gallery.selector){var $items=$(popbox.settings.gallery.selector);$items.each(function(){var $item=$(this),href=$item.attr("href"),src=$item.attr("src"),link=!1;href?link=href:src?link=src:($item.find("a[href]").each(function(){var sublink=$(this).attr("href");sublink&&!sublink.match(/^#/)&&_static.indexOf(sublink,popbox.properties.gallery.items,!0)<0&&popbox.properties.gallery.items.push(sublink)}),$item.find("img[src]").each(function(){var sublink=$(this).attr("src");sublink&&_static.indexOf(sublink,popbox.properties.gallery.items,!0)<0&&popbox.properties.gallery.items.push(sublink)})),link&&_static.indexOf(link,popbox.properties.gallery.items,!0)<0&&popbox.properties.gallery.items.push(link)}),popbox.settings.gallery.clickable&&$items.off("click.popbox_gallery_open").on("click.popbox_gallery_open",function(e){e.preventDefault();var $item=$(this),href=$item.attr("href"),src=$item.attr("src");if(popbox.gallery.updateItems(),href)popbox.gallery.goTo(_static.indexOf(href,popbox.properties.gallery.items,!0));else if(src)popbox.gallery.goTo(_static.indexOf(src,popbox.properties.gallery.items,!0));else{var first_href=$item.find("a[href]:first").attr("href"),first_src=$item.find("img[src]:first").attr("src");first_href&&!first_href.match(/^#/)?popbox.gallery.goTo(_static.indexOf(first_href,popbox.properties.gallery.items,!0)):first_src&&popbox.gallery.goTo(_static.indexOf(first_src,popbox.properties.gallery.items,!0))}popbox.open()})}},gallery.prototype.goTo=function(new_item_index){var popbox=this.self;new_item_index=_static.isNumber(new_item_index)?new_item_index:popbox.properties.gallery.current_index,popbox.properties.gallery.items.length>0&&(-1>new_item_index||new_item_index>popbox.properties.gallery.items.length-1?new_item_index=0:0>new_item_index&&(new_item_index=popbox.properties.gallery.items.length>0?popbox.properties.gallery.items.length-1:0),popbox.properties.gallery.current_index=new_item_index,popbox.update({content:'<img src="'+popbox.properties.gallery.items[popbox.properties.gallery.current_index]+'" />'},!0))},gallery.prototype.next=function(){var popbox=this.self;popbox.gallery.goTo(popbox.properties.gallery.current_index+1)},gallery.prototype.prev=function(){var popbox=this.self;popbox.gallery.goTo(popbox.properties.gallery.current_index-1)},$.Popbox.prototype.gallery=gallery,_static.addHook("initialize",function(){var popbox=this;popbox.gallery=new gallery,popbox.gallery.self=popbox}),_static.addHook("after_initialize",function(new_settings){var popbox=this;"gallery"==popbox.settings.mode&&new_settings&&!_static.isSet(new_settings.aspect_fit)&&(popbox.settings.aspect_fit=!0),popbox.gallery.updateItems()}),_static.addHook("after_reset",function(){var popbox=this;popbox.properties.gallery={items:[],current_index:0}}),_static.addHook("open",function(){var popbox=this;if("gallery"==popbox.settings.mode){popbox.gallery.updateItems();var $existing_img=$("<div/>").html(popbox.settings.content).find("img[src]"),existing_img_index=-1;$existing_img.length&&(existing_img_index=_static.indexOf($existing_img.attr("src"),popbox.properties.gallery.items,!0)),popbox.gallery.goTo(existing_img_index)}}),_static.addHook("image_error",function(image_cache_src){var popbox=this;"gallery"==popbox.settings.mode&&(popbox.update({content:popbox.settings.gallery.error},!1),popbox.properties.image_cache[image_cache_src]&&delete popbox.properties.image_cache[image_cache_src])}),_static.addHook("after_update",function(){var popbox=this;popbox.isOpen()||(popbox.properties.gallery.items=[],popbox.properties.gallery.current_index=0),"gallery"==popbox.settings.mode&&(popbox.gallery.updateItems(),popbox.gallery.goTo())}),_static.addHook("after_update_dom",function(){var popbox=this,show_btns=!1;"gallery"===popbox.settings.mode&&popbox.properties.gallery.items.length>1&&(popbox.elements.$popbox_gallery_next||(popbox.elements.$popbox_gallery_next=$("<a/>",{"class":"popbox-gallery-next",href:"javascript:void(0);"}).html(popbox.settings.gallery.next).appendTo(popbox.elements.$popbox_container)),popbox.elements.$popbox_gallery_prev||(popbox.elements.$popbox_gallery_prev=$("<a/>",{"class":"popbox-gallery-prev",href:"javascript:void(0);"}).html(popbox.settings.gallery.prev).appendTo(popbox.elements.$popbox_container)),popbox.elements.$popbox_gallery_next.off("click.popbox_gallery_next").on("click.popbox_gallery_next",function(e){e.preventDefault(),popbox.gallery.next()}),popbox.elements.$popbox_gallery_prev.off("click.popbox_gallery_prev").on("click.popbox_gallery_prev",function(e){e.preventDefault(),popbox.gallery.prev()}),show_btns=!0),show_btns||(popbox.elements.$popbox_gallery_next&&popbox.elements.$popbox_gallery_next.remove(),popbox.elements.$popbox_gallery_prev&&popbox.elements.$popbox_gallery_prev.remove(),popbox.elements.$popbox_gallery_next=!1,popbox.elements.$popbox_gallery_prev=!1)}),$.Popbox.prototype.plugins.gallery="1.0.0"}(jQuery,window);