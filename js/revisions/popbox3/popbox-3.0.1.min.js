!function($,window){function getVendorPropertyName(prop){if(prop in _static._test_div.style)return prop;for(var prefixes=["Moz","Webkit","O","ms"],prop_=prop.charAt(0).toUpperCase()+prop.substr(1),i=0;i<prefixes.length;++i){var vendorProp=prefixes[i]+prop_;if(vendorProp in _static._test_div.style)return vendorProp}}var _private=function(){},_static={$window:$(window),$html:$("html"),$body:$("body"),_event_namespace:"Popbox",_next_instance_id:0,_next_transition_id:0,_instances:{length:0},_support:{},_speeds:{_default:300,fast:300,medium:600,slow:1e3},_eases:{_default:"ease","in":"ease-in",out:"ease-out","in-out":"ease-in-out",snap:"cubic-bezier(0,1,.5,1)",easeInCubic:"cubic-bezier(.550,.055,.675,.190)",easeOutCubic:"cubic-bezier(.215,.61,.355,1)",easeInOutCubic:"cubic-bezier(.645,.045,.355,1)",easeInCirc:"cubic-bezier(.6,.04,.98,.335)",easeOutCirc:"cubic-bezier(.075,.82,.165,1)",easeInOutCirc:"cubic-bezier(.785,.135,.15,.86)",easeInExpo:"cubic-bezier(.95,.05,.795,.035)",easeOutExpo:"cubic-bezier(.19,1,.22,1)",easeInOutExpo:"cubic-bezier(1,0,0,1)",easeInQuad:"cubic-bezier(.55,.085,.68,.53)",easeOutQuad:"cubic-bezier(.25,.46,.45,.94)",easeInOutQuad:"cubic-bezier(.455,.03,.515,.955)",easeInQuart:"cubic-bezier(.895,.03,.685,.22)",easeOutQuart:"cubic-bezier(.165,.84,.44,1)",easeInOutQuart:"cubic-bezier(.77,0,.175,1)",easeInQuint:"cubic-bezier(.755,.05,.855,.06)",easeOutQuint:"cubic-bezier(.23,1,.32,1)",easeInOutQuint:"cubic-bezier(.86,0,.07,1)",easeInSine:"cubic-bezier(.47,0,.745,.715)",easeOutSine:"cubic-bezier(.39,.575,.565,1)",easeInOutSine:"cubic-bezier(.445,.05,.55,.95)",easeInBack:"cubic-bezier(.6,-.28,.735,.045)",easeOutBack:"cubic-bezier(.175, .885,.32,1.275)",easeInOutBack:"cubic-bezier(.68,-.55,.265,1.55)"},_transition_end_event_names:{transition:"transitionend",MozTransition:"transitionend",OTransition:"oTransitionEnd",WebkitTransition:"webkitTransitionEnd",msTransition:"MSTransitionEnd"},_test_div:document.createElement("div")};_static._support.transition=getVendorPropertyName("transition"),_static._support.transform=getVendorPropertyName("transform"),_static._support.transform_origin=getVendorPropertyName("transformOrigin"),_static._support.transition_end=_static._transition_end_event_names[_static._support.transition]||null,_static._test_div=null,_static.param=function(parameter,_default){return"undefined"!=typeof parameter?parameter:_default},_static.regexEscape=function(string){return string.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")},_static.isSet=function(value){return"undefined"!=typeof value},_static.isFunction=function(func){return"function"==typeof func},_static.isPlainObject=function(obj){return"object"==typeof obj&&null!=obj&&!(obj instanceof Array)},_static.isArray=function(arr){return"object"==typeof arr&&arr instanceof Array},_static.isNumber=function(number,required){return"number"==typeof number&&(!_static.param(required,!1)||number>0)},_static.isString=function(string,required){return"string"==typeof string&&(!_static.param(required,!1)||""!=string)},_static.getAttributeString=function($object,attr){var val=$object.attr(attr);return"undefined"==typeof val||val===!1||""===val?"":val},_static.indexOf=function(value,array,strict){if(strict=strict||!1,array instanceof Array)for(var i=0;i<array.length;i++)if(strict){if(array[i]===value)return i}else if(array[i]==value)return i;return-1},_static.trim=function(string){return _static.isString(string)?string.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""):string},_static.getInlineStyle=function($object,style){var full_inline_style=_static.getAttributeString($object,"style");if(style&&full_inline_style){var r=new RegExp("(^|;)\\s*"+_static.regexEscape(style)+"\\s*:");if(full_inline_style.match(r))return $object.css(style)}return""},_static.splitOutside=function(delimiter,string,container_start,container_end){"undefined"==typeof container_start&&(container_start=""),"undefined"==typeof container_end&&(container_end=container_start),container_start instanceof Array||(container_start=[container_start]),container_end instanceof Array||(container_end=[container_end]);for(var results=[],parts=string.split(delimiter),inside=!1,current=0,container_start_i=container_start[current],container_end_i=container_end[current],i=0;i<parts.length;i++){for(var part_handled=!1,j=0;j<container_start.length;j++){container_start_i=container_start[j],container_end_i=container_end[current];var container_start_ie=container_start_i.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),container_end_ie=container_end_i.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),start_match=parts[i].match(new RegExp("["+container_start_ie+"][^"+container_end_ie+"]*")),end_match=parts[i].match(new RegExp("[^"+container_start_ie+"]*["+container_end_ie+"]"));inside!==!1?j==current&&(inside+=parts[i],end_match?(results.push(inside),inside=!1):inside+=delimiter,part_handled=!0):start_match&&(inside=parts[i]+delimiter,current=j<container_end.length?j:0,part_handled=!0)}part_handled||results.push(parts[i])}return results},_static.elementPaddingWidth=function($object,include_margin){return $object&&$object.length?$object.outerWidth(!!_static.param(include_margin,!1))-$object.width():0},_static.elementPaddingHeight=function($object,include_margin){return $object&&$object.length?$object.outerHeight(!!_static.param(include_margin,!1))-$object.height():0},_static.transition=function($object,properties,duration,easing,complete,name){properties=_static.param(properties,{}),duration=_static.param(duration,_static._speeds._default),easing=_static.param(easing,_static._eases._default),name=_static.isString(name,!0)?name:!1;var property,transitions=[],property_difference=!1,transitioning=!1,this_transition_id=_static._next_transition_id;if(_static._next_transition_id++,_static._support.transition_end&&duration>25){for(property in properties)if(properties.hasOwnProperty(property)){transitions.push(property+" "+duration+"ms "+easing);var cur_property_val=$object.css(property),new_property_val=properties[property],size_properties=["width","height","top","right","bottom","left"];_static.isString(cur_property_val,!0)&&(cur_property_val=cur_property_val.trim(),cur_property_val.match(/^[0-9]+(?:\.[0-9]+)?\s*.{0,4}$/)&&(cur_property_val=parseFloat(cur_property_val))),_static.isString(new_property_val,!0)&&(new_property_val=new_property_val.trim(),new_property_val.match(/^[0-9]+(?:\.[0-9]+)?\s*.{0,4}$/)&&(new_property_val=parseFloat(new_property_val))),_static.isNumber(cur_property_val,!0)&&(cur_property_val=Math.ceil(cur_property_val*(_static.indexOf(property,size_properties)>-1?1:100))),_static.isNumber(new_property_val,!0)&&(new_property_val=Math.ceil(new_property_val*(_static.indexOf(property,size_properties)>-1?1:100))),_static.isNumber(cur_property_val)&&_static.isNumber(new_property_val)?(cur_property_val-new_property_val>1||new_property_val-cur_property_val>1)&&(property_difference=!0):cur_property_val!=new_property_val&&(property_difference=!0)}for(var existing_transitions=_static.splitOutside(",",$object.css("transition"),"(",")"),j=0;j<existing_transitions.length;j++){var existing_transition=_static.trim(existing_transitions[j]),existing_update=!1;if(existing_transition&&!existing_transition.match(/all 0(?:\.[0]+)?[^0-9]/)){for(property in properties)if(properties.hasOwnProperty(property)&&_static.isString(property,!0)&&existing_transitions[j].match(new RegExp(_static.regexEscape(property)))){existing_update=!0;break}existing_update||(transitions.push(existing_transition),property_difference=!0)}}var already_animating=$object.hasClass("popbox-animating");transitions.length&&property_difference&&($object.off(".popbox_auto_transition_end"),_static.transitionAddCallback($object,complete,name),$object.css("transition",transitions.join(", ")),$object.css(properties).addClass("popbox-animating"),$object.data("popbox-transition-id",this_transition_id),setTimeout(function(){var lazy_timeout_catchup=!1,transition_end=function(){if($object.data("popbox-transition-id")===this_transition_id){lazy_timeout_catchup!==!1&&(clearTimeout(lazy_timeout_catchup),lazy_timeout_catchup=!1),$object.off(".popbox_auto_transition_end"),$object.css("transition","").removeClass("popbox-animating");var live_functions=$object.data("popbox-transition-end-functions");if(live_functions&&(live_functions=$.extend({},live_functions),$object.data("popbox-transition-id",!1),_static.clearTransition($object)),live_functions)for(var functions_name in live_functions)if(live_functions.hasOwnProperty(functions_name))for(var i=0;i<live_functions[functions_name].length;i++)_static.isFunction(live_functions[functions_name][i])&&live_functions[functions_name][i]()}};$object.off(".popbox_auto_transition_end").on(_static._support.transition_end+".popbox_auto_transition_end",function(e){e.stopPropagation(),transition_end()}),lazy_timeout_catchup=setTimeout(function(){lazy_timeout_catchup=!1,transition_end()},duration+50)},0),transitioning=!0)}transitioning||($object.css(properties),already_animating?_static.transitionAddCallback($object,complete,name):_static.isFunction(complete)&&setTimeout(function(){complete()},0))},_static.transitionAddCallback=function($object,callback,name){if(name=_static.isString(name,!0)?name:"_default",$object.length&&_static.isFunction(callback)){var pre=$object.data("popbox-transition-end-functions");pre&&pre[name]?pre[name].push(callback):pre?pre[name]=[callback]:(pre={},pre[name]=[callback]),$object.data("popbox-transition-end-functions",pre)}},_static.clearTransition=function($object,name){if(name=_static.isString(name,!0)?name:!1){var pre=$object.data("popbox-transition-end-functions");pre&&pre[name]&&(delete pre[name],$object.data("popbox-transition-end-functions",pre))}else $object.data("popbox-transition-end-functions",!1)},_static.getTrueWidth=function($object){return $object&&$object.length?$object.get(0).getBoundingClientRect().right-$object.get(0).getBoundingClientRect().left:0},_static.getTrueHeight=function($object){return $object&&$object.length?$object.get(0).getBoundingClientRect().bottom-$object.get(0).getBoundingClientRect().top:0},_static.offTouchClick=function($object){$object.length&&$object.off(".Popbox_touch_click")},_static.onTouchClick=function($object,selector,handler,prevent_default){if($object.length){var touch_click_namespace="Popbox_touch_click";prevent_default&&$object.on("click."+touch_click_namespace,function(e){e.preventDefault()}),$object.on("mousedown."+touch_click_namespace+" touchstart."+touch_click_namespace,selector,function(e){if(e.originalEvent.touches||1==e.which){var $subobject=$(this);$subobject.off("mouseup."+touch_click_namespace+" touchend."+touch_click_namespace).on("mouseup."+touch_click_namespace+" touchend."+touch_click_namespace,function(e2){(e.originalEvent.touches||1==e.which)&&(prevent_default&&e2.preventDefault(),_static.isFunction(handler)&&handler.call(this,e2))})}})}},_private.prototype.reset=function(){var self=this.self;self._private.triggerHook("reset"),self.properties.disable_background_click_timer!==!1&&clearTimeout(self.properties.disable_background_click_timer),self.properties={is_open:!1,is_loading:!1,is_changing_state:!1,disable_background_click:!1,disable_background_click_timer:!1,image_cache:{},interface_image_cache_pending:0,content_image_cache_pending:0,last_html_overflow:!1,last_html_margin_right:!1,instance_id:self.properties.instance_id,events:self.properties.events},self.elements={$popbox:null,$popbox_loading:null,$popbox_popup:null,$popbox_empty:null,$popbox_wrapper:null,$popbox_container:null,$popbox_title:null,$popbox_close:null,$popbox_content:null,$popbox_overlay:self.elements.$popbox_overlay},self._private.triggerHook("after_reset")},_private.prototype.createOverlay=function(){var self=this.self,$container=self.settings.container?$(self.settings.container):_static.$body,$existing_popbox_overlay=$container.children(".popbox-overlay");$existing_popbox_overlay.length?self.elements.$popbox_overlay=$existing_popbox_overlay:self.elements.$popbox_overlay=$("<div/>",{"class":"popbox-overlay",css:{display:"none",position:"fixed",top:"0",right:"0",bottom:"0",left:"0"}}).data("is_open",!1).appendTo($container),self.elements.$popbox_overlay.off("click.popbox_overlay_close").on("click.popbox_overlay_close",function(e){e.preventDefault();for(var i in _static._instances)_static._instances.hasOwnProperty(i)&&_static._instances[i]instanceof Popbox&&_static._instances[i].isOpen()&&_static._instances[i].close();self._private.closeOverlay()})},_private.prototype.destroyOverlay=function(){var self=this.self;_static._instances.length<=0&&self.elements.$popbox_overlay&&(self.elements.$popbox_overlay.remove(),self.elements.$popbox_overlay=null)},_private.prototype.openOverlay=function(){var self=this.self;self.elements.$popbox_overlay||self._private.createOverlay(),self.elements.$popbox_overlay.data("is_open")===!1&&(self.elements.$popbox_overlay.css({display:"block",opacity:"0"}),_static.clearTransition(self.elements.$popbox_overlay),_static.transition(self.elements.$popbox_overlay,{opacity:"1"},self._private.getOverlayAnimationSpeed("open"),self._private.getOverlayAnimationEase("open")),self.elements.$popbox_overlay.data("is_open",!0))},_private.prototype.closeOverlay=function(){var self=this.self;self.elements.$popbox_overlay&&(self.elements.$popbox_overlay.data("is_open")===!0?(_static.clearTransition(self.elements.$popbox_overlay),_static.transition(self.elements.$popbox_overlay,{opacity:"0"},self._private.getOverlayAnimationSpeed("close"),self._private.getOverlayAnimationEase("close"),function(){self.elements.$popbox_overlay&&self.elements.$popbox_overlay.css({display:"none"}),self._private.destroyOverlay()}),self.elements.$popbox_overlay.data("is_open",!1)):self.elements.$popbox_overlay.hasClass("popbox-animating")||self._private.destroyOverlay())},_private.prototype.getAnimationStartProperties=function(type){var self=this.self;return _static.isSet(self.animations[self.settings.animation])?self.animations[self.settings.animation][type][0]:self.animations.fade[type][0]},_private.prototype.getAnimationEndProperties=function(type){var self=this.self;return _static.isSet(self.animations[self.settings.animation])?self.animations[self.settings.animation][type][self.animations[self.settings.animation][type].length-1]:self.animations.fade[type][self.animations.fade[type].length-1]},_private.prototype.getAnimationSpeed=function(type){var self=this.self;return self.settings[type+"_animation_speed"]||self.settings.animation_speed||_static._speeds._default},_private.prototype.getAnimationEase=function(type){var self=this.self;return self.settings[type+"_animation_ease"]||self.settings.animation_ease||_static._eases._default},_private.prototype.getOverlayAnimationSpeed=function(type){var self=this.self;return self.settings[type+"_overlay_animation_speed"]===!0?self._private.getAnimationSpeed(type):self.settings[type+"_overlay_animation_speed"]||self.settings.overlay_animation_speed||self._private.getAnimationSpeed(type)},_private.prototype.getOverlayAnimationEase=function(type){var self=this.self;return self.settings[type+"_overlay_animation_ease"]===!0?self._private.getAnimationEase(type):self.settings[type+"_overlay_animation_ease"]||self.settings.overlay_animation_ease||self._private.getAnimationEase(type)},_private.prototype.checkImagesLoaded=function(){var self=this.self;if(self.isCreated()){self.properties.content_image_cache_pending=0,self.properties.interface_image_cache_pending=0;var $images=self.elements.$popbox.find("img");$images.each(function(){var image=this,$image=$(this);if(image.src){var image_ready=image.complete&&_static.isNumber(image.naturalWidth,!1)||4===image.readyState||"complete"===image.readyState;image_ready||self.properties.image_cache[image.src]||(self.properties.image_cache[image.src]={origin:image,$origin:$image,proxy:!1,loaded:!1,type:$image.closest(self.elements.$popbox_content).length>0?"content":"interface"})}});var proxy_image_event=function(type){"content"===type?(self.properties.content_image_cache_pending--,self.properties.content_image_cache_pending<=0&&(self.properties.content_image_cache_pending=0,self.isChangingState()&&self.elements.$popbox_popup.hasClass("popbox-animating")?_static.transitionAddCallback(self.elements.$popbox_popup,function(){self.adjust(!0)}):self.adjust(!0))):(self.properties.interface_image_cache_pending--,self.properties.interface_image_cache_pending<=0&&(self.properties.interface_image_cache_pending=0))};for(var image_cache_src in self.properties.image_cache)self.properties.image_cache.hasOwnProperty(image_cache_src)&&(self.properties.image_cache[image_cache_src].proxy?self.properties.image_cache[image_cache_src].loaded||("content"===self.properties.image_cache[image_cache_src].type?self.properties.content_image_cache_pending++:self.properties.interface_image_cache_pending++):!function(image_cache_src){var proxy_image=new Image;"content"===self.properties.image_cache[image_cache_src].type?self.properties.content_image_cache_pending++:self.properties.interface_image_cache_pending++,self.properties.image_cache[image_cache_src].proxy=proxy_image,proxy_image.onload=function(){self.properties.image_cache[image_cache_src].loaded||(self.properties.image_cache[image_cache_src].loaded=!0,proxy_image_event(self.properties.image_cache[image_cache_src].type),self._private.triggerHook("image_load",[image_cache_src]))},proxy_image.onerror=function(){self.properties.image_cache[image_cache_src].loaded||(self.properties.image_cache[image_cache_src].loaded=!0,proxy_image_event(self.properties.image_cache[image_cache_src].type),self._private.triggerHook("image_error",[image_cache_src]))},proxy_image.src=image_cache_src}(image_cache_src));if(0==self.properties.content_image_cache_pending&&0==self.properties.interface_image_cache_pending)return!0}return!1},_private.prototype.applyDomSettings=function(){var self=this.self;if(self.isCreated()){self._private.triggerHook("update_dom"),self.elements.$popbox_loading.html(self.settings.loading_text),self.elements.$popbox_close.html(self.settings.close_text),self.elements.$popbox_title.html(self.settings.title),self.elements.$popbox_content.html(self.settings.content),_static.isString(self.settings.add_class,!0)&&self.elements.$popbox.addClass(self.settings.add_class),self.settings.aspect_fit?self.elements.$popbox.addClass("popbox-aspect-fit"):self.elements.$popbox.removeClass("popbox-aspect-fit"),self.settings.close_text===!1?self.elements.$popbox_close.css("display","none"):self.elements.$popbox_close.css("display","block"),self.settings.title===!1?self.elements.$popbox_title.css("display","none"):self.elements.$popbox_title.css("display","block"),_static.isNumber(self.settings.z_index,!0)&&(self.elements.$popbox_overlay.css("z-index",self.settings.z_index),self.elements.$popbox.css("z-index",self.settings.z_index+1),self.elements.$popbox_popup.css("z-index",self.settings.z_index+2));var user_agent_checks={mobile:navigator.userAgent.match(/(iPad|iPhone|iPod|Android)/g),ios:navigator.userAgent.match(/(iPad|iPhone|iPod)/g),android:navigator.userAgent.match(/(Android)/g)};self.settings.absolute===!0||_static.isString(self.settings.absolute)&&user_agent_checks[self.settings.absolute]?self.elements.$popbox.css({position:"absolute","overflow-y":"visible","overflow-x":"visible"}):self.elements.$popbox.css({position:"fixed","overflow-y":"scroll","overflow-x":"hidden"}),self._private.triggerHook("after_update_dom")}},_private.prototype.triggerHook=function(name,params){var self=this.self;if(params=_static.isArray(params)?params:[],_static.isPlainObject(self.hooks)&&_static.isArray(self.hooks[name]))for(var i=0;i<self.hooks[name].length;i++)_static.isFunction(self.hooks[name][i])&&self.hooks[name][i].apply(self,params)};var Popbox=function(settings){var self=this;self._private=new _private,self._private.self=self,self._private.triggerHook("initialize",[settings]),self.settings=$.extend(!0,{},self.default_settings,_static.param(settings,{})),self.properties={instance_id:_static._next_instance_id,events:{}},self.elements={$popbox_overlay:null},self._private.reset(),_static._next_instance_id++,self._private.triggerHook("after_initialize",[settings])};Popbox.prototype.version="3.0.1",Popbox.prototype.plugins={},Popbox.prototype.default_settings={width:!1,height:!1,min_width:100,min_height:100,max_width:!1,max_height:!1,container:!1,animation:"fade",animation_speed:_static._speeds._default,animation_ease:_static._eases._default,open_animation:null,open_animation_speed:null,open_animation_ease:null,close_animation:null,close_animation_speed:null,close_animation_ease:null,overlay_animation_speed:null,overlay_animation_ease:null,open_overlay_animation_speed:null,open_overlay_animation_ease:null,close_overlay_animation_speed:null,close_overlay_animation_ease:null,content:"",close_text:"X",title:!1,hide_page_scroll:!0,hide_page_scroll_space:!0,content_additional_offset:!1,loading_text:"Loading",absolute:"mobile",add_class:"",aspect_fit:!1,cache:!1,wait_for_images:!0,width_margin:.1,height_margin:.08,z_index:99900,mode:!1,open:!1,after_open:!1,close:!1,after_close:!1},Popbox.prototype._static=_static,Popbox.prototype._private=_private,Popbox.prototype.animations={fade:{open:[{opacity:"0"},{opacity:"1"}],close:[{opacity:"1"},{opacity:"0"}]}},Popbox.prototype.hooks={},_static.addHook=function(hook,handler){_static.isArray(Popbox.prototype.hooks[hook])||(Popbox.prototype.hooks[hook]=[]),Popbox.prototype.hooks[hook].push(handler)},Popbox.prototype.create=function(){var self=this;self.destroy(),self._private.triggerHook("create"),self._private.createOverlay();var $container=self.settings.container?$(self.settings.container):_static.$body;self.elements.$popbox=$("<div/>",{"class":"popbox",css:{display:"none",position:"fixed",width:"100%",height:"100%",top:"0px",left:"0px","overflow-y":"scroll","overflow-x":"hidden"}}),self.elements.$popbox_empty=$("<div/>",{"class":"popbox-empty",css:{display:"block",position:"absolute",top:"0",left:"0",width:"100%",height:"100%"}}).appendTo(self.elements.$popbox),self.elements.$popbox_popup=$("<div/>",{"class":"popbox-popup",css:{display:"none",position:"absolute",top:"50%",left:"50%",bottom:"auto",right:"auto",width:"0px",height:"0px"}}).appendTo(self.elements.$popbox),self.elements.$popbox_loading=$("<div/>",{"class":"popbox-loading",css:{display:"none"}}).appendTo(self.elements.$popbox_popup),self.elements.$popbox_wrapper=$("<div/>",{"class":"popbox-wrapper"}).appendTo(self.elements.$popbox_popup),self.elements.$popbox_container=$("<div/>",{"class":"popbox-container"}).appendTo(self.elements.$popbox_wrapper),self.elements.$popbox_close=$("<a/>",{"class":"popbox-close",href:"javascript:void(0);"}).appendTo(self.elements.$popbox_container),self.elements.$popbox_title=$("<div/>",{"class":"popbox-title"}).appendTo(self.elements.$popbox_container),self.elements.$popbox_content=$("<div/>",{"class":"popbox-content"}).appendTo(self.elements.$popbox_container),self._private.applyDomSettings(),self.elements.$popbox_close.off("click.popbox_close").on("click.popbox_close",function(e){e.preventDefault(),self.close()});var _complex_close_namespace="Popbox_complex_close";self.elements.$popbox.on("mousedown."+_static._event_namespace+" touchstart."+_static._event_namespace,function(e1){var e1pageX=e1.originalEvent.touches&&e1.originalEvent.touches[0]?e1.originalEvent.touches[0].pageX:e1.pageX,e1pageY=e1.originalEvent.touches&&e1.originalEvent.touches[0]?e1.originalEvent.touches[0].pageY:e1.pageY;return(e1.originalEvent.touches||1==e1.which)&&0===$(e1.target).closest(".popbox-popup").length&&e1pageX<self.elements.$popbox_empty.width()?(e1.preventDefault(),self.elements.$popbox.off("."+_complex_close_namespace),self.elements.$popbox.on("mouseup."+_complex_close_namespace+" touchend."+_complex_close_namespace,function(e2){return!e2.originalEvent.touches&&1!=e2.which||(self.elements.$popbox.off("."+_complex_close_namespace),self.properties.disable_background_click||e1.target!==e2.target||0!==$(e2.target).closest(".popbox-popup").length)?void 0:(e2.preventDefault(),self.close(),!1)}),self.elements.$popbox.on("mousemove."+_complex_close_namespace+" touchmove."+_complex_close_namespace,function(e3){var e3pageX=e3.originalEvent.touches&&e3.originalEvent.touches[0]?e3.originalEvent.touches[0].pageX:e3.pageX,e3pageY=e3.originalEvent.touches&&e3.originalEvent.touches[0]?e3.originalEvent.touches[0].pageY:e3.pageY;(e1pageX-5>e3pageX||e3pageX>e1pageX+5||e1pageY-5>e3pageY||e3pageY>e1pageY+5)&&self.elements.$popbox.off("."+_complex_close_namespace)}),self.elements.$popbox.on("scroll."+_complex_close_namespace,function(){self.elements.$popbox.off("."+_complex_close_namespace)}),!1):void 0}),self.elements.$popbox.appendTo($container),_static._instances[self.properties.instance_id]=self,_static._instances.length++,self._private.triggerHook("after_create")},Popbox.prototype.destroy=function(){var self=this;self.elements.$popbox&&(self._private.triggerHook("destroy"),self.elements.$popbox.remove(),self.elements.$popbox=null,_static.isSet(_static._instances[self.properties.instance_id])&&(delete _static._instances[self.properties.instance_id],_static._instances.length--),self._private.closeOverlay(),self._private.reset(),self._private.triggerHook("after_destroy"))},Popbox.prototype.update=function(settings,animate_adjust){var self=this;animate_adjust=_static.param(animate_adjust,!0),$.extend(!0,self.settings,_static.param(settings,{})),self.isCreated()&&(self.isOpen()?animate_adjust?self.showLoading(function(){self._private.applyDomSettings(),self.adjust(!0)}):(self._private.applyDomSettings(),self.adjust(!1)):self._private.applyDomSettings())},Popbox.prototype.open=function(){var self=this;if(!self.isOpen()){if(self._private.triggerHook("open"),self.trigger("open"),self.elements.$popbox?self._private.applyDomSettings():self.create(),"absolute"==self.elements.$popbox.css("position"))self.elements.$popbox.css("top",_static.$window.scrollTop()+"px");else if(self.settings.hide_page_scroll){var old_body_width=_static.$body.width();self.properties.last_html_overflow===!1&&(self.properties.last_html_overflow=_static.getInlineStyle(_static.$html,"overflow")),_static.$html.addClass("popbox-hide-page-scroll").css("overflow","hidden");var new_body_width=_static.$body.width();self.settings.hide_page_scroll_space&&(self.properties.last_html_margin_right===!1&&(self.properties.last_html_margin_right=_static.getInlineStyle(_static.$html,"margin-right")),new_body_width>old_body_width&&_static.$html.css("margin-right",new_body_width-old_body_width+"px"))}self._private.openOverlay(),self.elements.$popbox_popup.css({display:"block"}),self.elements.$popbox.css({display:"block"}),self.elements.$popbox_popup.css({visibility:"visible"}),self.showContent(),self.adjust(!1),self.elements.$popbox_popup.css(self._private.getAnimationStartProperties("open")),_static.clearTransition(self.elements.$popbox_popup),self.properties.is_changing_state=!0,_static.transition(self.elements.$popbox_popup,self._private.getAnimationEndProperties("open"),self._private.getAnimationSpeed("open"),self._private.getAnimationEase("open"),function(){self.properties.is_changing_state=!1}),self.elements.$popbox_popup.hasClass("popbox-animating")&&(self.properties.disable_background_click=!0,self.properties.disable_background_click_timer=setTimeout(function(){self.properties.disable_background_click=!1,self.properties.disable_background_click_timer=!1},self._private.getAnimationSpeed("open")+200)),self.properties.is_open=!0,self._private.triggerHook("after_open"),self.trigger("after_open")}},Popbox.prototype.close=function(destroy){var self=this;if(self.isOpen()){self._private.triggerHook("close"),self.trigger("close"),self.properties.is_open=!1;for(var object_name in self.elements)self.elements.hasOwnProperty(object_name)&&self.elements[object_name].length&&_static.clearTransition(self.elements[object_name]);self.elements.$popbox_popup.css(self._private.getAnimationStartProperties("close")),self.properties.is_changing_state=!0,_static.transition(self.elements.$popbox_popup,self._private.getAnimationEndProperties("close"),self._private.getAnimationSpeed("close"),self._private.getAnimationEase("close"),function(){self.properties.is_changing_state=!1,self.elements.$popbox.css({display:"none"}),self.properties.last_html_overflow!==!1&&_static.$html.css("overflow",self.properties.last_html_overflow),self.properties.last_html_margin_right!==!1&&_static.$html.css("margin-right",self.properties.last_html_margin_right),self.properties.last_html_overflow=!1,self.properties.last_html_margin_right=!1,_static.$html.removeClass("popbox-hide-page-scroll"),destroy||!self.settings.cache?self.destroy():(self.elements.$popbox_popup.css(self._private.getAnimationEndProperties("open")),self.properties.disable_background_click=!1,self.properties.disable_background_click_timer!==!1&&(clearTimeout(self.properties.disable_background_click_timer),self.properties.disable_background_click_timer=!1)),self._private.triggerHook("after_close"),self.trigger("after_close")})}self._private.closeOverlay()},Popbox.prototype.adjust=function(animate){var self=this;if(animate=_static.param(animate,!0),self.isCreated()){var adjust_elements=function(animate,show_content){animate=_static.param(animate,!1),show_content=_static.param(show_content,!1);var new_popbox_width,new_popbox_height,new_popbox_top,new_popbox_left,window_width=self.elements.$popbox_empty.width(),window_height=_static.$window.height(),popbox_width_padding=_static.elementPaddingWidth(self.elements.$popbox_popup),popbox_height_padding=_static.elementPaddingHeight(self.elements.$popbox_popup),content_width_padding=_static.elementPaddingWidth(self.elements.$popbox_content,!0),content_height_padding=_static.elementPaddingHeight(self.elements.$popbox_content,!0),max_popbox_width=(self.settings.width_margin>0?window_width-2*window_width*self.settings.width_margin:window_width)-popbox_width_padding,max_popbox_height=(self.settings.height_margin>0?window_height-2*window_height*self.settings.height_margin:window_height)-popbox_height_padding,min_popbox_width=0,min_popbox_height=0,set_popbox_width=_static.isNumber(self.settings.width)?self.settings.width+"px":"auto",set_popbox_height=_static.isNumber(self.settings.height)?self.settings.height+"px":"auto",max_popbox_screen_height=max_popbox_height;_static.isNumber(self.settings.max_width,!0)&&max_popbox_width>self.settings.max_width&&(max_popbox_width=self.settings.max_width),_static.isNumber(self.settings.max_height,!0)&&max_popbox_height>self.settings.max_height&&(max_popbox_height=self.settings.max_height),_static.isNumber(self.settings.min_width,!0)&&min_popbox_width<self.settings.min_width&&(min_popbox_width=self.settings.min_width),_static.isNumber(self.settings.min_height,!0)&&min_popbox_height<self.settings.min_height&&(min_popbox_height=self.settings.min_height),self.elements.$popbox_content.css({height:"","overflow-y":""}),self.elements.$popbox_wrapper.css({position:"relative",top:"0px",left:"0px",width:self.settings.aspect_fit?"99999px":max_popbox_width+"px",height:self.settings.aspect_fit?"99999px":"1px",overflow:"hidden"}),self.elements.$popbox_container.css({position:"absolute",top:"0px",left:"0px",width:set_popbox_width,height:set_popbox_height,"min-width":min_popbox_width+"px","min-height":min_popbox_height+"px","max-width":"100%"}),new_popbox_width=Math.ceil(100*_static.getTrueWidth(self.elements.$popbox_container))/100,new_popbox_height=Math.ceil(100*_static.getTrueHeight(self.elements.$popbox_container))/100;var set_content_height=function(scroll){scroll=scroll||!1;var new_content_height=new_popbox_height-content_height_padding,content_additional_offset=self.settings.content_additional_offset;if(new_content_height-=self.elements.$popbox_content.offset().top-self.elements.$popbox_popup.offset().top,_static.isNumber(content_additional_offset)?new_content_height+=content_additional_offset:content_additional_offset=[content_additional_offset],
content_additional_offset instanceof Array)for(var p=0;p<content_additional_offset.length;p++)if(_static.isString(content_additional_offset[p],!0)){var content_additional_offset_value=0;$(content_additional_offset[p]).each(function(){var $content_additional_offset_item=$(this),cur_value=$content_additional_offset_item.offset().top+$content_additional_offset_item.outerHeight(!0)-(self.elements.$popbox_content.offset().top+self.elements.$popbox_content.outerHeight(!0));cur_value>0&&cur_value>content_additional_offset_value&&(content_additional_offset_value=cur_value)})}self.elements.$popbox_content.css({height:scroll?Math.floor(new_content_height)+"px":new_content_height+"px","overflow-y":scroll?"scroll":"hidden"})};if(self.settings.aspect_fit){if(new_popbox_width>max_popbox_width||new_popbox_height>max_popbox_height){var max_ratio=(max_popbox_height-content_height_padding)/(max_popbox_width-content_width_padding),new_ratio=(new_popbox_height-content_height_padding)/(new_popbox_width-content_width_padding);new_ratio>max_ratio?(new_popbox_width=(new_popbox_width-content_width_padding)*((max_popbox_height-content_height_padding)/(new_popbox_height-content_height_padding))+content_width_padding,new_popbox_height=max_popbox_height):(new_popbox_height=(new_popbox_height-content_height_padding)*((max_popbox_width-content_width_padding)/(new_popbox_width-content_width_padding))+content_height_padding,new_popbox_width=max_popbox_width),set_content_height(!1)}}else(self.settings.max_height===!0||_static.isNumber(self.settings.max_height,!0))&&new_popbox_height>max_popbox_height?(new_popbox_height=max_popbox_height,set_content_height(!0)):set_content_height(!1);var cleanup=function(){self.elements.$popbox_wrapper.css({position:"",top:"",left:"",width:"",height:"",overflow:""}),self.elements.$popbox_container.css({position:"",top:"",left:"",width:"",height:"","min-width":"","min-height":"","max-width":""})};new_popbox_left=(window_width-(new_popbox_width+popbox_width_padding))/2,new_popbox_top=(window_height-(new_popbox_height+popbox_height_padding))/2,new_popbox_height>max_popbox_screen_height&&(new_popbox_top=self.settings.height_margin>0?window_height*self.settings.height_margin:0),animate?(_static.clearTransition(self.elements.$popbox_popup,"adjust"),_static.transition(self.elements.$popbox_empty,{height:Math.floor(new_popbox_height+popbox_height_padding+2*new_popbox_top-1)+"px"},_static._speeds.fast,_static._eases.easeInOutQuad),_static.transition(self.elements.$popbox_popup,{width:new_popbox_width+"px",height:new_popbox_height+"px",top:new_popbox_top+"px",left:new_popbox_left+"px"},_static._speeds.fast,_static._eases.easeInOutQuad,function(){cleanup(),show_content&&self.showContent()},"adjust")):(cleanup(),self.elements.$popbox_popup.css({width:new_popbox_width+"px",height:new_popbox_height+"px",top:new_popbox_top+"px",left:new_popbox_left+"px"}),self.elements.$popbox_empty.css({height:Math.floor(new_popbox_height+popbox_height_padding+2*new_popbox_top-1)+"px"}))};self._private.checkImagesLoaded(),self.settings.wait_for_images&&self.properties.content_image_cache_pending>0?self.showLoading(function(){animate||adjust_elements(animate,!1)}):animate?self.showLoading(function(){adjust_elements(animate,!0)}):adjust_elements(!1,!0)}},Popbox.prototype.showLoading=function(ready){var self=this;if(self.isCreated()){if(self.isLoading())return void(self.elements.$popbox_loading.hasClass("popbox-animating")||self.elements.$popbox_wrapper.hasClass("popbox-animating")||!_static.isFunction(ready)||ready());self.isOpen()?(_static.clearTransition(self.elements.$popbox_loading),_static.clearTransition(self.elements.$popbox_wrapper),_static.transition(self.elements.$popbox_wrapper,{opacity:"0"},_static._speeds.fast,"linear",function(){self.elements.$popbox_wrapper.css({visibility:"hidden"}),self.elements.$popbox_loading.css({opacity:"0",display:"block"}),_static.transition(self.elements.$popbox_loading,{opacity:"1"},_static._speeds.fast,"linear",function(){_static.isFunction(ready)&&ready()})})):(self.elements.$popbox_wrapper.css({opacity:"0",visibility:"hidden"}),self.elements.$popbox_loading.css({opacity:"1",display:"block"}),_static.isFunction(ready)&&ready()),self.properties.is_loading=!0}},Popbox.prototype.showContent=function(ready){var self=this;if(self.isCreated()){if(!self.isLoading())return void(self.elements.$popbox_popup.hasClass("popbox-animating")||self.elements.$popbox_loading.hasClass("popbox-animating")||self.elements.$popbox_wrapper.hasClass("popbox-animating")||!_static.isFunction(ready)||ready());self.isOpen()?(_static.clearTransition(self.elements.$popbox_loading),_static.clearTransition(self.elements.$popbox_wrapper),_static.transition(self.elements.$popbox_loading,{opacity:"0"},_static._speeds.fast,"linear",function(){self.elements.$popbox_loading.css({display:"none"}),self.elements.$popbox_wrapper.css({opacity:"0",visibility:"visible"}),_static.transition(self.elements.$popbox_wrapper,{opacity:"1"},_static._speeds.fast,"linear",function(){_static.isFunction(ready)&&ready()})})):(self.elements.$popbox_loading.css({display:"none",opacity:"0"}),self.elements.$popbox_wrapper.css({opacity:"1",visibility:"visible"}),_static.isFunction(ready)&&ready()),self.properties.is_loading=!1}},Popbox.prototype.isLoading=function(){var self=this;return self.properties.is_loading},Popbox.prototype.isOpen=function(){var self=this;return self.properties.is_open},Popbox.prototype.isChangingState=function(){var self=this;return self.properties.is_changing_state},Popbox.prototype.isCreated=function(){var self=this;return!!self.elements.$popbox},Popbox.prototype.on=function(event,handler){var self=this,event_parts=event.split(".",2);if(event_parts.length){var event_type=event_parts[0],event_name=event_parts[1]?event_parts[1]:"_default";_static.isPlainObject(self.properties.events[event_type])||(self.properties.events[event_type]={}),_static.isArray(self.properties.events[event_type][event_name])||(self.properties.events[event_type][event_name]=[]),self.properties.events[event_type][event_name].push(handler)}},Popbox.prototype.off=function(event,handler){var self=this,event_parts=event.split(".",2);if(event_parts.length){var event_type=event_parts[0],event_name=event_parts[1]?event_parts[1]:!1;if(_static.isPlainObject(self.properties.events[event_type]))for(var current_event_name in self.properties.events[event_type])if(self.properties.events[event_type].hasOwnProperty(current_event_name)&&_static.isArray(self.properties.events[event_type][current_event_name])&&(event_name===!1||event_name===current_event_name))if(_static.isFunction(handler))for(var i=0;i<self.properties.events[event_type][current_event_name].length;i++)self.properties.events[event_type][current_event_name][i]===handler&&(self.properties.events[event_type][current_event_name].splice(i,1),i--);else self.properties.events[event_type][current_event_name]=[]}},Popbox.prototype.trigger=function(event,handler,params){var self=this;params=_static.isArray(params)?params:[];var event_parts=event.split(".",2);if(event_parts.length){var event_type=event_parts[0],event_name=event_parts[1]?event_parts[1]:!1;if(_static.isFunction(self.settings[event_type])&&self.settings[event_type](),_static.isPlainObject(self.properties.events[event_type]))for(var current_event_name in self.properties.events[event_type])if(self.properties.events[event_type].hasOwnProperty(current_event_name)&&_static.isArray(self.properties.events[event_type][current_event_name])&&(event_name===!1||event_name===current_event_name))for(var i=0;i<self.properties.events[event_type][current_event_name].length;i++)!_static.isFunction(self.properties.events[event_type][current_event_name][i])||_static.isFunction(handler)&&self.properties.events[event_type][current_event_name][i]!==handler||self.properties.events[event_type][current_event_name][i].apply(self,params)}},_static.$window.on("resize."+_static._event_namespace,function(){if(_static._instances.length>0)for(var i in _static._instances)_static._instances.hasOwnProperty(i)&&_static._instances[i]instanceof Popbox&&_static._instances[i].isOpen()&&_static._instances[i].adjust(!1)}),$.Popbox=Popbox}(jQuery,window);