(function(k){function s(a,b){return"undefined"!==typeof a?a:b}function u(a,b){b=s(b,!1);return!isNaN(a-0)&&null!=a&&""!=a&&(!b||0<a)}function l(a,b){b=s(b,!1);return"string"===typeof a&&null!=a&&(!b||""!=a)}function y(a,b){var g;g=a.attr("style");if("undefined"===typeof g||!1===g||""===g)g="";if(b&&g){var r=new RegExp("(^|;)\\s*"+RegExp.escape(b)+"\\s*:");if(g.match(r))return a.css(b)}return""}function z(a,b){if(a.properties.animating)switch(a.properties.animating=!1,b){case "close":a.container.remove();a.container=!1;a.properties.isopen=!1;a.popup=!1;a.shadow=!1;k("html").css({overflow:a.properties.bodyOverflow,"margin-right":a.properties.bodyMarginRight});k(document).off("scroll.popbox touchmove.popbox mousewheel.popbox");break;case "open":a.properties.isopen=!0}}function h(a){a=s(a,!1);var b=!0;if(a&&a.popup){var g=a.popup.find("img");0<g.length&&g.each(function(a,d){d.complete||4===d.readyState||"complete"===d.readyState||(b=!1)})}"gallery"==a.settings.mode&&(b?(a.content_area.show(),a.gallery_loading_area&&a.gallery_loading_area.hide(),a.properties.gallery.isloading=!1):(a.content_area.hide(),a.gallery_loading_area&&a.gallery_loading_area.show(),a.properties.gallery.isloading=!0));b&&(A(a),a.properties.newopen=!1);return b}function D(a){if((a=s(a,!1))&&a.popup){var b=a.popup.find("img");if(0<b.length){var g=0;b.each(function(b,d){d.complete||4===d.readyState||"complete"===d.readyState?g++:("undefined"!==typeof d.onload?d.onload=function(){"undefined"!==typeof d.readyState?setTimeout(function(){h(a)},10):h(a)}:"undefined"!==typeof d.onreadystatechange&&(d.onreadystatechange=function(){setTimeout(function(){h(a)},10)}),"gallery"==a.settings.mode&&a.gallery_loading_area&&"undefined"!==typeof d.onerror&&(d.onerror=function(){var b=l(a.settings.gallery.error,!0)?a.settings.gallery.error:a.defaultSettings.gallery.error;a.gallery_loading_area.html(b);a.properties.gallery.isloading=!0;k(d).remove();a.adjust()}))});b.length==g&&h(a)}}}function E(a){a.properties.loaded_content!==a.settings.content&&(h(a)||D(a),a.properties.loaded_content=a.settings.content)}function B(a){a.popup.find("img").css({"max-width":"100%",height:"auto",display:"block"});a.popup.find("iframe").css({"max-height":"100%","max-width":"100%"})}function C(a){var b=k("body");a=a.container.clone().stop(!0,!0).addClass("popbox-rsc-clone").css({display:"block",visibility:"hidden","z-index":"-1",overflow:"hidden"});a.find("iframe").attr("src","");a.appendTo(b);b=b.find(".popbox-rsc-clone");return{container:b,popup:b.find(".popbox-popup").eq(0),content:b.find(".popbox-content").eq(0),gallery_loading_area:b.find(".popbox-gallery-loading").eq(0)}}function A(a){if((a=s(a,!1))&&a.popup){var b=a.settings,g=a.popup,r=a.container,d=a.content_area,k=a.gallery_loading_area;g.stop(!0,!1);var m=0,e=0,c=0,f=0,p=0,l=0,q=0,n=r.outerWidth(!1),h=r.outerHeight(!1),f=c=e=0,v=!1,c=!1;B(a);if(b.autoScale&&!a.properties.gallery.isloading)d.css({height:"100%",width:"100%",overflow:"hidden"}),c=C(a),c.popup.css({height:"auto",width:"auto",top:"auto",left:"auto"}),c.content.attr("style",""),c.content.find("img").css({"max-width":"none",height:"auto",display:"block"}),c.content.find("iframe").css({"max-height":"none","max-width":"none"}),f=c.popup.width(),p=c.popup.height(),l=c.popup.outerWidth(!1)-f,q=c.popup.outerHeight(!1)-p,c&&c.container&&c.container.remove(),e=.8*n-l,c=.8*h-q,e>b.maxwidth&&(e=b.maxwidth),c>b.maxheight&&(c=b.maxheight),p>c||f>e?p/f>c/e?(e=c,m=c/p*f):(m=e,e=e/f*p):(m=f,e=p);else{e=.8*n;c=.8*h;l=g.outerWidth(!1)-g.width();q=g.outerHeight(!1)-g.height();m=e-l;e=c-q;c=C(a);c.popup.css({height:"auto",width:"auto",top:"0",left:"0"});c.content.attr("style","");c.gallery_loading_area.attr("style","");f=c.content;a.properties.gallery.isloading?(c.content.css("display","none"),c.gallery_loading_area.css("display","block"),d=k,f=c.gallery_loading_area):(c.content.css("display","block"),c.gallery_loading_area.css("display","none"));u(b.width)?m=b.width:b.scaleToContent&&c.popup.width()<m&&(m=c.popup.width());u(b.maxwidth)&&m>b.maxwidth&&(m=b.maxwidth);c.popup.css({width:m});u(b.height)?e=b.height:b.innerOverflow||(e=c.popup.height());u(b.maxheight)&&e>b.maxheight&&(e=b.maxheight);0==parseInt(f.css("margin-top"))&&f.css({"margin-top":"-1px",top:"1px"});var k=f.outerHeight(!0),p=k-f.height(),t=parseInt(c.popup.css("padding-top")),w=parseInt(c.popup.css("border-top-width")),x=parseInt(c.popup.css("margin-top"));isNaN(t)&&(t=0);isNaN(w)&&(w=0);isNaN(x)&&(x=0);t=t+w+x;f=e-(f.position().top-t);!a.properties.newopen&&0<b.animateSpeed?d.stop(!0,!1).height(d.height()).animate({height:f-p},b.animateSpeed):d.stop(!0,!1).css({height:f-p});k>f&&b.innerOverflow&&d.css("overflow-y","scroll");c&&c.container&&c.container.remove();f=.05*h;c=e+q;c>.9*h?(v=f,r.css("overflow","auto"),a.bottom_push.css({top:f+c+"px",height:f+"px",width:"1px"}),a.shadow.css({height:2*f+c+"px"})):(r.css("overflow",""),a.bottom_push.css({top:"0px",height:"0px",width:"0px"}),a.shadow.css({height:"100%"}))}r=(n-(m+l))/2;q=(h-(e+q))/2;!1!==v&&(q=v);!a.properties.newopen&&0<b.animateSpeed?g.animate({left:r,top:q,width:m,height:e},b.animateSpeed).css("overflow",""):g.css({left:r,top:q,width:m,height:e})}}null!=RegExp&&null==RegExp.escape&&(RegExp.escape=function(a){return a.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")});var n=function(a){a=s(a,{});"gallery"==a.mode&&null==a.autoScale&&(a.autoScale=!0);this.settings=k.extend({},this.defaultSettings,a);this.shadow=this.popup=this.container=!1;this.properties={animating:!1,isopen:!1,newopen:!0,newopentime:0,resizepause:!1,loaded_content:-1,bodyMarginRight:"",bodyOverflow:"",gallery:{isloading:!1}}};n.prototype.adjust=function(){var a=this;!a.properties.resizepause&&a.properties.isopen&&(a.properties.resizepause=!0,setTimeout(function(){A(a);a.properties.resizepause=!1},a.properties.updatePositionDelay),E(a))};n.prototype.checkImages=function(){this.properties.loaded_content=-1};n.prototype.close=function(){var a=this;if(!a.properties.animating&&a.properties.isopen){if("function"===typeof a.settings.onClose)a.settings.onClose(a);a.properties.animating=!0;a.container.fadeOut(a.settings.fadeOutSpeed,function(){z(a,"close")});k(window).off("resize.popbox.adjust,scroll.popbox.adjust");a.properties.isopen=!1;a.checkImages();"function"===typeof a.settings.afterClose&&a.settings.afterClose(a)}};n.prototype.open=function(){var a=this;if(!a.properties.animating&&!a.properties.isopen){if("function"===typeof a.settings.onOpen)a.settings.onOpen(a);a.properties.animating=!0;var b=l(this.settings.close,!0)?a.settings.close:a.defaultSettings.close,g=l(this.settings.content,!0)?a.settings.content:"",n=l(this.settings.title,!0)?'<div class="popbox-title">'+a.settings.title+"</div>":"",d=l(this.settings.customClass,!0)?" "+a.settings.customClass:"",h=k("html"),m=k("body");a.properties.bodyOverflow=y(h,"overflow");var e=h.width();h.css("overflow","hidden");var c=h.width();if(c>e){var f=h.css("margin-right");a.properties.bodyMarginRight=y(h,"margin-right");e=parseInt(f)+(c-e);h.css("margin-right",e+"px")}k(document).on("scroll.popbox touchmove.popbox mousewheel.popbox",function(a){});m.append('<div class="popbox-container'+d+'" style="display: none;"><div class="popbox-bottom-push"></div><a class="popbox-shadow" href="javascript:void(0);"></a><div class="popbox-popup">'+n+'<a class="popbox-close">'+b+'</a><div class="popbox-content">'+g+"</div></div></div>");a.container=k(".popbox-container");a.popup=a.container.find(".popbox-popup");a.shadow=a.container.find(".popbox-shadow");a.bottom_push=a.container.find(".popbox-bottom-push");a.close_button=a.container.find(".popbox-close");a.title_area=a.container.find(".popbox-title");a.content_area=a.container.find(".popbox-content");a.gallery_loading_area=!1;a.container.css({display:"none",height:"100%",width:"100%",position:"fixed",left:"0px",top:"0px","z-index":"990","background-color":"rgba(0,0,0,0.4)"});a.bottom_push.css({display:"block",position:"absolute",left:"0px",top:"0px",height:"0px",width:"1px","z-index":"992"});a.popup.css({display:"block",position:"absolute",top:"0px",left:"0px","z-index":"993","-webkit-box-sizing":"content-box","-moz-box-sizing":"content-box","box-sizing":"content-box"});a.shadow.css({display:"block",position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%","z-index":"991",background:"#fff",opacity:"0",cursor:"default"});a.content_area.css({overflow:"hidden",height:"auto"});"gallery"==a.settings.mode&&(a.content_area.hide(),b=l(this.settings.gallery.loading,!0)?a.settings.gallery.loading:a.defaultSettings.gallery.loading,a.content_area.after('<div class="popbox-gallery-loading">'+b+"</div>"),a.gallery_loading_area=a.container.find(".popbox-gallery-loading"),a.gallery_loading_area.css({overflow:"hidden",height:"auto"}));a.container.fadeIn(a.settings.fadeInSpeed,function(){z(a,"open")});a.shadow.click(function(b){a.close();b.preventDefault()});a.close_button.click(function(b){a.close();b.preventDefault()});k(window).on("resize.popbox.adjust,scroll.popbox.adjust",function(){a.adjust()});a.properties.isopen=!0;a.properties.newopen=!0;a.properties.newopentime=(new Date).getTime();a.adjust();"function"===typeof a.settings.afterOpen&&a.settings.afterOpen(a)}};n.prototype.update=function(a,b){a=s(a,{});b=s(b,!0);this.settings=k.extend({},this.settings,a);if(this.properties.isopen){var g=l(this.settings.close,!0)?this.settings.close:this.defaultSettings.close,h=l(this.settings.content,!0)?this.settings.content:"",d=l(this.settings.title,!0)?this.settings.title:"";0<this.close_button.length&&this.close_button.html(g);0<this.content_area.length&&this.content_area.html(h);0<this.title_area.length?""!=d?this.title_area.html(d):(this.title_area.remove(),this.title_area=this.popup.find(".popbox-title")):""!=d&&(this.popup.prepend('<div class="popbox-title">'+d+"</div>"),this.title_area=this.popup.find(".popbox-title"));b?this.adjust():B(this)}};n.prototype.isOpen=function(){return!0==this.properties.isopen};n.prototype.isClose=function(){return!1==this.properties.isopen};n.prototype.defaultSettings={width:"auto",height:"auto",maxwidth:"none",maxheight:"none",innerOverflow:!1,scaleToContent:!1,content:"",close:"X",title:"",onOpen:!1,onClose:!1,afterOpen:!1,afterClose:!1,fadeInSpeed:400,fadeOutSpeed:400,updatePositionDelay:200,autoScale:!1,customClass:"",animateSpeed:400,mode:"normal",gallery:{loading:"Loading",error:"Error"}};window.PopBox=n})(jQuery);