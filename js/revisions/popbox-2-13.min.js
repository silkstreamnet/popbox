(function(i){function l(a,b){return"undefined"!==typeof a?a:b}function u(a,b){b=l(b,!1);return!isNaN(a-0)&&null!=a&&""!=a&&(!b||0<a)}function m(a,b){b=l(b,!1);return"string"===typeof a&&null!=a&&(!b||""!=a)}function q(a,b){var d=a.attr(b);if("undefined"===typeof d||!1===d||""===d)d="";return d}function y(a,b,d){d=d||!1;if(b instanceof Array)for(var c=0;c<b.length;c++)if(d){if(b[c]===a)return c}else if(b[c]==a)return c;return-1}function s(a,b){var d=q(a,"style");if(b&&d){var c=RegExp("(^|;)\\s*"+RegExp.escape(b)+"\\s*:");if(d.match(c))return a.css(b)}return""}function z(a,b){if(a.properties.animating)switch(a.properties.animating=!1,b){case "close":a.container.remove();a.container=!1;a.properties.isopen=!1;a.popup=!1;a.shadow=!1;i("html").css({overflow:a.properties.stored_styles.htmlOverflow,height:a.properties.stored_styles.htmlHeight,"margin-right":a.properties.stored_styles.htmlMarginRight});break;case "open":a.properties.isopen=!0}}function r(a){var a=l(a,!1),b=!0;if(a&&a.popup){var d=a.properties.loaded_images;if(d.length)for(var c=0;c<d.length;c++){var k=d[c];!k.complete&&(4!==k.readyState&&"complete"!==k.readyState)&&(b=!1)}else d=a.popup.find("img"),0<d.length&&d.each(function(a,c){!c.complete&&(4!==c.readyState&&"complete"!==c.readyState)&&(b=!1)})}b&&w(a);return b}function w(a){"gallery"==a.settings.mode&&(a.content_area.show(),a.gallery_loading_area&&a.gallery_loading_area.hide(),a.properties.gallery.isloading=!1);x(a);a.properties.newopen=!1}function A(a){a.popup.find("img").css({"max-width":"100%",height:"auto"}).filter(":visible").css({display:"block"});a.popup.find("iframe").css({"max-height":"100%","max-width":"100%"})}function B(a){a&&a.popup&&(a.properties.gallery.isloading=!0,a.update({content:'<img src="'+a.properties.gallery.images[a.properties.gallery.position]+'" style="display:none;" />'}))}function C(a){var b=i("body"),a=a.container.clone().stop(!0,!0).addClass("popbox-rsc-clone").css({display:"block",visibility:"hidden","z-index":"-1",overflow:"hidden"});a.find("iframe").attr("src","");a.appendTo(b);b=b.find(".popbox-rsc-clone");return{container:b,popup:b.find(".popbox-popup").eq(0),content:b.find(".popbox-content").eq(0),gallery_loading_area:b.find(".popbox-gallery-loading").eq(0)}}function D(a){a&&a.popup&&("gallery"==a.settings.mode&&!a.properties.gallery.isloading&&a.content_area.find("img:hidden").fadeIn(300),a.popup.find(".popbox-btn-hover").removeClass("popbox-btn-hover"))}function x(a){if((a=l(a,!1))&&a.popup){var b=a.settings,d=a.popup,c=a.container,k=a.content_area,i=a.shadow,v=a.gallery_loading_area;d.stop(!0,!1);c.css("overflow-y","hidden");A(a);var j=0,g=0,e=0,f=0,n=0,t=0,p=0,m=i.width(),h=c.outerHeight(!1),f=e=g=0,e=i=!1;if(b.autoScale&&!a.properties.gallery.isloading)k.css({height:"100%",width:"100%",overflow:"hidden"}),e=C(a),e.popup.css({height:"auto",width:"auto",top:"auto",left:"auto"}),e.content.attr("style",""),e.content.find("img").css({"max-width":"none",height:"auto",display:"block"}),e.content.find("iframe").css({"max-height":"none","max-width":"none"}),f=e.popup.width(),n=e.popup.height(),t=e.popup.outerWidth(!1)-f,p=e.popup.outerHeight(!1)-n,e&&e.container&&e.container.remove(),g=0.8*m-t,e=0.8*h-p,g>b.maxwidth&&(g=b.maxwidth),e>b.maxheight&&(e=b.maxheight),n>e||f>g?n/f>e/g?(g=e,j=f*(e/n)):(j=g,g=n*(g/f)):(j=f,g=n);else{g=0.8*m;e=0.8*h;t=d.outerWidth(!1)-d.width();p=d.outerHeight(!1)-d.height();j=g-t;g=e-p;e=C(a);e.popup.css({height:"auto",width:"auto",top:"0",left:"0"});e.content.attr("style","");e.gallery_loading_area.attr("style","");f=e.content;a.properties.gallery.isloading?(e.content.css("display","none"),e.gallery_loading_area.css("display","block"),k=v,f=e.gallery_loading_area):(e.content.css("display","block"),e.gallery_loading_area.css("display","none"));if(u(b.width))j=b.width;else if((b.scaleToContent||a.properties.gallery.isloading)&&e.popup.width()<j)j=e.popup.width();u(b.maxwidth)&&j>b.maxwidth&&(j=b.maxwidth);e.popup.css({width:j});u(b.height)?g=b.height:b.innerOverflow||(g=e.popup.height());u(b.maxheight)&&g>b.maxheight&&(g=b.maxheight);0==parseInt(f.css("margin-top"))&&f.css({"margin-top":"-1px",top:"1px"});var v=f.outerHeight(!0),n=v-f.height(),q=parseInt(e.popup.css("padding-top")),r=parseInt(e.popup.css("border-top-width")),s=parseInt(e.popup.css("margin-top"));isNaN(q)&&(q=0);isNaN(r)&&(r=0);isNaN(s)&&(s=0);f=g-(f.position().top-(q+r+s));!a.properties.newopen&&0<b.animateSpeed?k.stop(!0,!1).height(k.height()).animate({height:f-n},b.animateSpeed):k.stop(!0,!1).css({height:f-n});v>f&&b.innerOverflow&&k.css("overflow-y","scroll");e&&e.container&&e.container.remove();f=0.05*h;e=g+p;e>0.9*h?(i=f,c.css("overflow-y","scroll"),a.bottom_push.css({top:f+e+"px",height:f+"px",width:"1px"}),a.shadow.css({height:2*f+e+"px"})):(a.bottom_push.css({top:"0px",height:"0px",width:"0px"}),a.shadow.css({height:"100%"}))}c=(m-(j+t))/2;p=(h-(g+p))/2;!1!==i&&(p=i);!a.properties.newopen&&0<b.animateSpeed?d.animate({left:c,top:p,width:j,height:g},b.animateSpeed,function(){D(a)}).css("overflow",""):(d.css({left:c,top:p,width:j,height:g}),D(a))}}null!=RegExp&&null==RegExp.escape&&(RegExp.escape=function(a){return a.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")});var h=function(a){a=l(a,{});"gallery"==a.mode&&null==a.autoScale&&(a.autoScale=!0);this.settings=i.extend(!0,{},this.defaultSettings,a);this.shadow=this.popup=this.container=!1;this.properties={animating:!1,isopen:!1,newopen:!0,newopentime:0,resizepause:!1,loaded_content:-1,loaded_images:[],stored_styles:{htmlOverflow:"",htmlHeight:"",htmlMarginRight:""},gallery:{isloading:!1,images:[],position:0}}};h.prototype.adjust=function(a){var a=l(a,!1),b=this;if(b.properties.isopen&&(a||!b.properties.resizepause)){var d=1;b.properties.newopen||(b.properties.gallery.isloading?d=100:a||(d=b.settings.updatePositionDelay));b.properties.resizepause=!0;setTimeout(function(){x(b);b.properties.resizepause=!1},d);if(b.properties.loaded_content!==b.settings.content){var c=b;if((c=l(c,!1))&&c.popup)if(c.properties.loaded_images=[],a=c.popup.find("img"),0<a.length){"gallery"==c.settings.mode&&(c.content_area.hide(),c.gallery_loading_area&&c.gallery_loading_area.show(),c.properties.gallery.isloading=!0);var k=0;a.each(function(a,b){if(b.complete||4===b.readyState||"complete"===b.readyState)k++;else if(b.src){var d=new Image;"undefined"!==typeof d.onload?d.onload=function(){r(c)||setTimeout(function(){r(c)},10)}:"undefined"!==typeof d.onreadystatechange&&(d.onreadystatechange=function(){r(c)||setTimeout(function(){r(c)},10)});"gallery"==c.settings.mode&&c.gallery_loading_area&&"undefined"!==typeof d.onerror&&(d.onerror=function(){var a=m(c.settings.gallery.error,!0)?c.settings.gallery.error:c.defaultSettings.gallery.error;c.gallery_loading_area.html(a);c.properties.gallery.isloading=!0;i(b).remove();x(c);c.properties.newopen=!1});d.src=b.src;c.properties.loaded_images.push(d)}});a.length==k&&w(c)}else w(c);b.properties.loaded_content=b.settings.content}}};h.prototype.refresh=function(){this.properties.loaded_content=-1;this.properties.loaded_images=[]};h.prototype.close=function(){var a=this;if(!a.properties.animating&&a.properties.isopen){if("function"===typeof a.settings.onClose)a.settings.onClose(a);a.properties.animating=!0;a.container.fadeOut(a.settings.fadeOutSpeed,function(){z(a,"close")});i(window).off("resize.popbox.adjust");i(document).off("touchstart.popbox touchend.popbox");a.properties.isopen=!1;a.refresh();"gallery"==a.settings.mode&&a.update({content:""},!1);"function"===typeof a.settings.afterClose&&a.settings.afterClose(a)}};h.prototype.open=function(){var a=this;a.refresh();if(!a.properties.animating&&!a.properties.isopen){if("function"===typeof a.settings.onOpen)a.settings.onOpen(a);a.properties.animating=!0;var b=m(this.settings.close,!0)?a.settings.close:a.defaultSettings.close,d=m(this.settings.content,!0)?a.settings.content:"",c=m(this.settings.title,!0)?'<div class="popbox-title">'+a.settings.title+"</div>":"",k=m(this.settings.customClass,!0)?" "+a.settings.customClass:"",h=i("html"),l=i("body");a.properties.stored_styles.htmlOverflow=s(h,"overflow");a.properties.stored_styles.htmlHeight=s(h,"height");a.properties.stored_styles.htmlMarginRight=s(h,"margin-right");var j=l.width();h.css({overflow:"hidden",height:"100%"});var g=l.width();g>j&&h.css({"margin-right":g-j+"px"});l.append('<div class="popbox-container'+k+'" style="display: none;"><div class="popbox-bottom-push"></div><a class="popbox-shadow" href="javascript:void(0);"></a><div class="popbox-popup">'+c+'<div class="popbox-content">'+d+'</div><a href="#" class="popbox-close">'+b+"</a></div></div>");a.container=i(".popbox-container");a.popup=a.container.find(".popbox-popup");a.shadow=a.container.find(".popbox-shadow");a.bottom_push=a.container.find(".popbox-bottom-push");a.close_button=a.container.find(".popbox-close");a.title_area=a.container.find(".popbox-title");a.content_area=a.container.find(".popbox-content");a.gallery_loading_area=!1;a.container.css({display:"none",height:"100%",width:"100%",position:"fixed",left:"0px",top:"0px","z-index":"990","background-color":"rgba(0,0,0,0.4)","overflow-x":"hidden"});a.bottom_push.css({display:"block",position:"absolute",left:"0px",top:"0px",height:"0px",width:"1px","z-index":"992"});a.popup.css({display:"block",position:"absolute",top:"0px",left:"0px","z-index":"993","-webkit-box-sizing":"content-box","-moz-box-sizing":"content-box","box-sizing":"content-box"});a.shadow.css({display:"block",position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%","z-index":"991",background:"#fff",opacity:"0",cursor:"default"});a.content_area.css({overflow:"hidden",height:"auto"});if("gallery"==a.settings.mode&&(a.content_area.hide(),b=m(this.settings.gallery.loading,!0)?a.settings.gallery.loading:a.defaultSettings.gallery.loading,a.content_area.after('<div class="popbox-gallery-loading">'+b+"</div>"),a.gallery_loading_area=a.container.find(".popbox-gallery-loading"),a.gallery_loading_area.css({overflow:"hidden",height:"auto"}),a.settings.gallery.name&&(b=i("."+a.settings.gallery.name),b.length&&(b.each(function(){var b=i(this);if(0==b.closest(".popbox-container").length){var c=q(b,"src"),b=q(b,"href");(c=c?c:b)&&-1==y(c,a.properties.gallery.images)&&a.properties.gallery.images.push(c)}}),0<a.properties.gallery.images.length&&(b="",d=a.content_area.find("img:first"),d.length&&(b=q(d.eq(0),"src")),d=y(b,a.properties.gallery.images),a.properties.gallery.position=0,""==b||-1==d?a.properties.gallery.images.unshift(b):-1<d&&(a.properties.gallery.position=d),a&&a.popup))))){a.popup.append('<a href="#" class="popbox-gallery-next">&nbsp;'+a.settings.gallery.next+"</a>");a.gallery_next=a.popup.find(".popbox-gallery-next");a.popup.append('<a href="#" class="popbox-gallery-prev">'+a.settings.gallery.prev+"&nbsp;</a>");a.gallery_prev=a.popup.find(".popbox-gallery-prev");var e=!1,f=!1;a.gallery_next.click(function(b){b.preventDefault();a.properties.gallery.position++;a.properties.gallery.position>=a.properties.gallery.images.length&&(a.properties.gallery.position=0);B(a)}).mousemove(function(){e||(a.gallery_next.addClass("popbox-btn-hover"),e=!0,setTimeout(function(){e=!1},200))}).mouseleave(function(){a.gallery_next.removeClass("popbox-btn-hover")});a.gallery_prev.click(function(b){b.preventDefault();a.properties.gallery.position--;0>a.properties.gallery.position&&(a.properties.gallery.position=a.properties.gallery.images.length-1);B(a)}).mousemove(function(){f||(a.gallery_prev.addClass("popbox-btn-hover"),f=!0,setTimeout(function(){f=!1},200))}).mouseleave(function(){a.gallery_prev.removeClass("popbox-btn-hover")})}a.container.fadeIn(a.settings.fadeInSpeed,function(){z(a,"open")});a.shadow.click(function(b){a.close();b.preventDefault()});a.close_button.click(function(b){a.close();b.preventDefault()});i(window).on("resize.popbox.adjust",function(){a.adjust()});a.properties.isopen=!0;a.properties.newopen=!0;a.properties.newopentime=(new Date).getTime();a.adjust();"function"===typeof a.settings.afterOpen&&a.settings.afterOpen(a)}};h.prototype.update=function(a,b){a=l(a,{});b=l(b,!0);this.settings=i.extend({},this.settings,a);if(this.properties.isopen){var d=m(this.settings.close,!0)?this.settings.close:this.defaultSettings.close,c=m(this.settings.content,!0)?this.settings.content:"",h=m(this.settings.title,!0)?this.settings.title:"";0<this.close_button.length&&this.close_button.html(d);0<this.content_area.length&&this.content_area.html(c);0<this.title_area.length?""!=h?this.title_area.html(h):(this.title_area.remove(),this.title_area=this.popup.find(".popbox-title")):""!=h&&(this.popup.prepend('<div class="popbox-title">'+h+"</div>"),this.title_area=this.popup.find(".popbox-title"));b?this.adjust(!0):A(this)}};h.prototype.isOpen=function(){return!0==this.properties.isopen};h.prototype.isClose=function(){return!1==this.properties.isopen};h.prototype.defaultSettings={width:"auto",height:"auto",maxwidth:"none",maxheight:"none",innerOverflow:!1,scaleToContent:!1,content:"",close:"X",title:"",onOpen:!1,onClose:!1,afterOpen:!1,afterClose:!1,fadeInSpeed:400,fadeOutSpeed:400,updatePositionDelay:200,autoScale:!1,customClass:"",animateSpeed:400,mode:"normal",gallery:{loading:'<div style="padding:10px;">Loading...</div>',error:'<div style="padding:10px;">There was an error loading the image.</div>',name:"",next:"<span>&#x25B6;</span>",prev:"<span>&#x25C0;</span>"}};window.PopBox=h})(jQuery);