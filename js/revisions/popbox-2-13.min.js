(function(l){function s(a,b){return"undefined"!==typeof a?a:b}function x(a,b){b=s(b,!1);return!isNaN(a-0)&&null!=a&&""!=a&&(!b||0<a)}function p(a,b){b=s(b,!1);return"string"===typeof a&&null!=a&&(!b||""!=a)}function t(a,b){var c=a.attr(b);if("undefined"===typeof c||!1===c||""===c)c="";return c}function B(a,b,c){c=c||!1;if(b instanceof Array)for(var h=0;h<b.length;h++)if(c){if(b[h]===a)return h}else if(b[h]==a)return h;return-1}function y(a,b){var c=t(a,"style");if(b&&c){var h=new RegExp("(^|;)\\s*"+
RegExp.escape(b)+"\\s*:");if(c.match(h))return a.css(b)}return""}function C(a,b){if(a.properties.animating)switch(a.properties.animating=!1,b){case "close":a.container.remove();a.container=!1;a.properties.isopen=!1;a.popup=!1;a.shadow=!1;l("html").css({overflow:a.properties.stored_styles.htmlOverflow,height:a.properties.stored_styles.htmlHeight,"margin-right":a.properties.stored_styles.htmlMarginRight});break;case "open":a.properties.isopen=!0}}function u(a){a=s(a,!1);var b=!0;if(a&&a.popup){var c=
a.properties.loaded_images;if(c.length)for(var h=0;h<c.length;h++){var f=c[h];f.complete||4===f.readyState||"complete"===f.readyState||(b=!1)}else c=a.popup.find("img"),0<c.length&&c.each(function(a,c){c.complete||4===c.readyState||"complete"===c.readyState||(b=!1)})}b&&z(a);return b}function H(a){if((a=s(a,!1))&&a.popup){a.properties.loaded_images=[];var b=a.popup.find("img");if(0<b.length){"gallery"==a.settings.mode&&(a.content_area.hide(),a.gallery_loading_area&&a.gallery_loading_area.show(),a.properties.gallery.isloading=
!0);var c=0;b.each(function(b,f){if(f.complete||4===f.readyState||"complete"===f.readyState)c++;else if(f.src){var k=new Image;"undefined"!==typeof k.onload?k.onload=function(){u(a)||setTimeout(function(){u(a)},10)}:"undefined"!==typeof k.onreadystatechange&&(k.onreadystatechange=function(){u(a)||setTimeout(function(){u(a)},10)});"gallery"==a.settings.mode&&a.gallery_loading_area&&"undefined"!==typeof k.onerror&&(k.onerror=function(){var b=p(a.settings.gallery.error,!0)?a.settings.gallery.error:a.defaultSettings.gallery.error;
a.gallery_loading_area.html(b);a.properties.gallery.isloading=!0;l(f).remove();A(a);a.properties.newopen=!1});k.src=f.src;a.properties.loaded_images.push(k)}});b.length==c&&z(a)}else z(a)}}function z(a){"gallery"==a.settings.mode&&(a.content_area.show(),a.gallery_loading_area&&a.gallery_loading_area.hide(),a.properties.gallery.isloading=!1);A(a);a.properties.newopen=!1}function I(a){a.properties.loaded_content!==a.settings.content&&(H(a),a.properties.loaded_content=a.settings.content)}function D(a){a.popup.find("img").css({"max-width":"100%",
height:"auto"}).filter(":visible").css({display:"block"});a.popup.find("iframe").css({"max-height":"100%","max-width":"100%"})}function E(a){a&&a.popup&&(a.properties.gallery.isloading=!0,a.update({content:'<img src="'+a.properties.gallery.images[a.properties.gallery.position]+'" style="display:none;" />'}))}function J(a){if(a&&a.popup){a.popup.append('<a href="#" class="popbox-gallery-next">&nbsp;'+a.settings.gallery.next+"</a>");a.gallery_next=a.popup.find(".popbox-gallery-next");a.popup.append('<a href="#" class="popbox-gallery-prev">'+
a.settings.gallery.prev+"&nbsp;</a>");a.gallery_prev=a.popup.find(".popbox-gallery-prev");var b=!1,c=!1;a.gallery_next.click(function(b){b.preventDefault();a.properties.gallery.position++;a.properties.gallery.position>=a.properties.gallery.images.length&&(a.properties.gallery.position=0);E(a)}).mousemove(function(c){b||(a.gallery_next.addClass("popbox-btn-hover"),b=!0,setTimeout(function(){b=!1},200))}).mouseleave(function(b){a.gallery_next.removeClass("popbox-btn-hover")});a.gallery_prev.click(function(b){b.preventDefault();
a.properties.gallery.position--;0>a.properties.gallery.position&&(a.properties.gallery.position=a.properties.gallery.images.length-1);E(a)}).mousemove(function(b){c||(a.gallery_prev.addClass("popbox-btn-hover"),c=!0,setTimeout(function(){c=!1},200))}).mouseleave(function(b){a.gallery_prev.removeClass("popbox-btn-hover")})}}function F(a){var b=l("body");a=a.container.clone().stop(!0,!0).addClass("popbox-rsc-clone").css({display:"block",visibility:"hidden","z-index":"-1",overflow:"hidden"});a.find("iframe").attr("src",
"");a.appendTo(b);b=b.find(".popbox-rsc-clone");return{container:b,popup:b.find(".popbox-popup").eq(0),content:b.find(".popbox-content").eq(0),gallery_loading_area:b.find(".popbox-gallery-loading").eq(0)}}function G(a){a&&a.popup&&("gallery"!=a.settings.mode||a.properties.gallery.isloading||a.content_area.find("img:hidden").fadeIn(300),a.popup.find(".popbox-btn-hover").removeClass("popbox-btn-hover"))}function A(a){if((a=s(a,!1))&&a.popup){var b=a.settings,c=a.popup,h=a.container,f=a.content_area,
k=a.shadow,l=a.gallery_loading_area;c.stop(!0,!1);h.css("overflow-y","hidden");D(a);var n=0,e=0,d=0,g=0,q=0,p=0,r=0,m=k.width(),v=h.outerHeight(!1),g=d=e=0,d=k=!1;if(b.autoScale&&!a.properties.gallery.isloading)f.css({height:"100%",width:"100%",overflow:"hidden"}),d=F(a),d.popup.css({height:"auto",width:"auto",top:"auto",left:"auto"}),d.content.attr("style",""),d.content.find("img").css({"max-width":"none",height:"auto",display:"block"}),d.content.find("iframe").css({"max-height":"none","max-width":"none"}),
g=d.popup.width(),q=d.popup.height(),p=d.popup.outerWidth(!1)-g,r=d.popup.outerHeight(!1)-q,d&&d.container&&d.container.remove(),e=.8*m-p,d=.8*v-r,e>b.maxwidth&&(e=b.maxwidth),d>b.maxheight&&(d=b.maxheight),q>d||g>e?q/g>d/e?(e=d,n=d/q*g):(n=e,e=e/g*q):(n=g,e=q);else{e=.8*m;d=.8*v;p=c.outerWidth(!1)-c.width();r=c.outerHeight(!1)-c.height();n=e-p;e=d-r;d=F(a);d.popup.css({height:"auto",width:"auto",top:"0",left:"0"});d.content.attr("style","");d.gallery_loading_area.attr("style","");g=d.content;a.properties.gallery.isloading?
(d.content.css("display","none"),d.gallery_loading_area.css("display","block"),f=l,g=d.gallery_loading_area):(d.content.css("display","block"),d.gallery_loading_area.css("display","none"));x(b.width)?n=b.width:(b.scaleToContent||a.properties.gallery.isloading)&&d.popup.width()<n&&(n=d.popup.width());x(b.maxwidth)&&n>b.maxwidth&&(n=b.maxwidth);d.popup.css({width:n});x(b.height)?e=b.height:b.innerOverflow||(e=d.popup.height());x(b.maxheight)&&e>b.maxheight&&(e=b.maxheight);0==parseInt(g.css("margin-top"))&&
g.css({"margin-top":"-1px",top:"1px"});var l=g.outerHeight(!0),q=l-g.height(),w=parseInt(d.popup.css("padding-top")),t=parseInt(d.popup.css("border-top-width")),u=parseInt(d.popup.css("margin-top"));isNaN(w)&&(w=0);isNaN(t)&&(t=0);isNaN(u)&&(u=0);w=w+t+u;g=e-(g.position().top-w);!a.properties.newopen&&0<b.animateSpeed?f.stop(!0,!1).height(f.height()).animate({height:g-q},b.animateSpeed):f.stop(!0,!1).css({height:g-q});l>g&&b.innerOverflow&&f.css("overflow-y","scroll");d&&d.container&&d.container.remove();
g=.05*v;d=e+r;d>.9*v?(k=g,h.css("overflow-y","scroll"),a.bottom_push.css({top:g+d+"px",height:g+"px",width:"1px"}),a.shadow.css({height:2*g+d+"px"})):(a.bottom_push.css({top:"0px",height:"0px",width:"0px"}),a.shadow.css({height:"100%"}))}h=(m-(n+p))/2;r=(v-(e+r))/2;!1!==k&&(r=k);!a.properties.newopen&&0<b.animateSpeed?c.animate({left:h,top:r,width:n,height:e},b.animateSpeed,function(){G(a)}).css("overflow",""):(c.css({left:h,top:r,width:n,height:e}),G(a))}}null!=RegExp&&null==RegExp.escape&&(RegExp.escape=
function(a){return a.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")});var m=function(a){a=s(a,{});"gallery"==a.mode&&null==a.autoScale&&(a.autoScale=!0);this.settings=l.extend(!0,{},this.defaultSettings,a);this.shadow=this.popup=this.container=!1;this.properties={animating:!1,isopen:!1,newopen:!0,newopentime:0,resizepause:!1,loaded_content:-1,loaded_images:[],stored_styles:{htmlOverflow:"",htmlHeight:"",htmlMarginRight:""},gallery:{isloading:!1,images:[],position:0}}};m.prototype.adjust=function(a){a=s(a,
!1);var b=this;if(b.properties.isopen&&(a||!b.properties.resizepause)){var c=1;b.properties.newopen||(b.properties.gallery.isloading?c=100:a||(c=b.settings.updatePositionDelay));b.properties.resizepause=!0;setTimeout(function(){A(b);b.properties.resizepause=!1},c);I(b)}};m.prototype.refresh=function(){this.properties.loaded_content=-1;this.properties.loaded_images=[]};m.prototype.close=function(){var a=this;if(!a.properties.animating&&a.properties.isopen){if("function"===typeof a.settings.onClose)a.settings.onClose(a);
a.properties.animating=!0;a.container.fadeOut(a.settings.fadeOutSpeed,function(){C(a,"close")});l(window).off("resize.popbox.adjust");l(document).off("touchstart.popbox touchend.popbox");a.properties.isopen=!1;a.refresh();"gallery"==a.settings.mode&&a.update({content:""},!1);"function"===typeof a.settings.afterClose&&a.settings.afterClose(a)}};m.prototype.open=function(){var a=this;a.refresh();if(!a.properties.animating&&!a.properties.isopen){if("function"===typeof a.settings.onOpen)a.settings.onOpen(a);
a.properties.animating=!0;var b=p(this.settings.close,!0)?a.settings.close:a.defaultSettings.close,c=p(this.settings.content,!0)?a.settings.content:"",h=p(this.settings.title,!0)?'<div class="popbox-title">'+a.settings.title+"</div>":"",f=p(this.settings.customClass,!0)?" "+a.settings.customClass:"",k=l("html"),m=l("body");a.properties.stored_styles.htmlOverflow=y(k,"overflow");a.properties.stored_styles.htmlHeight=y(k,"height");a.properties.stored_styles.htmlMarginRight=y(k,"margin-right");var n=
m.width();k.css({overflow:"hidden",height:"100%"});var e=m.width();e>n&&k.css({"margin-right":e-n+"px"});m.append('<div class="popbox-container'+f+'" style="display: none;"><div class="popbox-bottom-push"></div><a class="popbox-shadow" href="javascript:void(0);"></a><div class="popbox-popup">'+h+'<div class="popbox-content">'+c+'</div><a href="#" class="popbox-close">'+b+"</a></div></div>");a.container=l(".popbox-container");a.popup=a.container.find(".popbox-popup");a.shadow=a.container.find(".popbox-shadow");
a.bottom_push=a.container.find(".popbox-bottom-push");a.close_button=a.container.find(".popbox-close");a.title_area=a.container.find(".popbox-title");a.content_area=a.container.find(".popbox-content");a.gallery_loading_area=!1;a.container.css({display:"none",height:"100%",width:"100%",position:"fixed",left:"0px",top:"0px","z-index":"990","background-color":"rgba(0,0,0,0.4)","overflow-x":"hidden"});a.bottom_push.css({display:"block",position:"absolute",left:"0px",top:"0px",height:"0px",width:"1px",
"z-index":"992"});a.popup.css({display:"block",position:"absolute",top:"0px",left:"0px","z-index":"993","-webkit-box-sizing":"content-box","-moz-box-sizing":"content-box","box-sizing":"content-box"});a.shadow.css({display:"block",position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%","z-index":"991",background:"#fff",opacity:"0",cursor:"default"});a.content_area.css({overflow:"hidden",height:"auto"});"gallery"==a.settings.mode&&(a.content_area.hide(),b=p(this.settings.gallery.loading,
!0)?a.settings.gallery.loading:a.defaultSettings.gallery.loading,a.content_area.after('<div class="popbox-gallery-loading">'+b+"</div>"),a.gallery_loading_area=a.container.find(".popbox-gallery-loading"),a.gallery_loading_area.css({overflow:"hidden",height:"auto"}),a.settings.gallery.name&&(b=l("."+a.settings.gallery.name),b.length&&(b.each(function(){var b=l(this);if(0==b.closest(".popbox-container").length){var c=t(b,"src"),b=t(b,"href");(c=c?c:b)&&-1==B(c,a.properties.gallery.images)&&a.properties.gallery.images.push(c)}}),
0<a.properties.gallery.images.length&&(b="",c=a.content_area.find("img:first"),c.length&&(b=t(c.eq(0),"src")),c=B(b,a.properties.gallery.images),a.properties.gallery.position=0,""==b||-1==c?a.properties.gallery.images.unshift(b):-1<c&&(a.properties.gallery.position=c),J(a)))));a.container.fadeIn(a.settings.fadeInSpeed,function(){C(a,"open")});a.shadow.click(function(b){a.close();b.preventDefault()});a.close_button.click(function(b){a.close();b.preventDefault()});l(window).on("resize.popbox.adjust",
function(){a.adjust()});a.properties.isopen=!0;a.properties.newopen=!0;a.properties.newopentime=(new Date).getTime();a.adjust();"function"===typeof a.settings.afterOpen&&a.settings.afterOpen(a)}};m.prototype.update=function(a,b){a=s(a,{});b=s(b,!0);this.settings=l.extend({},this.settings,a);if(this.properties.isopen){var c=p(this.settings.close,!0)?this.settings.close:this.defaultSettings.close,h=p(this.settings.content,!0)?this.settings.content:"",f=p(this.settings.title,!0)?this.settings.title:
"";0<this.close_button.length&&this.close_button.html(c);0<this.content_area.length&&this.content_area.html(h);0<this.title_area.length?""!=f?this.title_area.html(f):(this.title_area.remove(),this.title_area=this.popup.find(".popbox-title")):""!=f&&(this.popup.prepend('<div class="popbox-title">'+f+"</div>"),this.title_area=this.popup.find(".popbox-title"));b?this.adjust(!0):D(this)}};m.prototype.isOpen=function(){return!0==this.properties.isopen};m.prototype.isClose=function(){return!1==this.properties.isopen};
m.prototype.defaultSettings={width:"auto",height:"auto",maxwidth:"none",maxheight:"none",innerOverflow:!1,scaleToContent:!1,content:"",close:"X",title:"",onOpen:!1,onClose:!1,afterOpen:!1,afterClose:!1,fadeInSpeed:400,fadeOutSpeed:400,updatePositionDelay:200,autoScale:!1,customClass:"",animateSpeed:400,mode:"normal",gallery:{loading:'<div style="padding:10px;">Loading...</div>',error:'<div style="padding:10px;">There was an error loading the image.</div>',name:"",next:"<span>&#x25B6;</span>",prev:"<span>&#x25C0;</span>"}};
window.PopBox=m})(jQuery);
