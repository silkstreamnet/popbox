(function(i){function f(a,b){return"undefined"!==typeof a?a:b}function q(a,b){b=f(b,!1);return!isNaN(a-0)&&null!=a&&""!=a&&(!b||0<a)}function m(a,b){b=f(b,!1);return"string"===typeof a&&null!=a&&(!b||""!=a)}function s(a,b){if(a.properties.animating)switch(a.properties.animating=!1,b){case "close":a.container.remove();a.properties.isopen=!1;a.container=!1;a.popup=!1;a.shadow=!1;break;case "open":a.properties.isopen=!0}}function r(a,b){var a=f(a,!1),b=f(b,!1),d=!0;if(a&&a.popup){var c=a.popup.find("img");0<c.length&&c.each(function(a,b){b.complete||(d=!1)})}b&&d&&t(a,!0);return d}function t(a,b){b=f(b,!1);if(a=f(a,!1)){var d=a.popup,c={forceAbsolute:!1,container:window,completeHandler:null,animate:!0,width:"auto",height:"auto",maxwidth:"none",maxheight:"none",push_obj:!1,shadow:!1,fitImage:!1};i.extend(c,{animate:b,container:a.container,width:a.settings.width,height:a.settings.height,maxwidth:a.settings.maxwidth,maxheight:a.settings.maxheight,push_obj:a.bottom_push,shadow:a.shadow,fitImage:a.settings.fitImage});d.each(function(){var a=i(this),b=i(c.container),j=c.container==window;c.forceAbsolute&&(j?a.remove().appendTo("body"):a.remove().appendTo(b.get(0)));var f={position:a.css("position"),visibility:a.css("visibility"),display:a.css("display")},g={visibility:b.css("visibility"),display:b.css("display")},p={visibility:"hidden",display:"block"};a.css({position:"absolute",visibility:"hidden",display:"block"});j||b.css(p);var e,h,l,k,p=!1;if(c.fitImage){a.css({height:"",width:""});e=0.8*(j?b.width():b.outerWidth(!1));h=0.8*(j?b.height():b.outerHeight(!1));var n=a.outerWidth(!1),m=a.outerHeight(!1);l=a.width();k=a.height();e-=n-l;h-=m-k;k>h||l>e?(n=1,k/l>h/e?(n=h/k,a.height(h),a.width(l*n)):(n=e/l,a.width(e),a.height(k*n))):(a.width(l),a.height(k));a.find("img").css({"max-width":"100%",height:"auto",display:"block"})}else e=0.8*(j?b.width():b.outerWidth(!1)),h=a.outerWidth(!1)-a.width(),e-=h,q(c.width)?a.width(c.width):q(c.maxwidth)&&e>c.maxwidth?a.width(c.maxwidth):a.width(e),q(c.height)&&a.height(c.height),e=0.05*(j?b.height():b.outerHeight(!1)),h=0.9*(j?b.height():b.outerHeight(!1)),k=a.outerHeight(!1),k>h?(p=e,b.css("overflow","auto"),c.push_obj.css({top:e+k+"px",height:e+"px",width:"1px"}),c.shadow.css({height:2*e+k+"px"})):(b.css("overflow",""),c.push_obj.css({top:"0px",height:"0px",width:"0px"}),c.shadow.css({height:"100%"}));e=((j?b.width():b.outerWidth(!1))-a.outerWidth(!1))/2;h=((j?b.height():b.outerHeight(!1))-a.outerHeight(!1))/2;!1!==p&&(h=p);j&&(e+=b.scrollLeft(),h+=b.scrollTop());a.css(f);j||b.css(g);!0===c.animate?a.stop(!0,!0).animate({left:e,top:h},500):a.stop(!0,!0).css({left:e,top:h});c.completeHandler&&c.completeHandler(d)})}}var g=function(a){a=f(a,{});this.settings=i.extend({},this.defaultSettings,a);this.shadow=this.container=!1;this.properties={animating:!1,isopen:!1,resizepause:!1,loaded_content:-1}};g.prototype.adjust=function(a){var a=f(a,!1),b=this;if(!b.properties.resizepause&&(!a||b.properties.isopen))if(b.properties.resizepause=!0,setTimeout(function(){t(b,a);b.properties.resizepause=!1},b.properties.updatePositionDelay),b.properties.loaded_content!==b.settings.content){if(!r(b)){var d=b;if((d=f(d,!1))&&d.popup){var c=d.popup.find("img");if(0<c.length){var g=0;c.each(function(a,b){b.complete?g++:i(b).load(function(){r(d,!0)})});c.length==g&&r(d,!0)}}}b.properties.loaded_content=b.settings.content}};g.prototype.checkImages=function(){this.properties.loaded_content=-1};g.prototype.close=function(){var a=this;if(!a.properties.animating&&a.properties.isopen&&("function"===typeof a.settings.beforeClose&&a.settings.beforeClose(a),a.properties.animating=!0,a.container.fadeOut(a.settings.fadeOutSpeed,function(){s(a,"close");i("body").css({overflow:"","margin-right":""})}),i(window).off("resize.popbox.adjust"),a.properties.isopen=!1,a.checkImages(),"function"===typeof a.settings.onClose))a.settings.onClose(a)};g.prototype.open=function(){var a=this;if(!a.properties.animating&&!a.properties.isopen){"function"===typeof a.settings.beforeOpen&&a.settings.beforeOpen(a);a.properties.animating=!0;var b=m(this.settings.close,!0)?a.settings.close:this.defaultSettings.close,d=m(this.settings.content,!0)?a.settings.content:"",c=i("body"),f=c.width();c.css("overflow","hidden");var g=c.width();g>f&&(f=parseInt(c.css("margin-right"))+(g-f),c.css("margin-right",f+"px"));c.append('<div class="popbox-container" style="display: none;"><div class="popbox-bottom-push"></div><a class="popbox-shadow" href="javascript:void(0);"></a><div class="popbox-popup"><a class="popbox-close">'+b+"</a>"+d+"</div></div>");a.container=i(".popbox-container");a.popup=a.container.find(".popbox-popup");a.shadow=a.container.find(".popbox-shadow");a.bottom_push=a.container.find(".popbox-bottom-push");a.close_button=a.container.find(".popbox-close");a.container.css({display:"none",height:"100%",width:"100%",position:"fixed",left:"0px",top:"0px","z-index":"990","background-color":"rgba(0,0,0,0.4)"});a.bottom_push.css({display:"block",position:"absolute",left:"0px",top:"0px",height:"0px",width:"1px","z-index":"992"});a.popup.css({display:"block",visibility:"visible",position:"absolute",top:"0px",left:"0px","z-index":"993"});a.shadow.css({display:"block",position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%","z-index":"991",background:"#fff",opacity:"0",filter:"alpha(opacity=0)",cursor:"default"});a.adjust();a.container.fadeIn(a.settings.fadeInSpeed,function(){s(a,"open")});a.shadow.click(function(b){a.close();b.preventDefault()});a.close_button.click(function(b){a.close();b.preventDefault()});i(window).on("resize.popbox.adjust",function(){a.adjust(!0)});a.properties.isopen=!0;if("function"===typeof a.settings.onOpen)a.settings.onOpen(a)}};g.prototype.setSettings=function(a,b){var d=this,c=!1,a=f(a,{}),b=f(b,!0);!1!==f(a.content,!1)&&a.content!=d.settings.content&&(c=!0);d.settings=i.extend({},d.settings,a);if(d.properties.isopen){if(c){var c=m(this.settings.close,!0)?d.settings.close:this.defaultSettings.close,g=m(this.settings.content,!0)?d.settings.content:"";d.popup.html('<a class="popbox-close">'+c+"</a>"+g);d.close_button=d.popup.find(".popbox-close");d.close_button.click(function(a){d.close();a.preventDefault()})}b&&d.adjust(!0)}};g.prototype.isOpen=function(){return!0==this.properties.isopen};g.prototype.isClose=function(){return!1==this.properties.isopen};g.prototype.defaultSettings={width:"auto",height:"auto",maxwidth:"none",maxheight:"none",content:"",close:"X",onOpen:!1,onClose:!1,beforeOpen:!1,beforeClose:!1,fadeInSpeed:400,fadeOutSpeed:400,updatePositionDelay:200,fitImage:!1};window.PopBox=g})(jQuery);
