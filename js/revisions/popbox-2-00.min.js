(function(g){function f(a,b){return"undefined"!==typeof a?a:b}function l(a,b){b=f(b,!1);return!isNaN(a-0)&&null!=a&&""!=a&&(!b||0<a)}function k(a,b){b=f(b,!1);return"string"===typeof a&&null!=a&&(!b||""!=a)}function p(a,b){if(a.properties.animating)switch(a.properties.animating=!1,b){case "close":a.container.remove();a.properties.isopen=!1;a.container=!1;a.popup=!1;a.shadow=!1;break;case "open":a.properties.isopen=!0}}function n(a,b){var a=f(a,!1),b=f(b,!1),c=!0;if(a&&a.popup){var d=a.popup.find("img");0<d.length&&d.each(function(a,b){b.complete||(c=!1)})}b&&c&&q(a,!0);return c}function q(a,b){b=f(b,!1);if(a=f(a,!1)){var c=a.popup,d={forceAbsolute:!1,container:window,completeHandler:null,animate:!0,width:"auto",height:"auto",maxwidth:"none",maxheight:"none",push_obj:!1,shadow:!1};g.extend(d,{animate:b,container:a.container,width:a.settings.width,height:a.settings.height,maxwidth:a.settings.maxwidth,maxheight:a.settings.maxheight,push_obj:a.bottom_push,shadow:a.shadow});c.each(function(){var a=g(this),b=g(d.container),h=d.container==window;d.forceAbsolute&&(h?a.remove().appendTo("body"):a.remove().appendTo(b.get(0)));var f={position:a.css("position"),visibility:a.css("visibility"),display:a.css("display")},e={visibility:b.css("visibility"),display:b.css("display")},j={visibility:"hidden",display:"block"};a.css({position:"absolute",visibility:"hidden",display:"block"});h||b.css(j);var j=0.8*(h?b.width():b.outerWidth(!1)),i=a.outerWidth(!1)-a.width(),j=j-i;l(d.width)?a.width(d.width):l(d.maxwidth)&&j>d.maxwidth?a.width(d.maxwidth):a.width(j);l(d.height)&&a.height(d.height);var i=0.05*(h?b.height():b.outerHeight(!1)),m=0.9*(h?b.height():b.outerHeight(!1)),k=a.outerHeight(!1),j=!1;k>m?(j=i,b.css("overflow","auto"),d.push_obj.css({top:i+k+"px",height:i+"px",width:"1px"}),d.shadow.css({height:2*i+k+"px"})):(b.css("overflow",""),d.push_obj.css({top:"0px",height:"0px",width:"0px"}),d.shadow.css({height:"100%"}));i=((h?b.width():b.outerWidth(!1))-a.outerWidth(!1))/2;m=((h?b.height():b.outerHeight(!1))-a.outerHeight(!1))/2;!1!==j&&(m=j);h&&(i+=b.scrollLeft(),m+=b.scrollTop());a.css(f);h||b.css(e);!0===d.animate?a.stop(!0,!0).animate({left:i,top:m},500):a.stop(!0,!0).css({left:i,top:m});d.completeHandler&&d.completeHandler(c)})}}var e=function(a){a=f(a,{});this.settings=g.extend({},this.defaultSettings,a);this.shadow=this.container=!1;this.properties={animating:!1,isopen:!1,resizepause:!1,loaded_content:-1}};e.prototype.adjust=function(a){var a=f(a,!1),b=this;if(!b.properties.resizepause&&(!a||b.properties.isopen))if(b.properties.resizepause=!0,setTimeout(function(){q(b,a);b.properties.resizepause=!1},b.properties.updatePositionDelay),b.properties.loaded_content!==b.settings.content){if(!n(b)){var c=b;if((c=f(c,!1))&&c.popup){var d=c.popup.find("img");if(0<d.length){var e=0;d.each(function(a,b){b.complete?e++:g(b).load(function(){n(c,!0)})});d.length==e&&n(c,!0)}}}b.properties.loaded_content=b.settings.content}};e.prototype.checkImages=function(){this.properties.loaded_content=-1};e.prototype.close=function(){var a=this;if(!a.properties.animating&&a.properties.isopen&&("function"===typeof a.settings.beforeClose&&a.settings.beforeClose(a),a.properties.animating=!0,a.container.fadeOut(a.settings.fadeOutSpeed,function(){p(a,"close")}),g("body").css("overflow",""),g(window).off("resize.popbox.adjust"),a.properties.isopen=!1,"function"===typeof a.settings.onClose))a.settings.onClose(a)};e.prototype.open=function(){var a=this;if(!a.properties.animating&&!a.properties.isopen){"function"===typeof a.settings.beforeOpen&&a.settings.beforeOpen(a);a.properties.animating=!0;var b=l(this.settings.width,!0)?a.settings.width+"px":"",c=l(this.settings.height,!0)?a.settings.height+"px":"",d=k(this.settings.close,!0)?a.settings.close:this.defaultSettings.close,e=k(this.settings.content,!0)?a.settings.content:"";g("body").css("overflow","hidden").append('<div class="popbox-container" style="display: none;"><div class="popbox-bottom-push"></div><div class="popbox-shadow"></div><div class="popbox-popup"><a class="popbox-close">'+d+"</a>"+e+"</div></div>");a.container=g(".popbox-container");a.popup=a.container.find(".popbox-popup");a.shadow=a.container.find(".popbox-shadow");a.bottom_push=a.container.find(".popbox-bottom-push");a.close_button=a.container.find(".popbox-close");a.container.css({display:"none",height:"100%",width:"100%",position:"fixed",left:"0px",top:"0px","z-index":"990","background-color":"rgba(0,0,0,0.4)"});a.bottom_push.css({display:"block",position:"absolute",left:"0px",top:"0px",height:"0px",width:"1px","z-index":"992"});a.popup.css({display:"block",visibility:"visible",position:"absolute",top:"0px",left:"0px",height:c,width:b,"z-index":"993"});a.shadow.css({display:"block",position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%","z-index":"991"});a.adjust();a.container.fadeIn(a.settings.fadeInSpeed,function(){p(a,"open")});a.shadow.click(function(b){a.close();b.preventDefault()});a.close_button.click(function(b){a.close();b.preventDefault()});g(window).on("resize.popbox.adjust",function(){a.adjust(!0)});a.properties.isopen=!0;if("function"===typeof a.settings.onOpen)a.settings.onOpen(a)}};e.prototype.setSettings=function(a,b){var c=this,a=f(a,{}),b=f(b,!0);c.settings=g.extend({},c.settings,a);if(c.properties.isopen&&b){var d=l(this.settings.width,!0)?c.settings.width+"px":"",e=l(this.settings.height,!0)?c.settings.height+"px":"",n=k(this.settings.close,!0)?c.settings.close:this.defaultSettings.close,h=k(this.settings.content,!0)?c.settings.content:"";c.popup.html('<a class="popbox-close">'+n+"</a>"+h).css({height:e,width:d});c.close_button=c.popup.find(".popbox-close");c.close_button.click(function(a){c.close();a.preventDefault()});c.adjust(!0)}};e.prototype.isOpen=function(){return!0==this.properties.isopen};e.prototype.isClose=function(){return!1==this.properties.isopen};e.prototype.defaultSettings={width:"auto",height:"auto",maxwidth:"none",maxheight:"none",content:"",close:"X",onOpen:!1,onClose:!1,beforeOpen:!1,beforeClose:!1,fadeInSpeed:400,fadeOutSpeed:400,updatePositionDelay:200};window.PopBox=e})(jQuery);
