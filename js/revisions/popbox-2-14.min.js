(function(l){function m(a,b){return"undefined"!==typeof a?a:b}function t(a,b){b=m(b,!1);return!isNaN(a-0)&&null!=a&&""!=a&&(!b||0<a)}function f(a,b){b=m(b,!1);return"string"===typeof a&&null!=a&&(!b||""!=a)}function p(a,b){var d=a.attr(b);if("undefined"===typeof d||!1===d||""===d)d="";return d}function w(a,b,d){d=d||!1;if(b instanceof Array)for(var c=0;c<b.length;c++)if(d){if(b[c]===a)return c}else if(b[c]==a)return c;return-1}function q(a,b){var d=p(a,"style");if(b&&d){var c=RegExp("(^|;)\\s*"+RegExp.escape(b)+"\\s*:");if(d.match(c))return a.css(b)}return""}function x(a,b){if(a._properties.animating)switch(a._properties.animating=!1,b){case "close":a.container.remove();a.container=!1;a._properties.isopen=!1;a.popup=!1;a.shadow=!1;a.$html.css({overflow:a._properties.stored_styles.htmlOverflow,height:a._properties.stored_styles.htmlHeight,"margin-right":a._properties.stored_styles.htmlMarginRight});break;case "open":a._properties.isopen=!0}}function y(a){a.popup.find("img").css({"max-width":"100%",height:"auto"}).filter(":visible").css({display:"block"});a.popup.find("iframe").css({"max-height":"100%","max-width":"100%"})}function z(a){(a=m(a,!1))&&a.popup&&a.update({content:'<img src="'+a._properties.gallery.images[a._properties.gallery.position]+'" style="display:none;" />'})}function A(a){var b=a.container.clone().stop(!0,!0).addClass("popbox-rsc-clone").css({display:"block",visibility:"hidden","z-index":"-1",overflow:"hidden"});b.find("iframe").attr("src","");b.appendTo(a.$body);a=a.$body.find(".popbox-rsc-clone");return{container:a,popup:a.find(".popbox-popup").eq(0),content:a.find(".popbox-content").eq(0),gallery_loading_area:a.find(".popbox-gallery-loading").eq(0)}}function B(a){if((a=m(a,!1))&&a.popup)"gallery"==a._settings.mode&&"ready"==a._properties.gallery.status&&a.content_area.find("img:hidden").fadeIn(300),a.popup.find(".popbox-btn-hover").removeClass("popbox-btn-hover")}function C(a){if((a=m(a,!1))&&a.popup){var b=a._settings,d=a.popup,c=a.container,g=a.content_area,r=a.shadow,u=a.gallery_loading_area;d.stop(!0,!1);c.css("overflow-y","hidden");y(a);var j=0,i=0,e=0,h=0,f=0,l=0,n=0,k=r.width(),s=c.outerHeight(!1),h=e=i=0,e=r=!1;if(b.autoScale&&"ready"==a._properties.gallery.status)g.css({height:"100%",width:"100%",overflow:"hidden"}),e=A(a),e.popup.css({height:"auto",width:"auto",top:"auto",left:"auto"}),e.content.attr("style",""),e.content.find("img").css({"max-width":"none",height:"auto",display:"block"}),e.content.find("iframe").css({"max-height":"none","max-width":"none"}),h=e.popup.width(),f=e.popup.height(),l=e.popup.outerWidth(!1)-h,n=e.popup.outerHeight(!1)-f,e&&e.container&&e.container.remove(),i=0.8*k-l,e=0.8*s-n,i>b.maxwidth&&(i=b.maxwidth),e>b.maxheight&&(e=b.maxheight),f>e||h>i?f/h>e/i?(i=e,j=h*(e/f)):(j=i,i=f*(i/h)):(j=h,i=f);else{i=0.8*k;e=0.8*s;l=d.outerWidth(!1)-d.width();n=d.outerHeight(!1)-d.height();j=i-l;i=e-n;e=A(a);e.popup.css({height:"auto",width:"auto",top:"0",left:"0"});e.content.attr("style","");e.gallery_loading_area.attr("style","");h=e.content;"ready"==a._properties.gallery.status?(e.content.css("display","block"),e.gallery_loading_area.css("display","none")):(e.content.css("display","none"),e.gallery_loading_area.css("display","block"),g=u,h=e.gallery_loading_area);if(t(b.width))j=b.width;else if((b.scaleToContent||"ready"!=a._properties.gallery.status)&&e.popup.width()<j)j=e.popup.width();t(b.maxwidth)&&j>b.maxwidth&&(j=b.maxwidth);e.popup.css({width:j});t(b.height)?i=b.height:b.innerOverflow||(i=e.popup.height());t(b.maxheight)&&i>b.maxheight&&(i=b.maxheight);0==parseInt(h.css("margin-top"))&&h.css({"margin-top":"-1px",top:"1px"});var u=h.outerHeight(!0),f=u-h.height(),p=parseInt(e.popup.css("padding-top")),q=parseInt(e.popup.css("border-top-width")),v=parseInt(e.popup.css("margin-top"));isNaN(p)&&(p=0);isNaN(q)&&(q=0);isNaN(v)&&(v=0);h=i-(h.position().top-(p+q+v));!a._properties.newopen&&0<b.animateSpeed?g.stop(!0,!1).height(g.height()).animate({height:h-f},b.animateSpeed):g.stop(!0,!1).css({height:h-f});u>h&&b.innerOverflow&&g.css("overflow-y","scroll");e&&e.container&&e.container.remove();h=0.05*s;e=i+n;e>0.9*s?(r=h,c.css("overflow-y","scroll"),a.bottom_push.css({top:h+e+"px",height:h+"px",width:"1px"}),a.shadow.css({height:2*h+e+"px"})):(a.bottom_push.css({top:"0px",height:"0px",width:"0px"}),a.shadow.css({height:"100%"}))}c=(k-(j+l))/2;n=(s-(i+n))/2;!1!==r&&(n=r);!a._properties.newopen&&0<b.animateSpeed?d.animate({left:c,top:n,width:j,height:i},b.animateSpeed,function(){B(a)}).css("overflow",""):(d.css({left:c,top:n,width:j,height:i}),B(a))}}function D(a){"gallery"==a._settings.mode&&(a.content_area.show(),a.gallery_loading_area.hide(),a._properties.gallery.status="ready")}function E(a){var a=m(a,!1),b=!0;if(a&&a.popup){var d=a._properties.loaded_images;if(d.length)for(var c=0;c<d.length;c++){var g=d[c];!g.complete&&(4!==g.readyState&&"complete"!==g.readyState)&&(b=!1)}}b&&D(a);return b}function H(a){if((a=m(a,!1))&&a.popup){a._properties.loaded_images=[];var b=a.popup.find("img");if(0<b.length){var d=a;if("gallery"==d._settings.mode){var c=f(d._settings.gallery.loading,!0)?d._settings.gallery.loading:d._defaultSettings.gallery.loading;d.content_area.hide();d.gallery_loading_area.show();d.gallery_loading_area.html(c);d._properties.gallery.status="loading"}var g=0;b.each(function(b,c){if(c.src){var d=new Image;c.complete||4===c.readyState||"complete"===c.readyState?g++:("undefined"!==typeof d.onload?d.onload=function(){setTimeout(function(){E(a)&&a.adjust(!0)},10)}:"undefined"!==typeof d.onreadystatechange&&(d.onreadystatechange=function(){setTimeout(function(){E(a)&&a.adjust(!0)},10)}),"undefined"!==typeof d.onerror&&(d.onerror=function(){l(c).remove();var b=a;if("gallery"==b._settings.mode){var d=f(b._settings.gallery.error,!0)?b._settings.gallery.error:b._defaultSettings.gallery.error;b.content_area.hide();b.gallery_loading_area.show();b.gallery_loading_area.html(d);b._properties.gallery.status="error";b.adjust(!0)}}));d.src=c.src;a._properties.loaded_images.push(d)}});if(b.length==g)return!0}else return!0}return!1}function F(a){G(a);"gallery"==a._settings.mode&&(a._settings.autoScale=!0);a.content_area.find("img").hide();if(a._settings.gallery.name){var b=l("."+a._settings.gallery.name);if(b.length&&(b.each(function(){var b=l(this);if(0==b.closest(".popbox-container").length){var c=p(b,"src"),b=p(b,"href");(c=c?c:b)&&-1==w(c,a._properties.gallery.images)&&a._properties.gallery.images.push(c)}}),0<a._properties.gallery.images.length)){var b="",d=a.content_area.find("img:first");d.length&&(b=p(d.eq(0),"src"));d=w(b,a._properties.gallery.images);a._properties.gallery.position=0;""==b||-1==d?a._properties.gallery.images.unshift(b):-1<d&&(a._properties.gallery.position=d);var c=a;if((c=m(c,!1))&&c.popup&&1<c._properties.gallery.images.length){c.popup.append('<a href="#" class="popbox-gallery-next">&nbsp;'+c._settings.gallery.next+"</a>");c.gallery_next=c.popup.find(".popbox-gallery-next");c.popup.append('<a href="#" class="popbox-gallery-prev">'+c._settings.gallery.prev+"&nbsp;</a>");c.gallery_prev=c.popup.find(".popbox-gallery-prev");var g=!1,f=!1;c.gallery_next.click(function(a){a.preventDefault();c._properties.gallery.position++;c._properties.gallery.position>=c._properties.gallery.images.length&&(c._properties.gallery.position=0);z(c)}).mousemove(function(){g||(c.gallery_next.addClass("popbox-btn-hover"),g=!0,setTimeout(function(){g=!1},200))}).mouseleave(function(){c.gallery_next.removeClass("popbox-btn-hover")});c.gallery_prev.click(function(a){a.preventDefault();c._properties.gallery.position--;0>c._properties.gallery.position&&(c._properties.gallery.position=c._properties.gallery.images.length-1);z(c)}).mousemove(function(){f||(c.gallery_prev.addClass("popbox-btn-hover"),f=!0,setTimeout(function(){f=!1},200))}).mouseleave(function(){c.gallery_prev.removeClass("popbox-btn-hover")})}}}}function G(a){a.content_area.show();a.gallery_loading_area.hide();a._properties.gallery.status="ready";a._properties.gallery.images=[];a._properties.gallery.position=0;if((a=m(a,!1))&&a.popup)a.gallery_next&&a.gallery_next.remove(),a.gallery_prev&&a.gallery_prev.remove(),a.gallery_next=!1,a.gallery_prev=!1}null!=RegExp&&null==RegExp.escape&&(RegExp.escape=function(a){return a.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")});var k=function(a){a=m(a,{});this.$window=l(window);this.$html=l("html");this.$body=l("body");this._settings=l.extend(!0,{},this._defaultSettings,a);this.shadow=this.popup=this.container=!1;this._properties={animating:!1,isopen:!1,newopen:!0,newopentime:0,resizepause:!1,loaded_content:-1,loaded_images:[],stored_styles:{htmlOverflow:"",htmlHeight:"",htmlMarginRight:""},gallery:{status:"ready",images:[],position:0}}};k.prototype.adjust=function(a){var a=m(a,!1),b=this;if(b._properties.isopen&&(a||!b._properties.resizepause)){var d=!1;b._properties.loaded_content!==b._settings.content&&(d=H(b),b._properties.loaded_content=b._settings.content);d&&D(b);if(b._properties.newopen)C(b),b._properties.newopen=!1;else{var d=1,c="normal";"gallery"==b._settings.mode&&"loading"==b._properties.gallery.status?(d=100,c="loading"):a||(d=b._settings.updatePositionDelay);b._properties.resizepause=!0;b._properties.resizetimer=setTimeout(function(){if("normal"==c||"loading"==c&&"error"!=b._properties.gallery.status)C(b),b._properties.resizepause=!1,b._properties.resizetimer=!1},d)}}};k.prototype.refresh=function(){this._properties.loaded_content=-1;this._properties.loaded_images=[]};k.prototype.close=function(){var a=this;if(!a._properties.animating&&a._properties.isopen){if("function"===typeof a._settings.onClose)a._settings.onClose(a);a._properties.animating=!0;a.container.fadeOut(a._settings.fadeOutSpeed,function(){x(a,"close")});a.$window.off("resize.popbox.adjust");a._properties.isopen=!1;a.refresh();"gallery"==a._settings.mode&&a.update({content:""},!1);"function"===typeof a._settings.afterClose&&a._settings.afterClose(a)}};k.prototype.open=function(){var a=this;a.refresh();if(!a._properties.animating&&!a._properties.isopen){if("function"===typeof a._settings.onOpen)a._settings.onOpen(a);a._properties.animating=!0;var b=f(this._settings.close,!0)?a._settings.close:a._defaultSettings.close,d=f(this._settings.content,!0)?a._settings.content:"",c=f(this._settings.title,!0)?'<div class="popbox-title">'+a._settings.title+"</div>":"",g=f(this._settings.customClass,!0)?" "+a._settings.customClass:"",m=f(this._settings.gallery.loading,!0)?a._settings.gallery.loading:a._defaultSettings.gallery.loading;a._properties.stored_styles.htmlOverflow=q(a.$html,"overflow");a._properties.stored_styles.htmlHeight=q(a.$html,"height");a._properties.stored_styles.htmlMarginRight=q(a.$html,"margin-right");var k=a.$body.width();a.$html.css({overflow:"hidden",height:"100%"});var j=a.$body.width();j>k&&a.$html.css({"margin-right":j-k+"px"});a.$body.append('<div class="popbox-container'+g+'" style="display: none;"><div class="popbox-bottom-push"></div><a class="popbox-shadow" href="javascript:void(0);"></a><div class="popbox-popup">'+c+'<div class="popbox-content">'+d+'</div><div class="popbox-gallery-loading">'+m+'</div><a href="#" class="popbox-close">'+b+"</a></div></div>");a.container=l(".popbox-container");a.popup=a.container.find(".popbox-popup");a.shadow=a.container.find(".popbox-shadow");a.bottom_push=a.container.find(".popbox-bottom-push");a.close_button=a.container.find(".popbox-close");a.title_area=a.container.find(".popbox-title");a.content_area=a.container.find(".popbox-content");a.gallery_loading_area=a.container.find(".popbox-gallery-loading");a.container.css({display:"none",height:"100%",width:"100%",position:"fixed",left:"0px",top:"0px","z-index":"990","background-color":"rgba(0,0,0,0.4)","overflow-x":"hidden"});a.bottom_push.css({display:"block",position:"absolute",left:"0px",top:"0px",height:"0px",width:"1px","z-index":"992"});a.popup.css({display:"block",position:"absolute",top:"0px",left:"0px","z-index":"993","-webkit-box-sizing":"content-box","-moz-box-sizing":"content-box","box-sizing":"content-box"});a.shadow.css({display:"block",position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%","z-index":"991",background:"#fff",opacity:"0",cursor:"default"});a.content_area.css({overflow:"hidden",height:"auto"});a.gallery_loading_area.css({overflow:"hidden",height:"auto"});"gallery"==a._settings.mode&&F(a);a.container.fadeIn(a._settings.fadeInSpeed,function(){x(a,"open")});a.shadow.click(function(b){a.close();b.preventDefault()});a.close_button.click(function(b){a.close();b.preventDefault()});a.$window.on("resize.popbox.adjust",function(){a.adjust()});a._properties.isopen=!0;a._properties.newopen=!0;a._properties.newopentime=(new Date).getTime();a.adjust();"function"===typeof a._settings.afterOpen&&a._settings.afterOpen(a)}};k.prototype.update=function(a,b){a=m(a,{});b=m(b,!0);this._settings=l.extend(!0,{},this._settings,a);if(this._properties.isopen){var d=f(this._settings.close,!0)?this._settings.close:this._defaultSettings.close,c=f(this._settings.content,!0)?this._settings.content:"",g=f(this._settings.title,!0)?this._settings.title:"";0<this.close_button.length&&this.close_button.html(d);0<this.content_area.length&&this.content_area.html(c);0<this.title_area.length?""!=g?this.title_area.html(g):(this.title_area.remove(),this.title_area=this.popup.find(".popbox-title")):""!=g&&(this.popup.prepend('<div class="popbox-title">'+g+"</div>"),this.title_area=this.popup.find(".popbox-title"));"gallery"==this._settings.mode?F(this):G(this);b?this.adjust(!0):y(this)}};k.prototype.isOpen=function(){return!0==this._properties.isopen};k.prototype.isClose=function(){return!1==this._properties.isopen};k.prototype._defaultSettings={width:"auto",height:"auto",maxwidth:"none",maxheight:"none",innerOverflow:!1,scaleToContent:!1,content:"",close:"X",title:"",onOpen:!1,onClose:!1,afterOpen:!1,afterClose:!1,fadeInSpeed:400,fadeOutSpeed:400,updatePositionDelay:200,autoScale:!1,customClass:"",animateSpeed:400,mode:"normal",gallery:{loading:'<div style="padding:10px;">Loading...</div>',error:'<div style="padding:10px;">There was an error loading the image.</div>',name:"",next:"<span>&#x25B6;</span>",prev:"<span>&#x25C0;</span>"}};window.PopBox=k})(jQuery);