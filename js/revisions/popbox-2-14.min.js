(function(l){function m(a,b){return"undefined"!==typeof a?a:b}function u(a,b){b=m(b,!1);return!isNaN(a-0)&&null!=a&&""!=a&&(!b||0<a)}function j(a,b){b=m(b,!1);return"string"===typeof a&&null!=a&&(!b||""!=a)}function q(a,b){var c=a.attr(b);if("undefined"===typeof c||!1===c||""===c)c="";return c}function w(a,b,c){c=c||!1;if(b instanceof Array)for(var f=0;f<b.length;f++)if(c){if(b[f]===a)return f}else if(b[f]==a)return f;return-1}function r(a,b){var c=q(a,"style");if(b&&c){var f=RegExp("(^|;)\\s*"+RegExp.escape(b)+"\\s*:");if(c.match(f))return a.css(b)}return""}function x(a,b){if(a._properties.animating)switch(a._properties.animating=!1,b){case "close":a.container.remove();a.container=!1;a._properties.isopen=!1;a.popup=!1;a.shadow=!1;a.$html.css({overflow:a._properties.stored_styles.htmlOverflow,height:a._properties.stored_styles.htmlHeight,"margin-right":a._properties.stored_styles.htmlMarginRight});break;case "open":a._properties.isopen=!0}}function y(a){a.popup.find("img").css({"max-width":"100%",height:"auto"}).filter(":visible").css({display:"block"});a.popup.find("iframe").css({"max-height":"100%","max-width":"100%"})}function z(a){(a=m(a,!1))&&a.popup&&a.update({content:'<img src="'+a._properties.gallery.images[a._properties.gallery.position]+'" style="display:none;" />'})}function A(a){var b=a.container.clone().stop(!0,!0).addClass("popbox-rsc-clone").css({display:"block",visibility:"hidden","z-index":"-1",overflow:"hidden"});b.find("iframe").attr("src","");b.appendTo(a.$body);a=a.$body.find(".popbox-rsc-clone");return{container:a,popup:a.find(".popbox-popup").eq(0),content:a.find(".popbox-content").eq(0),gallery_loading_area:a.find(".popbox-gallery-loading").eq(0)}}function B(a){if((a=m(a,!1))&&a.popup)"gallery"==a._settings.mode&&"ready"==a._properties.gallery.status&&a.content_area.find("img:hidden").fadeIn(300),a.popup.find(".popbox-btn-hover").removeClass("popbox-btn-hover")}function C(a){if((a=m(a,!1))&&a.popup){var b=a._settings,c=a.popup,f=a.container,i=a.content_area,j=a.shadow,s=a.gallery_loading_area;c.stop(!0,!1);f.css("overflow-y","hidden");y(a);var e=0,g=0,d=0,h=0,n=0,l=0,p=0,k=j.width(),t=f.outerHeight(!1),h=d=g=0,d=j=!1;if(b.autoScale&&"ready"==a._properties.gallery.status)i.css({height:"100%",width:"100%",overflow:"hidden"}),d=A(a),d.popup.css({height:"auto",width:"auto",top:"auto",left:"auto"}),d.content.attr("style",""),d.content.find("img").css({"max-width":"none",height:"auto",display:"block"}),d.content.find("iframe").css({"max-height":"none","max-width":"none"}),h=d.popup.width(),n=d.popup.height(),l=d.popup.outerWidth(!1)-h,p=d.popup.outerHeight(!1)-n,d&&d.container&&d.container.remove(),g=0.8*k-l,d=0.8*t-p,g>b.maxwidth&&(g=b.maxwidth),d>b.maxheight&&(d=b.maxheight),n>d||h>g?n/h>d/g?(g=d,e=h*(d/n)):(e=g,g=n*(g/h)):(e=h,g=n);else{g=0.8*k;d=0.8*t;l=c.outerWidth(!1)-c.width();p=c.outerHeight(!1)-c.height();e=g-l;g=d-p;d=A(a);d.popup.css({height:"auto",width:"auto",top:"0",left:"0"});d.content.attr("style","");d.gallery_loading_area.attr("style","");h=d.content;"ready"==a._properties.gallery.status?(d.content.css("display","block"),d.gallery_loading_area.css("display","none")):(d.content.css("display","none"),d.gallery_loading_area.css("display","block"),i=s,h=d.gallery_loading_area);if(u(b.width))e=b.width;else if((b.scaleToContent||"ready"!=a._properties.gallery.status)&&d.popup.width()<e)e=d.popup.width();u(b.maxwidth)&&e>b.maxwidth&&(e=b.maxwidth);d.popup.css({width:e});u(b.height)?g=b.height:b.innerOverflow||(g=d.popup.height());u(b.maxheight)&&g>b.maxheight&&(g=b.maxheight);0==parseInt(h.css("margin-top"))&&h.css({"margin-top":"-1px",top:"1px"});var s=h.outerHeight(!0),n=s-h.height(),q=parseInt(d.popup.css("padding-top")),r=parseInt(d.popup.css("border-top-width")),v=parseInt(d.popup.css("margin-top"));isNaN(q)&&(q=0);isNaN(r)&&(r=0);isNaN(v)&&(v=0);h=g-(h.position().top-(q+r+v));!a._properties.newopen&&0<b.animateSpeed?i.stop(!0,!1).height(i.height()).animate({height:h-n},b.animateSpeed):i.stop(!0,!1).css({height:h-n});s>h&&b.innerOverflow&&i.css("overflow-y","scroll");d&&d.container&&d.container.remove();h=0.05*t;d=g+p;d>0.9*t?(j=h,f.css("overflow-y","scroll"),a.bottom_push.css({top:h+d+"px",height:h+"px",width:"1px"}),a.shadow.css({height:2*h+d+"px"})):(a.bottom_push.css({top:"0px",height:"0px",width:"0px"}),a.shadow.css({height:"100%"}))}f=(k-(e+l))/2;p=(t-(g+p))/2;!1!==j&&(p=j);!a._properties.newopen&&0<b.animateSpeed?c.animate({left:f,top:p,width:e,height:g},b.animateSpeed,function(){B(a)}).css("overflow",""):(c.css({left:f,top:p,width:e,height:g}),B(a))}}function D(a){"gallery"==a._settings.mode&&(a.content_area.show(),a.gallery_loading_area.hide(),a._properties.gallery.status="ready")}function E(a){var a=m(a,!1),b=!0;if(a&&a.popup){var c=a._properties.loaded_images;if(c.length)for(var f=0;f<c.length;f++){var i=c[f];!i.complete&&(4!==i.readyState&&"complete"!==i.readyState)&&(b=!1)}}b&&D(a);return b}function F(a){if((a=m(a,!1))&&a.popup){a._properties.loaded_images=[];var b=a.popup.find("img");if(0<b.length){var c=a;if("gallery"==c._settings.mode){var f=j(c._settings.gallery.loading,!0)?c._settings.gallery.loading:c._defaultSettings.gallery.loading;c.content_area.hide();c.gallery_loading_area.show();c.gallery_loading_area.html(f);c._properties.gallery.status="loading"}var i=0;b.each(function(b,c){if(c.src){var e=new Image;c.complete||4===c.readyState||"complete"===c.readyState?i++:("undefined"!==typeof e.onload?e.onload=function(){setTimeout(function(){E(a)&&a.adjust(!0)},10)}:"undefined"!==typeof e.onreadystatechange&&(e.onreadystatechange=function(){setTimeout(function(){E(a)&&a.adjust(!0)},10)}),"undefined"!==typeof e.onerror&&(e.onerror=function(){l(c).remove();var b=a;if("gallery"==b._settings.mode){var d=j(b._settings.gallery.error,!0)?b._settings.gallery.error:b._defaultSettings.gallery.error;b.content_area.hide();b.gallery_loading_area.show();b.gallery_loading_area.html(d);b._properties.gallery.status="error";b.adjust(!0)}}));e.src=c.src;a._properties.loaded_images.push(e)}});if(b.length==i)return!0}else return!0}return!1}null!=RegExp&&null==RegExp.escape&&(RegExp.escape=function(a){return a.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")});var k=function(a){a=m(a,{});"gallery"==a.mode&&null==a.autoScale&&(a.autoScale=!0);this.$window=l(window);this.$html=l("html");this.$body=l("body");this._settings=l.extend(!0,{},this._defaultSettings,a);this.shadow=this.popup=this.container=!1;this._properties={animating:!1,isopen:!1,newopen:!0,newopentime:0,resizepause:!1,loaded_content:-1,loaded_images:[],stored_styles:{htmlOverflow:"",htmlHeight:"",htmlMarginRight:""},gallery:{status:"ready",images:[],position:0}}};k.prototype.adjust=function(a){var a=m(a,!1),b=this;if(b._properties.isopen&&(a||!b._properties.resizepause)){var c=!1;b._properties.loaded_content!==b._settings.content&&(c=F(b),b._properties.loaded_content=b._settings.content);c&&D(b);if(b._properties.newopen)C(b),b._properties.newopen=!1;else{var c=1,f="normal";"gallery"==b._settings.mode&&"loading"==b._properties.gallery.status?(c=100,f="loading"):a||(c=b._settings.updatePositionDelay);b._properties.resizepause=!0;b._properties.resizetimer=setTimeout(function(){if("normal"==f||"loading"==f&&"error"!=b._properties.gallery.status)C(b),b._properties.resizepause=!1,b._properties.resizetimer=!1},c)}}};k.prototype.refresh=function(){this._properties.loaded_content=-1;this._properties.loaded_images=[]};k.prototype.close=function(){var a=this;if(!a._properties.animating&&a._properties.isopen){if("function"===typeof a._settings.onClose)a._settings.onClose(a);a._properties.animating=!0;a.container.fadeOut(a._settings.fadeOutSpeed,function(){x(a,"close")});a.$window.off("resize.popbox.adjust");a._properties.isopen=!1;a.refresh();"gallery"==a._settings.mode&&a.update({content:""},!1);"function"===typeof a._settings.afterClose&&a._settings.afterClose(a)}};k.prototype.open=function(){var a=this;a.refresh();if(!a._properties.animating&&!a._properties.isopen){if("function"===typeof a._settings.onOpen)a._settings.onOpen(a);a._properties.animating=!0;var b=j(this._settings.close,!0)?a._settings.close:a._defaultSettings.close,c=j(this._settings.content,!0)?a._settings.content:"",f=j(this._settings.title,!0)?'<div class="popbox-title">'+a._settings.title+"</div>":"",i=j(this._settings.customClass,!0)?" "+a._settings.customClass:"";a._properties.stored_styles.htmlOverflow=r(a.$html,"overflow");a._properties.stored_styles.htmlHeight=r(a.$html,"height");a._properties.stored_styles.htmlMarginRight=r(a.$html,"margin-right");var k=a.$body.width();a.$html.css({overflow:"hidden",height:"100%"});var s=a.$body.width();s>k&&a.$html.css({"margin-right":s-k+"px"});a.$body.append('<div class="popbox-container'+i+'" style="display: none;"><div class="popbox-bottom-push"></div><a class="popbox-shadow" href="javascript:void(0);"></a><div class="popbox-popup">'+f+'<div class="popbox-content">'+c+'</div><a href="#" class="popbox-close">'+b+"</a></div></div>");a.container=l(".popbox-container");a.popup=a.container.find(".popbox-popup");a.shadow=a.container.find(".popbox-shadow");a.bottom_push=a.container.find(".popbox-bottom-push");a.close_button=a.container.find(".popbox-close");a.title_area=a.container.find(".popbox-title");a.content_area=a.container.find(".popbox-content");a.gallery_loading_area=!1;a.container.css({display:"none",height:"100%",width:"100%",position:"fixed",left:"0px",top:"0px","z-index":"990","background-color":"rgba(0,0,0,0.4)","overflow-x":"hidden"});a.bottom_push.css({display:"block",position:"absolute",left:"0px",top:"0px",height:"0px",width:"1px","z-index":"992"});a.popup.css({display:"block",position:"absolute",top:"0px",left:"0px","z-index":"993","-webkit-box-sizing":"content-box","-moz-box-sizing":"content-box","box-sizing":"content-box"});a.shadow.css({display:"block",position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%","z-index":"991",background:"#fff",opacity:"0",cursor:"default"});a.content_area.css({overflow:"hidden",height:"auto"});if("gallery"==a._settings.mode&&(a.content_area.hide().find("img").hide(),b=j(this._settings.gallery.loading,!0)?a._settings.gallery.loading:a._defaultSettings.gallery.loading,a.content_area.after('<div class="popbox-gallery-loading">'+b+"</div>"),a.gallery_loading_area=a.container.find(".popbox-gallery-loading"),a.gallery_loading_area.css({overflow:"hidden",height:"auto"}),a._settings.gallery.name&&(b=l("."+a._settings.gallery.name),b.length&&(b.each(function(){var b=l(this);if(0==b.closest(".popbox-container").length){var c=q(b,"src"),b=q(b,"href");(c=c?c:b)&&-1==w(c,a._properties.gallery.images)&&a._properties.gallery.images.push(c)}}),0<a._properties.gallery.images.length)))){b="";c=a.content_area.find("img:first");c.length&&(b=q(c.eq(0),"src"));c=w(b,a._properties.gallery.images);a._properties.gallery.position=0;""==b||-1==c?a._properties.gallery.images.unshift(b):-1<c&&(a._properties.gallery.position=c);var e=a;if((e=m(e,!1))&&e.popup){e.popup.append('<a href="#" class="popbox-gallery-next">&nbsp;'+e._settings.gallery.next+"</a>");e.gallery_next=e.popup.find(".popbox-gallery-next");e.popup.append('<a href="#" class="popbox-gallery-prev">'+e._settings.gallery.prev+"&nbsp;</a>");e.gallery_prev=e.popup.find(".popbox-gallery-prev");var g=!1,d=!1;e.gallery_next.click(function(a){a.preventDefault();e._properties.gallery.position++;e._properties.gallery.position>=e._properties.gallery.images.length&&(e._properties.gallery.position=0);z(e)}).mousemove(function(){g||(e.gallery_next.addClass("popbox-btn-hover"),g=!0,setTimeout(function(){g=!1},200))}).mouseleave(function(){e.gallery_next.removeClass("popbox-btn-hover")});e.gallery_prev.click(function(a){a.preventDefault();e._properties.gallery.position--;0>e._properties.gallery.position&&(e._properties.gallery.position=e._properties.gallery.images.length-1);z(e)}).mousemove(function(){d||(e.gallery_prev.addClass("popbox-btn-hover"),d=!0,setTimeout(function(){d=!1},200))}).mouseleave(function(){e.gallery_prev.removeClass("popbox-btn-hover")})}}a.container.fadeIn(a._settings.fadeInSpeed,function(){x(a,"open")});a.shadow.click(function(b){a.close();b.preventDefault()});a.close_button.click(function(b){a.close();b.preventDefault()});a.$window.on("resize.popbox.adjust",function(){a.adjust()});a._properties.isopen=!0;a._properties.newopen=!0;a._properties.newopentime=(new Date).getTime();a.adjust();"function"===typeof a._settings.afterOpen&&a._settings.afterOpen(a)}};k.prototype.update=function(a,b){a=m(a,{});b=m(b,!0);this._settings=l.extend({},this._settings,a);if(this._properties.isopen){var c=j(this._settings.close,!0)?this._settings.close:this._defaultSettings.close,f=j(this._settings.content,!0)?this._settings.content:"",i=j(this._settings.title,!0)?this._settings.title:"";0<this.close_button.length&&this.close_button.html(c);0<this.content_area.length&&this.content_area.html(f);0<this.title_area.length?""!=i?this.title_area.html(i):(this.title_area.remove(),this.title_area=this.popup.find(".popbox-title")):""!=i&&(this.popup.prepend('<div class="popbox-title">'+i+"</div>"),this.title_area=this.popup.find(".popbox-title"));b?this.adjust(!0):y(this)}};k.prototype.isOpen=function(){return!0==this._properties.isopen};k.prototype.isClose=function(){return!1==this._properties.isopen};k.prototype._defaultSettings={width:"auto",height:"auto",maxwidth:"none",maxheight:"none",innerOverflow:!1,scaleToContent:!1,content:"",close:"X",title:"",onOpen:!1,onClose:!1,afterOpen:!1,afterClose:!1,fadeInSpeed:400,fadeOutSpeed:400,updatePositionDelay:200,autoScale:!1,customClass:"",animateSpeed:400,mode:"normal",gallery:{loading:'<div style="padding:10px;">Loading...</div>',error:'<div style="padding:10px;">There was an error loading the image.</div>',name:"",next:"<span>&#x25B6;</span>",prev:"<span>&#x25C0;</span>"}};window.PopBox=k})(jQuery);