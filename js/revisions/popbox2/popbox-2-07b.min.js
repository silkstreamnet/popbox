(function(p){function l(a,b){return"undefined"!==typeof a?a:b}function r(a,b){b=l(b,!1);return!isNaN(a-0)&&null!=a&&""!=a&&(!b||0<a)}function i(a,b){b=l(b,!1);return"string"===typeof a&&null!=a&&(!b||""!=a)}function u(a,b){if(a.properties.animating)switch(a.properties.animating=!1,b){case "close":a.container.remove();a.properties.isopen=!1;a.container=!1;a.popup=!1;a.shadow=!1;break;case "open":a.properties.isopen=!0}}function t(a,b){var a=l(a,!1),b=l(b,!1),m=!0;if(a&&a.popup){var c=a.popup.find("img");0<c.length&&c.each(function(a,b){b.complete||(m=!1)})}b&&m&&v(a);return m}function v(a,b){b=l(b,!1);if(a=l(a,!1)){var m=a.popup,c={forceAbsolute:!1,container:window,completeHandler:null,animate:!0,width:"auto",height:"auto",maxwidth:"none",maxheight:"none",push_obj:!1,shadow:!1,autoScale:!1,innerOverflow:!1};p.extend(c,{animate:b,container:a.container,width:a.settings.width,height:a.settings.height,maxwidth:a.settings.maxwidth,maxheight:a.settings.maxheight,push_obj:a.bottom_push,shadow:a.shadow,autoScale:a.settings.autoScale,innerOverflow:a.settings.innerOverflow});m.each(function(){var a=p(this),b=p(c.container),h=c.container==window,j=p("body");c.forceAbsolute&&(h?a.remove().appendTo(j):a.remove().appendTo(b.get(0)));var l={position:a.css("position"),visibility:a.css("visibility"),display:a.css("display")},e={visibility:b.css("visibility"),display:b.css("display")},i={visibility:"hidden",display:"block"};a.css({position:"absolute",visibility:"hidden",display:"block"});h||b.css(i);var f=0,d=0,k=0,g,n,q,i=!1;if(c.autoScale)f="rsc-clone-"+(Math.floor(9E3*Math.random())+1E3),d=a.clone().addClass(f).css({height:"auto",width:"auto",top:"auto",left:"auto",position:"absolute",display:"block",visibility:"hidden"}),d.find("img").css({"max-width":"none",height:"auto",display:"block"}),d.find("iframe").css({"max-height":"none","max-width":"none"}).attr("src",""),d.appendTo(j),f=j.find("."+f).wrap('<div style="height:0;width:0;position:absolute;left:0;top:0;"></div>'),k=f.width(),n=f.height(),j=f.outerWidth(!1)-k,q=f.outerHeight(!1)-n,f.parent().remove(),d=0.8*(h?b.width():b.outerWidth(!1))-j,g=0.8*(h?b.height():b.outerHeight(!1))-q,n>g||k>d?n/k>g/d?(d=g,f=k*(g/n)):(f=d,d=n*(d/k)):(f=k,d=n),a.find("img").css({"max-width":"100%",height:"auto",display:"block"}),a.find("iframe").css({"max-height":"100%","max-width":"100%"});else{d=0.8*(h?b.width():b.outerWidth(!1));g=0.8*(h?b.height():b.outerHeight(!1));j=a.outerWidth(!1)-a.width();q=a.outerHeight(!1)-a.height();f=d-j;d=g-q;r(c.width)?f=c.width:r(c.maxwidth)&&f>c.maxwidth&&(f=c.maxwidth);if(r(c.height))d=c.height;else if(c.innerOverflow||r(c.maxheight))if(r(c.maxheight)&&d>c.maxheight&&(d=c.maxheight),g=a.find(".popbox-content"),1==g.length){g.css({"overflow-y":"",height:"",position:"relative"});0==parseInt(g.css("margin-top"))&&g.css({"margin-top":"-1px",top:"1px"});k=g.outerHeight(!0);n=k-g.height();var s=parseInt(a.css("padding-top"))+parseInt(a.css("border-top-width"))+parseInt(a.css("margin-top")),s=d-(g.position().top-s);k>s&&(g.css("overflow-y","scroll"),g.height(s-n))}n=0.05*(h?b.height():b.outerHeight(!1));g=0.9*(h?b.height():b.outerHeight(!1));k=d+q;k>g?(i=n,b.css("overflow","auto"),c.push_obj.css({top:n+k+"px",height:n+"px",width:"1px"}),c.shadow.css({height:2*n+k+"px"})):(b.css("overflow",""),c.push_obj.css({top:"0px",height:"0px",width:"0px"}),c.shadow.css({height:"100%"}))}k=d+q;j=((h?b.width():b.outerWidth(!1))-(f+j))/2;q=((h?b.height():b.outerHeight(!1))-k)/2;!1!==i&&(q=i);h&&(j+=b.scrollLeft(),q+=b.scrollTop());a.css(l);h||b.css(e);!0===c.animate?a.stop(!0,!1).animate({left:j,top:q,width:f,height:d},500).css("overflow",""):a.stop(!0,!1).css({left:j,top:q,width:f,height:d});c.completeHandler&&c.completeHandler(m)})}}var e=function(a){a=l(a,{});this.settings=p.extend({},this.defaultSettings,a);this.shadow=this.container=!1;this.properties={animating:!1,isopen:!1,resizepause:!1,loaded_content:-1}};e.prototype.adjust=function(a){var a=l(a,!1),b=this;if(!b.properties.resizepause&&(!a||b.properties.isopen))if(b.properties.resizepause=!0,setTimeout(function(){v(b,a);b.properties.resizepause=!1},b.properties.updatePositionDelay),b.properties.loaded_content!==b.settings.content){if(!t(b)){var m=b;if((m=l(m,!1))&&m.popup){var c=m.popup.find("img");if(0<c.length){var i=0;c.each(function(a,b){b.complete?i++:p(b).load(function(){t(m,!0)})});c.length==i&&t(m,!0)}}}b.properties.loaded_content=b.settings.content}};e.prototype.checkImages=function(){this.properties.loaded_content=-1};e.prototype.close=function(){var a=this;if(!a.properties.animating&&a.properties.isopen){if("function"===typeof a.settings.onClose)a.settings.onClose(a);a.properties.animating=!0;a.container.fadeOut(a.settings.fadeOutSpeed,function(){u(a,"close");p("body").css({overflow:"","margin-right":""})});p(window).off("resize.popbox.adjust");a.properties.isopen=!1;a.checkImages();"function"===typeof a.settings.afterClose&&a.settings.afterClose(a)}};e.prototype.open=function(){var a=this;if(!a.properties.animating&&!a.properties.isopen){if("function"===typeof a.settings.onOpen)a.settings.onOpen(a);a.properties.animating=!0;var b=i(this.settings.close,!0)?a.settings.close:this.defaultSettings.close,m=i(this.settings.content,!0)?a.settings.content:"",c=i(this.settings.title,!0)?'<div class="popbox-title">'+a.settings.title+"</div>":"",l=i(this.settings.customClass,!0)?" "+a.settings.customClass:"",e=p("body"),h=e.width();e.css("overflow","hidden");var j=e.width();j>h&&(h=parseInt(e.css("margin-right"))+(j-h),e.css("margin-right",h+"px"));e.append('<div class="popbox-container'+l+'" style="display: none;"><div class="popbox-bottom-push"></div><a class="popbox-shadow" href="javascript:void(0);"></a><div class="popbox-popup">'+c+'<a class="popbox-close">'+b+'</a><div class="popbox-content">'+m+"</div></div></div>");a.container=p(".popbox-container");a.popup=a.container.find(".popbox-popup");a.shadow=a.container.find(".popbox-shadow");a.bottom_push=a.container.find(".popbox-bottom-push");a.close_button=a.container.find(".popbox-close");a.title_area=a.container.find(".popbox-title");a.content_area=a.container.find(".popbox-content");a.container.css({display:"none",height:"100%",width:"100%",position:"fixed",left:"0px",top:"0px","z-index":"990","background-color":"rgba(0,0,0,0.4)"});a.bottom_push.css({display:"block",position:"absolute",left:"0px",top:"0px",height:"0px",width:"1px","z-index":"992"});a.popup.css({display:"block",visibility:"visible",position:"absolute",top:"0px",left:"0px","z-index":"993"});a.shadow.css({display:"block",position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%","z-index":"991",background:"#fff",opacity:"0",filter:"alpha(opacity=0)",cursor:"default"});a.adjust();a.container.fadeIn(a.settings.fadeInSpeed,function(){u(a,"open")});a.shadow.click(function(b){a.close();b.preventDefault()});a.close_button.click(function(b){a.close();b.preventDefault()});p(window).on("resize.popbox.adjust",function(){a.adjust(!0)});a.properties.isopen=!0;"function"===typeof a.settings.afterOpen&&a.settings.afterOpen(a)}};e.prototype.update=function(a,b){a=l(a,{});b=l(b,!0);this.settings=p.extend({},this.settings,a);if(this.properties.isopen){var e=i(this.settings.close,!0)?this.settings.close:this.defaultSettings.close,c=i(this.settings.content,!0)?this.settings.content:"",r=i(this.settings.title,!0)?this.settings.title:"";0<this.close_button.length&&this.close_button.html(e);0<this.content_area.length&&this.content_area.html(c);0<this.title_area.length?""!=r?this.title_area.html(r):(this.title_area.remove(),this.title_area=this.popup.find(".popbox-title")):""!=r&&(this.popup.prepend('<div class="popbox-title">'+r+"</div>"),this.title_area=this.popup.find(".popbox-title"));b&&this.adjust(!0)}};e.prototype.isOpen=function(){return!0==this.properties.isopen};e.prototype.isClose=function(){return!1==this.properties.isopen};e.prototype.defaultSettings={width:"auto",height:"auto",maxwidth:"none",maxheight:"none",innerOverflow:!1,content:"",close:"X",title:"",onOpen:!1,onClose:!1,afterOpen:!1,afterClose:!1,fadeInSpeed:400,fadeOutSpeed:400,updatePositionDelay:200,autoScale:!1,customClass:""};window.PopBox=e})(jQuery);
