(function(j){function p(a,b){return"undefined"!==typeof a?a:b}function u(a,b){b=p(b,!1);return!isNaN(a-0)&&null!=a&&""!=a&&(!b||0<a)}function h(a,b){b=p(b,!1);return"string"===typeof a&&null!=a&&(!b||""!=a)}function q(a,b){var c=a.attr(b);if("undefined"===typeof c||!1===c||""===c)c="";return c}function r(a,b,c,d){var d=p(d,""),f;for(f in b)if(b.hasOwnProperty(f))if("object"===typeof b[f])c[f]={},r(a,b[f],c[f],d+f.toLowerCase()+"-");else{var k=a.data(d+f.toLowerCase());if("undefined"!==typeof k){var n=parseFloat(k);"true"==k?k=!0:"false"==k?k=!1:n==k&&(k=n);c[f]=k}}}function x(a,b,c){c=c||!1;if(b instanceof Array)for(var d=0;d<b.length;d++)if(c){if(b[d]===a)return d}else if(b[d]==a)return d;return-1}function s(a,b){var c=q(a,"style");if(b&&c){var d=RegExp("(^|;)\\s*"+b.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")+"\\s*:");if(c.match(d))return a.css(b)}return""}function y(a,b){if(a._properties.animating)switch(a._properties.animating=!1,b){case "close":a.container.remove();a.container=!1;a._properties.isopen=!1;a.popup=!1;a.shadow=!1;a.$html.css({overflow:a._properties.stored_styles.htmlOverflow,height:a._properties.stored_styles.htmlHeight,"margin-right":a._properties.stored_styles.htmlMarginRight});break;case "open":a._properties.isopen=!0}}function z(a){var b=a.popup.find("img"),c=a.popup.find("iframe");b.css({"max-width":"100%",height:"auto"});c.css({"max-height":"100%","max-width":"100%"});a._settings.autoScale&&(b.filter(":visible").css({display:"block"}),c.css({display:"block"}))}function A(a){(a=p(a,!1))&&a.popup&&a.update({content:'<img src="'+a._properties.gallery.images[a._properties.gallery.position]+'" style="display:none;" />'})}function B(a){var b=!1;a.content.find("img").each(function(){var a=j(this);if((0==a.width()||0==a.height())&&!1===this.complete)b=!0});return b}function C(a){var b="popbox-rsc-clone-"+(new Date).getTime(),c=a.container.clone().stop(!0,!0).addClass(b).css({display:"block",visibility:"hidden","z-index":"-1",overflow:"hidden"});c.find("iframe").attr("src","");c.appendTo(a.$body);a=a.$body.find("."+b);return{container:a,popup:a.find(".popbox-popup").eq(0),content:a.find(".popbox-content").eq(0),gallery_loading_area:a.find(".popbox-gallery-loading").eq(0)}}function t(a,b){b=p(b,"fixed");switch(b){case "fixed":a.container.css({position:"fixed",top:"0"});break;case "absolute":a.container.css({position:"absolute",top:a.container.offset().top})}}function D(a){if((a=p(a,!1))&&a.popup)"gallery"==a._settings.mode&&"ready"==a._properties.gallery.status&&a.content_area.find("img:hidden").fadeIn(300),a.popup.find(".popbox-btn-hover").removeClass("popbox-btn-hover"),a.$window.trigger("scroll.popbox")}function E(a){var a=p(a,!1),b=!0;if(a&&a.popup){var c=a._settings,d=a.popup,f=a.container,k=a.content_area,n=a.shadow,w=a.gallery_loading_area;d.stop(!0,!1);f.css("overflow-y","hidden");z(a);var l=0,g=0,e=0,i=0,j=0,m=0,h=0,q=n.width(),v=f.outerHeight(!1),i=e=g=0,e=n=!1;if(c.autoScale&&("gallery"!=a._settings.mode||"ready"==a._properties.gallery.status)){k.css({height:"100%",width:"100%",overflow:"hidden"});e=C(a);e.popup.css({height:"auto",width:"auto",top:"auto",left:"auto"});e.content.attr("style","");e.content.find("img").css({"max-width":"none",height:"auto",display:"block"});e.content.find("iframe").css({"max-height":"none","max-width":"none"});if(B(e))return!1;i=e.popup.width();j=e.popup.height();m=e.popup.outerWidth(!1)-i;h=e.popup.outerHeight(!1)-j;e&&e.container&&e.container.remove();g=0.8*q-m;e=0.8*v-h;g>c.maxwidth&&(g=c.maxwidth);e>c.maxheight&&(e=c.maxheight);j>e||i>g?j/i>e/g?(g=e,l=i*(e/j)):(l=g,g=j*(g/i)):(l=i,g=j)}else{g=0.8*q;e=0.8*v;m=d.outerWidth(!1)-d.width();h=d.outerHeight(!1)-d.height();l=g-m;g=e-h;e=C(a);e.popup.css({height:"auto",width:"auto",top:"0",left:"0"});e.content.attr("style","");e.gallery_loading_area.attr("style","");i=e.content;"gallery"!=a._settings.mode||"ready"==a._properties.gallery.status?(e.content.css("display","block"),e.gallery_loading_area.css("display","none")):(e.content.css("display","none"),e.gallery_loading_area.css("display","block"),k=w,i=e.gallery_loading_area);if(u(c.width))l=c.width;else if((c.scaleToContent||"ready"!=a._properties.gallery.status)&&e.popup.width()<l)l=e.popup.width();u(c.maxwidth)&&l>c.maxwidth&&(l=c.maxwidth);e.popup.css({width:l});u(c.height)?g=c.height:c.innerOverflow||(g=e.popup.height());u(c.maxheight)&&g>c.maxheight&&(g=c.maxheight);0==parseInt(i.css("margin-top"))&&i.css({"margin-top":"-1px",top:"1px"});B(e)&&(b=!1);var w=i.outerHeight(!0),j=w-i.height(),r=parseInt(e.popup.css("padding-top")),s=parseInt(e.popup.css("border-top-width")),t=parseInt(e.popup.css("margin-top"));isNaN(r)&&(r=0);isNaN(s)&&(s=0);isNaN(t)&&(t=0);i=g-(i.position().top-(r+s+t));!a._properties.newopen&&0<c.animateSpeed?k.stop(!0,!1).height(k.height()).animate({height:i-j},c.animateSpeed):k.stop(!0,!1).css({height:i-j});w>i&&c.innerOverflow&&k.css("overflow-y","scroll");e&&e.container&&e.container.remove();i=0.05*v;e=g+h;e>0.9*v?(n=i,f.css("overflow-y","scroll"),a.bottom_push.css({top:i+e+"px",height:i+"px",width:"1px"}),a.shadow.css({height:2*i+e+"px"})):(a.bottom_push.css({top:"0px",height:"0px",width:"0px"}),a.shadow.css({height:"100%"}))}f=(q-(l+m))/2;h=(v-(g+h))/2;!1!==n&&(h=n);!a._properties.newopen&&0<c.animateSpeed?d.animate({left:f,top:h,width:l,height:g},c.animateSpeed,function(){D(a)}).css("overflow",""):(d.css({left:f,top:h,width:l,height:g}),D(a))}return b}function F(a){a.content_area.show();a.gallery_loading_area.hide();a._properties.gallery.status="ready"}function G(a){var a=p(a,!1),b=!0;if(a&&a.popup){var c=a._properties.loaded_images;if(c.length)for(var d=0;d<c.length;d++){var f=c[d];!f.complete&&(4!==f.readyState&&"complete"!==f.readyState)&&(b=!1)}}b&&F(a);return b}function J(a){if((a=p(a,!1))&&a.popup){a._properties.loaded_images=[];var b=a.content_area.find("img");if(0<b.length){var c=a;if("gallery"==c._settings.mode){var d=h(c._settings.gallery.loading,!0)?c._settings.gallery.loading:c._defaultSettings.gallery.loading;c.content_area.hide();c.gallery_loading_area.show();c.gallery_loading_area.html(d);c._properties.gallery.status="loading"}var f=0;b.each(function(b,c){if(c.src){var d=new Image;c.complete||4===c.readyState||"complete"===c.readyState?f++:("undefined"!==typeof d.onload?d.onload=function(){setTimeout(function(){G(a)&&a.adjust(!0)},10)}:"undefined"!==typeof d.onreadystatechange&&(d.onreadystatechange=function(){setTimeout(function(){G(a)&&a.adjust(!0)},10)}),"undefined"!==typeof d.onerror&&(d.onerror=function(){setTimeout(function(){j(c).remove();var b=a;if("gallery"==b._settings.mode){var d=h(b._settings.gallery.error,!0)?b._settings.gallery.error:b._defaultSettings.gallery.error;b.content_area.hide();b.gallery_loading_area.show();b.gallery_loading_area.html(d);b._properties.gallery.status="error";b.adjust(!0)}},10)}));d.src=c.src;a._properties.loaded_images.push(d)}});if(b.length==f)return!0}else return!0}return!1}function H(a){I(a);"gallery"==a._settings.mode&&(a._settings.autoScale=!0);a.content_area.find("img").hide();a.shadow.css({height:"100%"});a.container.scrollTop(0);if(a._settings.gallery.name){var b=j("."+a._settings.gallery.name);if(b.length&&(b.each(function(){var b=j(this);if(0==b.closest(".popbox-container").length){var c=q(b,"src"),b=q(b,"href");(c=c?c:b)&&-1==x(c,a._properties.gallery.images)&&a._properties.gallery.images.push(c)}}),0<a._properties.gallery.images.length)){var b="",c=a.content_area.find("img:first");c.length&&(b=q(c.eq(0),"src"));c=x(b,a._properties.gallery.images);a._properties.gallery.position=0;""==b||-1==c?a._properties.gallery.images.unshift(b):-1<c&&(a._properties.gallery.position=c);var d=a;if((d=p(d,!1))&&d.popup&&1<d._properties.gallery.images.length){d.popup.append('<a href="#" class="popbox-gallery-next">&nbsp;'+d._settings.gallery.next+"</a>");d.gallery_next=d.popup.find(".popbox-gallery-next");d.popup.append('<a href="#" class="popbox-gallery-prev">'+d._settings.gallery.prev+"&nbsp;</a>");d.gallery_prev=d.popup.find(".popbox-gallery-prev");var f=!1,k=!1;d.gallery_next.click(function(a){a.preventDefault();d._properties.gallery.position++;d._properties.gallery.position>=d._properties.gallery.images.length&&(d._properties.gallery.position=0);A(d)}).mousemove(function(){f||(d.gallery_next.addClass("popbox-btn-hover"),f=!0,setTimeout(function(){f=!1},200))}).mouseleave(function(){d.gallery_next.removeClass("popbox-btn-hover")});d.gallery_prev.click(function(a){a.preventDefault();d._properties.gallery.position--;0>d._properties.gallery.position&&(d._properties.gallery.position=d._properties.gallery.images.length-1);A(d)}).mousemove(function(){k||(d.gallery_prev.addClass("popbox-btn-hover"),k=!0,setTimeout(function(){k=!1},200))}).mouseleave(function(){d.gallery_prev.removeClass("popbox-btn-hover")})}}}}function I(a){a.content_area.show();a.gallery_loading_area.hide();a._properties.gallery.status="ready";a._properties.gallery.images=[];a._properties.gallery.position=0;if((a=p(a,!1))&&a.popup)a.gallery_next&&a.gallery_next.remove(),a.gallery_prev&&a.gallery_prev.remove(),a.gallery_next=!1,a.gallery_prev=!1}var m=function(a){a=p(a,{});this.$window=j(window);this.$html=j("html");this.$body=j("body");this._settings=j.extend(!0,{},this._defaultSettings,a);this.shadow=this.popup=this.container=!1;this._properties={animating:!1,isopen:!1,newopen:!0,newopentime:0,retrytime:0,resizepause:!1,loaded_content:-1,loaded_images:[],stored_styles:{htmlOverflow:"",htmlHeight:"",htmlMarginRight:""},gallery:{status:"ready",images:[],position:0}}};m.prototype.adjust=function(a){var a=p(a,!1),b=this;if(b._properties.isopen&&(a||!b._properties.resizepause)){var c=!1;b._properties.loaded_content!==b._settings.content&&(c=J(b),b._properties.loaded_content=b._settings.content);c&&F(b);if(b._properties.newopen)E(b),b._properties.newopen=!1;else{var c=1,d="normal";"gallery"==b._settings.mode&&"loading"==b._properties.gallery.status?(c=100,d="loading"):u(a,!0)?c=a:a||(c=b._settings.updatePositionDelay);b._properties.resizepause=!0;b._properties.resizetimer=setTimeout(function(){if("normal"==d||"loading"==d&&"error"!=b._properties.gallery.status)E(b)?b._properties.retrytime=0:3E3<=b._properties.retrytime?b._properties.retrytime=0:(b.adjust(100),b._properties.retrytime+=100);b._properties.resizepause=!1;b._properties.resizetimer=!1},c)}}};m.prototype.refresh=function(){this._properties.loaded_content=-1;this._properties.loaded_images=[]};m.prototype.close=function(){var a=this;if(!a._properties.animating&&a._properties.isopen){if("function"===typeof a._settings.onClose)a._settings.onClose(a);a._properties.animating=!0;a.container.fadeOut(a._settings.fadeOutSpeed,function(){y(a,"close")});a.$window.off("resize.popbox scroll.popbox mousewheel.popbox");a._properties.isopen=!1;a.refresh();"gallery"==a._settings.mode&&a.update({content:""},!1);"function"===typeof a._settings.afterClose&&a._settings.afterClose(a)}};m.prototype.open=function(){var a=this;a.refresh();if(!a._properties.animating&&!a._properties.isopen){if("function"===typeof a._settings.onOpen)a._settings.onOpen(a);a._properties.animating=!0;var b=h(this._settings.close,!0)?a._settings.close:a._defaultSettings.close,c=h(this._settings.content,!0)?a._settings.content:"",d=h(this._settings.title,!0)?'<div class="popbox-title">'+a._settings.title+"</div>":"",f=h(this._settings.customClass,!0)?" "+a._settings.customClass:"",k=h(this._settings.gallery.loading,!0)?a._settings.gallery.loading:a._defaultSettings.gallery.loading;a._properties.stored_styles.htmlOverflow=s(a.$html,"overflow");a._properties.stored_styles.htmlHeight=s(a.$html,"height");a._properties.stored_styles.htmlMarginRight=s(a.$html,"margin-right");var n=a.$body.width();a.$html.css({overflow:"hidden",height:"100%"});var m=a.$body.width();m>n&&a.$html.css({"margin-right":m-n+"px"});a.$body.append('<div class="popbox-container'+f+'" style="display: none;"><div class="popbox-bottom-push"></div><a class="popbox-shadow" href="javascript:void(0);"></a><div class="popbox-popup">'+d+'<div class="popbox-content">'+c+'</div><div class="popbox-gallery-loading">'+k+'</div><a href="#" class="popbox-close">'+b+"</a></div></div>");a.container=j(".popbox-container");a.popup=a.container.find(".popbox-popup");a.shadow=a.container.find(".popbox-shadow");a.bottom_push=a.container.find(".popbox-bottom-push");a.close_button=a.container.find(".popbox-close");a.title_area=a.container.find(".popbox-title");a.content_area=a.container.find(".popbox-content");a.gallery_loading_area=a.container.find(".popbox-gallery-loading");a.container.css({display:"none",height:"100%",width:"100%",position:"fixed",left:"0px",top:"0px","z-index":"990","background-color":"rgba(0,0,0,0.4)","overflow-x":"hidden"});a.bottom_push.css({display:"block",position:"absolute",left:"0px",top:"0px",height:"0px",width:"1px","z-index":"992"});a.popup.css({display:"block",position:"absolute",top:"0px",left:"0px","z-index":"993","-webkit-box-sizing":"content-box","-moz-box-sizing":"content-box","box-sizing":"content-box"});a.shadow.css({display:"block",position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%","z-index":"991",background:"#fff",opacity:"0",cursor:"default"});a.content_area.css({overflow:"hidden",height:"auto"});a.gallery_loading_area.css({overflow:"hidden",height:"auto"});"gallery"==a._settings.mode&&H(a);a.container.fadeIn(a._settings.fadeInSpeed,function(){y(a,"open")});a.shadow.click(function(b){a.close();b.preventDefault()});a.close_button.click(function(b){a.close();b.preventDefault()});var l=!1,g=!1,e=0;a.$window.on("resize.popbox",function(){t(a,"fixed");l&&(g=!0);a.adjust()}).on("scroll.popbox",function(){t(a,"fixed");if(l)if(g)g=!1;else{a.$window.scrollTop(e);var b=0;"scroll"==a.container.css("overflow-y")?(b=a.container.scrollTop()+Math.round(l.offset().top-a.container.offset().top),3<b&&(b-=3),a.container.scrollTop(b)):(b=a.content_area.scrollTop()+Math.round(l.offset().top-a.content_area.offset().top),3<b&&(b-=3),a.content_area.scrollTop(b));l=!1}}).on("mousewheel.popbox",function(){});a.container.on("focus.popbox","input,textarea,select",function(){t(a,"absolute");l=j(this);e=a.$window.scrollTop();setTimeout(function(){l=!1},2E3)});a._properties.isopen=!0;a._properties.newopen=!0;a._properties.newopentime=(new Date).getTime();a.adjust();"function"===typeof a._settings.afterOpen&&a._settings.afterOpen(a)}};m.prototype.update=function(a,b){a=p(a,{});b=p(b,!0);this._settings=j.extend(!0,{},this._settings,a);if(this._properties.isopen){var c=h(this._settings.close,!0)?this._settings.close:this._defaultSettings.close,d=h(this._settings.content,!0)?this._settings.content:"",f=h(this._settings.title,!0)?this._settings.title:"";0<this.close_button.length&&this.close_button.html(c);0<this.content_area.length&&this.content_area.html(d);0<this.title_area.length?""!=f?this.title_area.html(f):(this.title_area.remove(),this.title_area=this.popup.find(".popbox-title")):""!=f&&(this.popup.prepend('<div class="popbox-title">'+f+"</div>"),this.title_area=this.popup.find(".popbox-title"));"gallery"==this._settings.mode?H(this):I(this);b?this.adjust(!0):z(this)}};m.prototype.isOpen=function(){return!0==this._properties.isopen};m.prototype.isClose=function(){return!1==this._properties.isopen};m.prototype.applyDataSettings=function(a){a&&a.length&&r(a,m.prototype._defaultSettings,this._settings)};m.prototype._defaultSettings={width:"auto",height:"auto",maxwidth:"none",maxheight:"none",innerOverflow:!1,scaleToContent:!1,content:"",close:"X",title:"",onOpen:!1,onClose:!1,afterOpen:!1,afterClose:!1,fadeInSpeed:400,fadeOutSpeed:400,updatePositionDelay:200,autoScale:!1,autoSetup:!0,customClass:"",href:"",animateSpeed:400,mode:"normal",gallery:{loading:'<div style="padding:10px;">Loading...</div>',error:'<div style="padding:10px;">There was an error loading the image.</div>',name:"",next:"<span>&#x25B6;</span>",prev:"<span>&#x25C0;</span>"}};j.fn.PopBox=function(a){var b=j(this);b.length&&b.each(function(){var b=j(this),d=new m(a);b.click(function(f){f.preventDefault();f=j.extend(!0,{},a);r(b,m.prototype._defaultSettings,f);var k=f.href||q(b,"href"),n=f.autoSetup,h={},l=!1;if(k&&(null==n||1===n||!0===n||"1"===n||"true"===n)){var n={youtube:[/^(?:http:|https:)?\/\/(?:www\.)?youtube\.com\/watch\?v=([a-zA-Z0-9_\-]+)/,/^(?:http:|https:)?\/\/youtu.be\/([a-zA-Z0-9_\-]+)/,/^(?:http:|https:)?\/\/(?:www\.)?youtube\.com\/embed\/([a-zA-Z0-9_\-]+)/],vimeo:[/^(?:http:|https:)?\/\/(?:www\.)?vimeo\.com\/([a-zA-Z0-9_\-]+)/,/^(?:http:|https:)?\/\/player\.vimeo\.com\/video\/([a-zA-Z0-9_\-]+)/],image:[/^(?:http:|https:)?\/\/[a-zA-Z0-9_\-\./]+(?:\.jpg|\.png|\.gif)(?:.+)?/,/^[a-zA-Z0-9_\-\./]+(?:\.jpg|\.png|\.gif)(?:.+)?/]},g;a:for(g in n)if(n.hasOwnProperty(g)&&n[g]instanceof Array)for(var e=0;e<n[g].length;e++){var i=k.match(n[g][e]);if(i){switch(g){case "youtube":h.content='<iframe width="1280" height="720" src="//www.youtube.com/embed/'+i[1]+'" frameborder="0" allowfullscreen></iframe>';h.autoScale=!0;break;case "vimeo":h.content='<iframe width="1280" height="720" src="//player.vimeo.com/video/'+i[1]+'" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>';h.autoScale=!0;break;case "image":h.content='<img src="'+i[0]+'" alt="" />',h.mode="gallery"}j.extend(!0,h,f);l=!0;break a}}}d=l?new m(h):new m(f);d.open()})})};j(".popbox").PopBox();window.PopBox=m})(jQuery);
