!function(e){function t(e,t){return"undefined"!=typeof e?e:t}function o(e,o){return o=t(o,!1),!isNaN(e-0)&&null!=e&&""!=e&&(!o||e>0)}function i(e,o){return o=t(o,!1),"string"==typeof e&&null!=e&&(!o||""!=e)}function n(e,t){var o=e.attr(t);return("undefined"==typeof o||o===!1||""===o)&&(o=""),o}function a(e,t){var o=n(e,"style");if(t&&o){var i=new RegExp("(^|;)\\s*"+RegExp.escape(t)+"\\s*:");if(o.match(i))return e.css(t)}return""}function s(t,o){if(t.properties.animating)switch(t.properties.animating=!1,o){case"close":t.container.remove(),t.container=!1,t.properties.isopen=!1,t.popup=!1,t.shadow=!1,e("html").css({overflow:t.properties.bodyOverflow,"margin-right":t.properties.bodyMarginRight}),e(document).off("scroll.popbox touchmove.popbox mousewheel.popbox");break;case"open":t.properties.isopen=!0}}function p(e,o){e=t(e,!1),o=t(o,!1);var i=!0;if(e&&e.popup){var n=e.popup.find("img");n.length>0&&n.each(function(e,t){t.complete||4===t.readyState||"complete"===t.readyState||(i=!1)})}return"gallery"==e.settings.mode&&(i?(e.content_area.show(),e.gallery_loading_area&&e.gallery_loading_area.hide(),e.properties.gallery.isloading=!1):(e.content_area.hide(),e.gallery_loading_area&&e.gallery_loading_area.show(),e.properties.gallery.isloading=!0)),i&&o&&h(e),i}function r(o){if(o=t(o,!1),o&&o.popup){var n=o.popup.find("img");if(n.length>0){var a=0;n.each(function(t,n){n.complete||4===n.readyState||"complete"===n.readyState?a++:("undefined"!=typeof n.onload?n.onload=function(){"undefined"!=typeof n.readyState?setTimeout(function(){p(o,!0)},10):p(o,!0)}:"undefined"!=typeof n.onreadystatechange&&(n.onreadystatechange=function(){setTimeout(function(){p(o,!0)},10)}),"gallery"==o.settings.mode&&o.gallery_loading_area&&"undefined"!=typeof n.onerror&&(n.onerror=function(){var t=i(o.settings.gallery.error,!0)?o.settings.gallery.error:o.defaultSettings.gallery.error;o.gallery_loading_area.html(t),o.properties.gallery.isloading=!0,e(n).remove(),o.adjust(!1)}))}),n.length==a&&p(o,!0)}}}function l(e){e.properties.loaded_content!==e.settings.content&&(p(e)||r(e),e.properties.loaded_content=e.settings.content)}function d(e){e.popup.find("img").css({"max-width":"100%",height:"auto",display:"block"}),e.popup.find("iframe").css({"max-height":"100%","max-width":"100%"})}function c(t){var o=e("body"),i="popbox-rsc-clone",n=t.container.clone().stop(!0,!0).addClass(i).css({display:"block",visibility:"hidden","z-index":"-1",overflow:"hidden"});n.find("iframe").attr("src",""),n.appendTo(o);var a=o.find("."+i);return{container:a,popup:a.find(".popbox-popup").eq(0),content:a.find(".popbox-content").eq(0),gallery_loading_area:a.find(".popbox-gallery-loading").eq(0)}}function g(e){e&&e.container&&e.container.remove()}function h(e,i){if(i=t(i,!1),e=t(e,!1),e&&e.popup){var n=e.settings,a=e.popup,s=e.container,p=e.content_area,r=e.gallery_loading_area;a.stop(!0,!1);var l=0,h=0,u=0,f=0,y=0,x=0,m=0,b=0,v=s.outerWidth(!1),w=s.outerHeight(!1),_=0,S=0,k=0,O=!1,z=!1;if(d(e),n.autoScale&&!e.properties.gallery.isloading)if(p.css({height:"100%",width:"100%",overflow:"hidden"}),z=c(e),z.popup.css({height:"auto",width:"auto",top:"auto",left:"auto"}),z.content.attr("style",""),z.content.find("img").css({"max-width":"none",height:"auto",display:"block"}),z.content.find("iframe").css({"max-height":"none","max-width":"none"}),y=z.popup.width(),x=z.popup.height(),m=z.popup.outerWidth(!1)-y,b=z.popup.outerHeight(!1)-x,g(z),_=.8*v-m,S=.8*w-b,_>n.maxwidth&&(_=n.maxwidth),S>n.maxheight&&(S=n.maxheight),x>S||y>_){var C=S/_,j=x/y,I=1;j>C?(I=S/x,h=S,l=y*I):(I=_/y,l=_,h=x*I)}else l=y,h=x;else{_=.8*v,S=.8*w,m=a.outerWidth(!1)-a.width(),b=a.outerHeight(!1)-a.height(),l=_-m,h=S-b,z=c(e),z.popup.css({height:"auto",width:"auto",top:"0",left:"0"}),z.content.attr("style",""),z.gallery_loading_area.attr("style","");var N=p,R=z.content;e.properties.gallery.isloading?(z.content.css("display","none"),z.gallery_loading_area.css("display","block"),N=r,R=z.gallery_loading_area):(z.content.css("display","block"),z.gallery_loading_area.css("display","none")),o(n.width)?l=n.width:n.scaleToContent&&z.popup.width()<l&&(l=z.popup.width()),o(n.maxwidth)&&l>n.maxwidth&&(l=n.maxwidth),z.popup.css({width:l}),o(n.height)?h=n.height:n.innerOverflow||(h=z.popup.height()),o(n.maxheight)&&h>n.maxheight&&(h=n.maxheight),0==parseInt(R.css("margin-top"))&&R.css({"margin-top":"-1px",top:"1px"});var E=R.outerHeight(!0),T=E-R.height(),D=parseInt(z.popup.css("padding-top")),H=parseInt(z.popup.css("border-top-width")),q=parseInt(z.popup.css("margin-top"));isNaN(D)&&(D=0),isNaN(H)&&(H=0),isNaN(q)&&(q=0);var M=D+H+q,P=h-(R.position().top-M);i===!0&&n.animateSpeed>0?N.stop(!0,!1).height(N.height()).animate({height:P-T},n.animateSpeed):N.css({height:P-T}),E>P&&n.innerOverflow&&N.css("overflow-y","scroll"),g(z),k=.05*w,S=.9*w,f=h+b,f>S?(O=k,s.css("overflow","auto"),e.bottom_push.css({top:k+f+"px",height:k+"px",width:"1px"}),e.shadow.css({height:2*k+f+"px"})):(s.css("overflow",""),e.bottom_push.css({top:"0px",height:"0px",width:"0px"}),e.shadow.css({height:"100%"}))}u=l+m,f=h+b;var W=(v-u)/2,$=(w-f)/2;O!==!1&&($=O),i===!0&&n.animateSpeed>0?a.animate({left:W,top:$,width:l,height:h},n.animateSpeed).css("overflow",""):a.css({left:W,top:$,width:l,height:h})}}null!=RegExp&&null==RegExp.escape&&(RegExp.escape=function(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")});var u=function(o){o=t(o,{}),"gallery"==o.mode&&null==o.autoScale&&(o.autoScale=!0),this.settings=e.extend({},this.defaultSettings,o),this.container=!1,this.popup=!1,this.shadow=!1,this.properties={animating:!1,isopen:!1,resizepause:!1,loaded_content:-1,bodyMarginRight:"",bodyOverflow:"",gallery:{isloading:!1}}};u.prototype.adjust=function(e){e=t(e,!1);var o=this;o.properties.resizepause||e&&!o.properties.isopen||(o.properties.resizepause=!0,setTimeout(function(){h(o,e),o.properties.resizepause=!1},o.properties.updatePositionDelay),l(o))},u.prototype.checkImages=function(){this.properties.loaded_content=-1},u.prototype.close=function(){var t=this;!t.properties.animating&&t.properties.isopen&&("function"==typeof t.settings.onClose&&t.settings.onClose(t),t.properties.animating=!0,t.container.fadeOut(t.settings.fadeOutSpeed,function(){s(t,"close")}),e(window).off("resize.popbox.adjust,scroll.popbox.adjust"),t.properties.isopen=!1,t.checkImages(),"function"==typeof t.settings.afterClose&&t.settings.afterClose(t))},u.prototype.open=function(){var t=this;if(!t.properties.animating&&!t.properties.isopen){"function"==typeof t.settings.onOpen&&t.settings.onOpen(t),t.properties.animating=!0;var o=i(this.settings.close,!0)?t.settings.close:t.defaultSettings.close,n=i(this.settings.content,!0)?t.settings.content:"",p=i(this.settings.title,!0)?'<div class="popbox-title">'+t.settings.title+"</div>":"",r=i(this.settings.customClass,!0)?" "+t.settings.customClass:"",l=e("html"),d=e("body");t.properties.bodyOverflow=a(l,"overflow");var c=l.width();l.css("overflow","hidden");var g=l.width();if(g>c){var h=l.css("margin-right");t.properties.bodyMarginRight=a(l,"margin-right");var u=parseInt(h),f=u+(g-c);l.css("margin-right",f+"px")}if(e(document).on("scroll.popbox touchmove.popbox mousewheel.popbox",function(e){}),d.append('<div class="popbox-container'+r+'" style="display: none;"><div class="popbox-bottom-push"></div><a class="popbox-shadow" href="javascript:void(0);"></a><div class="popbox-popup">'+p+'<a class="popbox-close">'+o+'</a><div class="popbox-content">'+n+"</div></div></div>"),t.container=e(".popbox-container"),t.popup=t.container.find(".popbox-popup"),t.shadow=t.container.find(".popbox-shadow"),t.bottom_push=t.container.find(".popbox-bottom-push"),t.close_button=t.container.find(".popbox-close"),t.title_area=t.container.find(".popbox-title"),t.content_area=t.container.find(".popbox-content"),t.gallery_loading_area=!1,t.container.css({display:"none",height:"100%",width:"100%",position:"fixed",left:"0px",top:"0px","z-index":"990","background-color":"rgba(0,0,0,0.4)"}),t.bottom_push.css({display:"block",position:"absolute",left:"0px",top:"0px",height:"0px",width:"1px","z-index":"992"}),t.popup.css({display:"block",position:"absolute",top:"0px",left:"0px","z-index":"993","-webkit-box-sizing":"content-box","-moz-box-sizing":"content-box","box-sizing":"content-box"}),t.shadow.css({display:"block",position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%","z-index":"991",background:"#fff",opacity:"0",cursor:"default"}),t.content_area.css({overflow:"hidden",height:"auto"}),"gallery"==t.settings.mode){t.content_area.hide();var y=i(this.settings.gallery.loading,!0)?t.settings.gallery.loading:t.defaultSettings.gallery.loading;t.content_area.after('<div class="popbox-gallery-loading">'+y+"</div>"),t.gallery_loading_area=t.container.find(".popbox-gallery-loading"),t.gallery_loading_area.css({overflow:"hidden",height:"auto"})}t.adjust(),t.container.fadeIn(t.settings.fadeInSpeed,function(){s(t,"open")}),t.shadow.click(function(e){t.close(),e.preventDefault()}),t.close_button.click(function(e){t.close(),e.preventDefault()}),e(window).on("resize.popbox.adjust,scroll.popbox.adjust",function(){t.adjust(!0)}),t.properties.isopen=!0,"function"==typeof t.settings.afterOpen&&t.settings.afterOpen(t)}},u.prototype.update=function(o,n,a){var s=this;if(o=t(o,{}),n=t(n,!0),a=t(a,!0),s.settings=e.extend({},s.settings,o),s.properties.isopen){var p=i(s.settings.close,!0)?s.settings.close:s.defaultSettings.close,r=i(s.settings.content,!0)?s.settings.content:"",l=i(s.settings.title,!0)?s.settings.title:"";s.close_button.length>0&&s.close_button.html(p),s.content_area.length>0&&s.content_area.html(r),s.title_area.length>0?""!=l?s.title_area.html(l):(s.title_area.remove(),s.title_area=s.popup.find(".popbox-title")):""!=l&&(s.popup.prepend('<div class="popbox-title">'+l+"</div>"),s.title_area=s.popup.find(".popbox-title")),n?s.adjust(a):d(s)}},u.prototype.isOpen=function(){return 1==this.properties.isopen},u.prototype.isClose=function(){return 0==this.properties.isopen},u.prototype.defaultSettings={width:"auto",height:"auto",maxwidth:"none",maxheight:"none",innerOverflow:!1,scaleToContent:!1,content:"",close:"X",title:"",onOpen:!1,onClose:!1,afterOpen:!1,afterClose:!1,fadeInSpeed:400,fadeOutSpeed:400,updatePositionDelay:200,autoScale:!1,customClass:"",animateSpeed:400,mode:"normal",gallery:{loading:"Loading",error:"Error"}},window.PopBox=u}(jQuery);