!function(e){function t(e,t){return"undefined"!=typeof e?e:t}function o(e,o){return o=t(o,!1),!isNaN(e-0)&&null!=e&&""!=e&&(!o||e>0)}function i(e,o){return o=t(o,!1),"string"==typeof e&&null!=e&&(!o||""!=e)}function n(t,o){if(t.properties.animating)switch(t.properties.animating=!1,o){case"close":t.container.remove(),t.container=!1,t.properties.isopen=!1,t.popup=!1,t.shadow=!1,e("body").css({overflow:t.properties.bodyOverflow,"margin-right":t.properties.bodyMarginRight}),e(document).off("scroll.popbox touchmove.popbox mousewheel.popbox");break;case"open":t.properties.isopen=!0}}function a(e,o){e=t(e,!1),o=t(o,!1);var i=!0;if(e&&e.popup){var n=e.popup.find("img");n.length>0&&n.each(function(e,t){t.complete||4===t.readyState||"complete"===t.readyState||(i=!1)})}return"gallery"==e.settings.mode&&(i?(e.content_area.show(),e.gallery_loading_area&&e.gallery_loading_area.hide(),e.properties.gallery.isloading=!1):(e.content_area.hide(),e.gallery_loading_area&&e.gallery_loading_area.show(),e.properties.gallery.isloading=!0)),i&&o&&c(e),i}function s(o){if(o=t(o,!1),o&&o.popup){var n=o.popup.find("img");if(n.length>0){var s=0;n.each(function(t,n){n.complete||4===n.readyState||"complete"===n.readyState?s++:("undefined"!=typeof n.onload?n.onload=function(){"undefined"!=typeof n.readyState?setTimeout(function(){a(o,!0)},10):a(o,!0)}:"undefined"!=typeof n.onreadystatechange&&(n.onreadystatechange=function(){setTimeout(function(){a(o,!0)},10)}),"gallery"==o.settings.mode&&o.gallery_loading_area&&"undefined"!=typeof n.onerror&&(n.onerror=function(){var t=i(o.settings.gallery.error,!0)?o.settings.gallery.error:o.defaultSettings.gallery.error;o.gallery_loading_area.html(t),o.properties.gallery.isloading=!0,e(n).remove(),o.adjust(!1)}))}),n.length==s&&a(o,!0)}}}function p(e){e.properties.loaded_content!==e.settings.content&&(a(e)||s(e),e.properties.loaded_content=e.settings.content)}function r(e){e.popup.find("img").css({"max-width":"100%",height:"auto",display:"block"}),e.popup.find("iframe").css({"max-height":"100%","max-width":"100%"})}function l(t){var o=e("body"),i="popbox-rsc-clone",n=t.container.clone().stop(!0,!0).addClass(i).css({display:"block",visibility:"hidden","z-index":"-1",overflow:"hidden"});n.find("iframe").attr("src",""),n.appendTo(o);var a=o.find("."+i);return{container:a,popup:a.find(".popbox-popup").eq(0),content:a.find(".popbox-content").eq(0),gallery_loading_area:a.find(".popbox-gallery-loading").eq(0)}}function d(e){e&&e.container&&e.container.remove()}function c(e,i){if(i=t(i,!1),e=t(e,!1),e&&e.popup){var n=e.settings,a=e.popup,s=e.container,p=e.content_area,c=e.gallery_loading_area;a.stop(!0,!1);var g=0,h=0,u=0,f=0,y=0,m=0,x=0,b=0,w=s.outerWidth(!1),v=s.outerHeight(!1),_=0,S=0,O=0,k=!1,z=!1;if(r(e),n.autoScale&&!e.properties.gallery.isloading)if(p.css({height:"100%",width:"100%",overflow:"hidden"}),z=l(e),z.popup.css({height:"auto",width:"auto",top:"auto",left:"auto"}),z.content.attr("style",""),z.content.find("img").css({"max-width":"none",height:"auto",display:"block"}),z.content.find("iframe").css({"max-height":"none","max-width":"none"}),y=z.popup.width(),m=z.popup.height(),x=z.popup.outerWidth(!1)-y,b=z.popup.outerHeight(!1)-m,d(z),_=.8*w-x,S=.8*v-b,_>n.maxwidth&&(_=n.maxwidth),S>n.maxheight&&(S=n.maxheight),m>S||y>_){var C=S/_,I=m/y,j=1;I>C?(j=S/m,h=S,g=y*j):(j=_/y,g=_,h=m*j)}else g=y,h=m;else{_=.8*w,S=.8*v,x=a.outerWidth(!1)-a.width(),b=a.outerHeight(!1)-a.height(),g=_-x,h=S-b,z=l(e),z.popup.css({height:"auto",width:"auto",top:"0",left:"0"}),z.content.attr("style",""),z.gallery_loading_area.attr("style","");var N=p,D=z.content;e.properties.gallery.isloading?(z.content.css("display","none"),z.gallery_loading_area.css("display","block"),N=c,D=z.gallery_loading_area):(z.content.css("display","block"),z.gallery_loading_area.css("display","none")),o(n.width)?g=n.width:z.popup.width()<g&&(g=z.popup.width()),o(n.maxwidth)&&g>n.maxwidth&&(g=n.maxwidth),z.popup.css({width:g}),o(n.height)?h=n.height:n.innerOverflow||(h=z.popup.height()),o(n.maxheight)&&h>n.maxheight&&(h=n.maxheight),0==parseInt(D.css("margin-top"))&&D.css({"margin-top":"-1px",top:"1px"});var H=D.outerHeight(!0),M=H-D.height(),R=parseInt(z.popup.css("padding-top")),T=parseInt(z.popup.css("border-top-width")),q=parseInt(z.popup.css("margin-top"));isNaN(R)&&(R=0),isNaN(T)&&(T=0),isNaN(q)&&(q=0);var P=R+T+q,W=h-(D.position().top-P);i===!0&&n.animateSpeed>0?N.stop(!0,!1).height(N.height()).animate({height:W-M},n.animateSpeed):N.css({height:W-M}),H>W&&n.innerOverflow&&N.css("overflow-y","scroll"),d(z),O=.05*v,S=.9*v,f=h+b,f>S?(k=O,s.css("overflow","auto"),e.bottom_push.css({top:O+f+"px",height:O+"px",width:"1px"}),e.shadow.css({height:2*O+f+"px"})):(s.css("overflow",""),e.bottom_push.css({top:"0px",height:"0px",width:"0px"}),e.shadow.css({height:"100%"}))}u=g+x,f=h+b;var B=(w-u)/2,E=(v-f)/2;k!==!1&&(E=k),i===!0&&n.animateSpeed>0?a.animate({left:B,top:E,width:g,height:h},n.animateSpeed).css("overflow",""):a.css({left:B,top:E,width:g,height:h})}}var g=function(o){o=t(o,{}),"gallery"==o.mode&&null==o.autoScale&&(o.autoScale=!0),this.settings=e.extend({},this.defaultSettings,o),this.container=!1,this.popup=!1,this.shadow=!1,this.properties={animating:!1,isopen:!1,resizepause:!1,loaded_content:-1,bodyMarginRight:"",bodyOverflow:"",gallery:{isloading:!1}}};g.prototype.adjust=function(e){e=t(e,!1);var o=this;o.properties.resizepause||e&&!o.properties.isopen||(o.properties.resizepause=!0,setTimeout(function(){c(o,e),o.properties.resizepause=!1},o.properties.updatePositionDelay),p(o))},g.prototype.checkImages=function(){this.properties.loaded_content=-1},g.prototype.close=function(){var t=this;!t.properties.animating&&t.properties.isopen&&("function"==typeof t.settings.onClose&&t.settings.onClose(t),t.properties.animating=!0,t.container.fadeOut(t.settings.fadeOutSpeed,function(){n(t,"close")}),e(window).off("resize.popbox.adjust"),t.properties.isopen=!1,t.checkImages(),"function"==typeof t.settings.afterClose&&t.settings.afterClose(t))},g.prototype.open=function(){var t=this;if(!t.properties.animating&&!t.properties.isopen){"function"==typeof t.settings.onOpen&&t.settings.onOpen(t),t.properties.animating=!0;var o=i(this.settings.close,!0)?t.settings.close:t.defaultSettings.close,a=i(this.settings.content,!0)?t.settings.content:"",s=i(this.settings.title,!0)?'<div class="popbox-title">'+t.settings.title+"</div>":"",p=i(this.settings.customClass,!0)?" "+t.settings.customClass:"",r=e("body");t.properties.bodyOverflow=r.css("overflow");var l=r.width();r.css("overflow","hidden");var d=r.width();if(d>l){t.properties.bodyMarginRight=r.css("margin-right");var c=parseInt(t.properties.bodyMarginRight),g=c+(d-l);r.css("margin-right",g+"px")}if(e(document).on("scroll.popbox touchmove.popbox mousewheel.popbox",function(e){}),r.append('<div class="popbox-container'+p+'" style="display: none;"><div class="popbox-bottom-push"></div><a class="popbox-shadow" href="javascript:void(0);"></a><div class="popbox-popup">'+s+'<a class="popbox-close">'+o+'</a><div class="popbox-content">'+a+"</div></div></div>"),t.container=e(".popbox-container"),t.popup=t.container.find(".popbox-popup"),t.shadow=t.container.find(".popbox-shadow"),t.bottom_push=t.container.find(".popbox-bottom-push"),t.close_button=t.container.find(".popbox-close"),t.title_area=t.container.find(".popbox-title"),t.content_area=t.container.find(".popbox-content"),t.gallery_loading_area=!1,t.container.css({display:"none",height:"100%",width:"100%",position:"fixed",left:"0px",top:"0px","z-index":"990","background-color":"rgba(0,0,0,0.4)"}),t.bottom_push.css({display:"block",position:"absolute",left:"0px",top:"0px",height:"0px",width:"1px","z-index":"992"}),t.popup.css({display:"block",position:"absolute",top:"0px",left:"0px","z-index":"993"}),t.shadow.css({display:"block",position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%","z-index":"991",background:"#fff",opacity:"0",cursor:"default"}),t.content_area.css({overflow:"hidden",height:"auto"}),"gallery"==t.settings.mode){t.content_area.hide();var h=i(this.settings.gallery.loading,!0)?t.settings.gallery.loading:t.defaultSettings.gallery.loading;t.content_area.after('<div class="popbox-gallery-loading">'+h+"</div>"),t.gallery_loading_area=t.container.find(".popbox-gallery-loading"),t.gallery_loading_area.css({overflow:"hidden",height:"auto"})}t.adjust(),t.container.fadeIn(t.settings.fadeInSpeed,function(){n(t,"open")}),t.shadow.click(function(e){t.close(),e.preventDefault()}),t.close_button.click(function(e){t.close(),e.preventDefault()}),e(window).on("resize.popbox.adjust",function(){t.adjust(!0)}),t.properties.isopen=!0,"function"==typeof t.settings.afterOpen&&t.settings.afterOpen(t)}},g.prototype.update=function(o,n,a){var s=this;if(o=t(o,{}),n=t(n,!0),a=t(a,!0),s.settings=e.extend({},s.settings,o),s.properties.isopen){var p=i(s.settings.close,!0)?s.settings.close:s.defaultSettings.close,l=i(s.settings.content,!0)?s.settings.content:"",d=i(s.settings.title,!0)?s.settings.title:"";s.close_button.length>0&&s.close_button.html(p),s.content_area.length>0&&s.content_area.html(l),s.title_area.length>0?""!=d?s.title_area.html(d):(s.title_area.remove(),s.title_area=s.popup.find(".popbox-title")):""!=d&&(s.popup.prepend('<div class="popbox-title">'+d+"</div>"),s.title_area=s.popup.find(".popbox-title")),n?s.adjust(a):r(s)}},g.prototype.isOpen=function(){return 1==this.properties.isopen},g.prototype.isClose=function(){return 0==this.properties.isopen},g.prototype.defaultSettings={width:"auto",height:"auto",maxwidth:"none",maxheight:"none",innerOverflow:!1,content:"",close:"X",title:"",onOpen:!1,onClose:!1,afterOpen:!1,afterClose:!1,fadeInSpeed:400,fadeOutSpeed:400,updatePositionDelay:200,autoScale:!1,customClass:"",animateSpeed:400,mode:"normal",gallery:{loading:"Loading",error:"Error"}},window.PopBox=g}(jQuery);