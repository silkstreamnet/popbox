(function(q){function m(a,b){return"undefined"!==typeof a?a:b}function v(a,b){b=m(b,!1);return!isNaN(a-0)&&null!=a&&""!=a&&(!b||0<a)}function h(a,b){b=m(b,!1);return"string"===typeof a&&null!=a&&(!b||""!=a)}function t(a,b){var c=a.attr(b);if("undefined"===typeof c||!1===c||""===c)c="";return c}function z(a,b,c){c=c||!1;if(b instanceof Array)for(var e=0;e<b.length;e++)if(c){if(b[e]===a)return e}else if(b[e]==a)return e;return-1}function u(a,b){var c=t(a,"style");if(b&&c){var e=new RegExp("(^|;)\\s*"+RegExp.escape(b)+"\\s*:");if(c.match(e))return a.css(b)}return""}function A(a,b){if(a._properties.animating)switch(a._properties.animating=!1,b){case "close":a.container.remove();a.container=!1;a._properties.isopen=!1;a.popup=!1;a.shadow=!1;a.$html.css({overflow:a._properties.stored_styles.htmlOverflow,height:a._properties.stored_styles.htmlHeight,"margin-right":a._properties.stored_styles.htmlMarginRight});break;case "open":a._properties.isopen=!0}}function B(a){a.popup.find("img").css({"max-width":"100%",height:"auto"}).filter(":visible").css({display:"block"});a.popup.find("iframe").css({"max-height":"100%","max-width":"100%"})}function C(a){(a=m(a,!1))&&a.popup&&a.update({content:'<img src="'+a._properties.gallery.images[a._properties.gallery.position]+'" style="display:none;" />'})}function L(a){if((a=m(a,!1))&&a.popup&&1<a._properties.gallery.images.length){a.popup.append('<a href="#" class="popbox-gallery-next">&nbsp;'+a._settings.gallery.next+"</a>");a.gallery_next=a.popup.find(".popbox-gallery-next");a.popup.append('<a href="#" class="popbox-gallery-prev">'+a._settings.gallery.prev+"&nbsp;</a>");a.gallery_prev=a.popup.find(".popbox-gallery-prev");var b=!1,c=!1;a.gallery_next.click(function(b){b.preventDefault();a._properties.gallery.position++;a._properties.gallery.position>=a._properties.gallery.images.length&&(a._properties.gallery.position=0);C(a)}).mousemove(function(c){b||(a.gallery_next.addClass("popbox-btn-hover"),b=!0,setTimeout(function(){b=!1},200))}).mouseleave(function(b){a.gallery_next.removeClass("popbox-btn-hover")});a.gallery_prev.click(function(b){b.preventDefault();a._properties.gallery.position--;0>a._properties.gallery.position&&(a._properties.gallery.position=a._properties.gallery.images.length-1);C(a)}).mousemove(function(b){c||(a.gallery_prev.addClass("popbox-btn-hover"),c=!0,setTimeout(function(){c=!1},200))}).mouseleave(function(b){a.gallery_prev.removeClass("popbox-btn-hover")})}}function D(a){var b=!1;a.content.find("img").each(function(){var a=q(this);0!=a.width()&&0!=a.height()||!1!==this.complete||(b=!0)});return b}function E(a){var b="popbox-rsc-clone-"+(new Date).getTime(),c=a.container.clone().stop(!0,!0).addClass(b).css({display:"block",visibility:"hidden","z-index":"-1",overflow:"hidden"});c.find("iframe").attr("src","");c.appendTo(a.$body);a=a.$body.find("."+b);return{container:a,popup:a.find(".popbox-popup").eq(0),content:a.find(".popbox-content").eq(0),gallery_loading_area:a.find(".popbox-gallery-loading").eq(0)}}function F(a){(a=m(a,!1))&&a.popup&&("gallery"==a._settings.mode&&"ready"==a._properties.gallery.status&&a.content_area.find("img:hidden").fadeIn(300),a.popup.find(".popbox-btn-hover").removeClass("popbox-btn-hover"))}function G(a){a=m(a,!1);var b=!0;if(a&&a.popup){var c=a._settings,e=a.popup,g=a.container,l=a.content_area,w=a.shadow,q=a.gallery_loading_area;e.stop(!0,!1);g.css("overflow-y","hidden");B(a);var n=0,k=0,d=0,f=0,h=k=0,s=0,p=w.width(),x=g.outerHeight(!1),r=d=0,f=0,d=w=!1;if(!c.autoScale||"gallery"==a._settings.mode&&"ready"!=a._properties.gallery.status){d=.8*p;r=.8*x;h=e.outerWidth(!1)-e.width();s=e.outerHeight(!1)-e.height();n=d-h;k=r-s;d=E(a);d.popup.css({height:"auto",width:"auto",top:"0",left:"0"});d.content.attr("style","");d.gallery_loading_area.attr("style","");f=d.content;"gallery"!=a._settings.mode||"ready"==a._properties.gallery.status?(d.content.css("display","block"),d.gallery_loading_area.css("display","none")):(d.content.css("display","none"),d.gallery_loading_area.css("display","block"),l=q,f=d.gallery_loading_area);v(c.width)?n=c.width:(c.scaleToContent||"ready"!=a._properties.gallery.status)&&d.popup.width()<n&&(n=d.popup.width());v(c.maxwidth)&&n>c.maxwidth&&(n=c.maxwidth);d.popup.css({width:n});v(c.height)?k=c.height:c.innerOverflow||(k=d.popup.height());v(c.maxheight)&&k>c.maxheight&&(k=c.maxheight);0==parseInt(f.css("margin-top"))&&f.css({"margin-top":"-1px",top:"1px"});D(d)&&(b=!1);var q=f.outerHeight(!0),r=q-f.height(),y=parseInt(d.popup.css("padding-top")),t=parseInt(d.popup.css("border-top-width")),u=parseInt(d.popup.css("margin-top"));isNaN(y)&&(y=0);isNaN(t)&&(t=0);isNaN(u)&&(u=0);y=y+t+u;f=k-(f.position().top-y);!a._properties.newopen&&0<c.animateSpeed?l.stop(!0,!1).height(l.height()).animate({height:f-r},c.animateSpeed):l.stop(!0,!1).css({height:f-r});q>f&&c.innerOverflow&&l.css("overflow-y","scroll");d&&d.container&&d.container.remove();f=.05*x;d=k+s;d>.9*x?(w=f,g.css("overflow-y","scroll"),a.bottom_push.css({top:f+d+"px",height:f+"px",width:"1px"}),a.shadow.css({height:2*f+d+"px"})):(a.bottom_push.css({top:"0px",height:"0px",width:"0px"}),a.shadow.css({height:"100%"}))}else{l.css({height:"100%",width:"100%",overflow:"hidden"});d=E(a);d.popup.css({height:"auto",width:"auto",top:"auto",left:"auto"});d.content.attr("style","");d.content.find("img").css({"max-width":"none",height:"auto",display:"block"});d.content.find("iframe").css({"max-height":"none","max-width":"none"});if(D(d))return!1;f=d.popup.width();k=d.popup.height();h=d.popup.outerWidth(!1)-f;s=d.popup.outerHeight(!1)-k;d&&d.container&&d.container.remove();d=.8*p-h;r=.8*x-s;d>c.maxwidth&&(d=c.maxwidth);r>c.maxheight&&(r=c.maxheight);k>r||f>d?(n=1,k/f>r/d?(n=r/k,k=r,n*=f):(n=d,k*=d/f)):n=f}h=(p-(n+h))/2;s=(x-(k+s))/2;!1!==w&&(s=w);!a._properties.newopen&&0<c.animateSpeed?e.animate({left:h,top:s,width:n,height:k},c.animateSpeed,function(){F(a)}).css("overflow",""):(e.css({left:h,top:s,width:n,height:k}),F(a))}return b}function H(a){a.content_area.show();a.gallery_loading_area.hide();a._properties.gallery.status="ready"}function M(a){if("gallery"==a._settings.mode){var b=h(a._settings.gallery.loading,!0)?a._settings.gallery.loading:a._defaultSettings.gallery.loading;a.content_area.hide();a.gallery_loading_area.show();a.gallery_loading_area.html(b);a._properties.gallery.status="loading"}}function I(a){a=m(a,!1);var b=!0;if(a&&a.popup){var c=a._properties.loaded_images;if(c.length)for(var e=0;e<c.length;e++){var g=c[e];g.complete||4===g.readyState||"complete"===g.readyState||(b=!1)}}b&&H(a);return b}function N(a){if((a=m(a,!1))&&a.popup){a._properties.loaded_images=[];var b=a.content_area.find("img");if(0<b.length){M(a);var c=0;b.each(function(b,g){if(g.src){var l=new Image;g.complete||4===g.readyState||"complete"===g.readyState?c++:("undefined"!==typeof l.onload?l.onload=function(){setTimeout(function(){I(a)&&a.adjust(!0)},10)}:"undefined"!==typeof l.onreadystatechange&&(l.onreadystatechange=function(){setTimeout(function(){I(a)&&a.adjust(!0)},10)}),"undefined"!==typeof l.onerror&&(l.onerror=function(){setTimeout(function(){q(g).remove();var b=a;if("gallery"==b._settings.mode){var c=h(b._settings.gallery.error,!0)?b._settings.gallery.error:b._defaultSettings.gallery.error;b.content_area.hide();b.gallery_loading_area.show();b.gallery_loading_area.html(c);b._properties.gallery.status="error";b.adjust(!0)}},10)}));l.src=g.src;a._properties.loaded_images.push(l)}});if(b.length==c)return!0}else return!0}return!1}function O(a){var b=!1;a._properties.loaded_content!==a._settings.content&&(b=N(a),a._properties.loaded_content=a._settings.content);return b}function J(a){K(a);"gallery"==a._settings.mode&&(a._settings.autoScale=!0);a.content_area.find("img").hide();a.shadow.css({height:"100%"});a.container.scrollTop(0);if(a._settings.gallery.name){var b=q("."+a._settings.gallery.name);if(b.length&&(b.each(function(){var b=q(this);if(0==b.closest(".popbox-container").length){var c=t(b,"src"),b=t(b,"href");(c=c?c:b)&&-1==z(c,a._properties.gallery.images)&&a._properties.gallery.images.push(c)}}),0<a._properties.gallery.images.length)){var b="",c=a.content_area.find("img:first");c.length&&(b=t(c.eq(0),"src"));c=z(b,a._properties.gallery.images);a._properties.gallery.position=0;""==b||-1==c?a._properties.gallery.images.unshift(b):-1<c&&(a._properties.gallery.position=c);L(a)}}}function K(a){a.content_area.show();a.gallery_loading_area.hide();a._properties.gallery.status="ready";a._properties.gallery.images=[];a._properties.gallery.position=0;(a=m(a,!1))&&a.popup&&(a.gallery_next&&a.gallery_next.remove(),a.gallery_prev&&a.gallery_prev.remove(),a.gallery_next=!1,a.gallery_prev=!1)}null!=RegExp&&null==RegExp.escape&&(RegExp.escape=function(a){return a.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")});var p=function(a){a=m(a,{});this.$window=q(window);this.$html=q("html");this.$body=q("body");this._settings=q.extend(!0,{},this._defaultSettings,a);this.shadow=this.popup=this.container=!1;this._properties={animating:!1,isopen:!1,newopen:!0,newopentime:0,retrytime:0,resizepause:!1,loaded_content:-1,loaded_images:[],stored_styles:{htmlOverflow:"",htmlHeight:"",htmlMarginRight:""},gallery:{status:"ready",images:[],position:0}}};p.prototype.adjust=function(a){a=m(a,!1);var b=this;if(b._properties.isopen&&(a||!b._properties.resizepause))if(O(b)&&H(b),b._properties.newopen)G(b),b._properties.newopen=!1;else{var c=1,e="normal";"gallery"==b._settings.mode&&"loading"==b._properties.gallery.status?(c=100,e="loading"):v(a,!0)?c=a:a||(c=b._settings.updatePositionDelay);b._properties.resizepause=!0;b._properties.resizetimer=setTimeout(function(){if("normal"==e||"loading"==e&&"error"!=b._properties.gallery.status)G(b)?b._properties.retrytime=0:3E3<=b._properties.retrytime?b._properties.retrytime=0:(b.adjust(100),b._properties.retrytime+=100);b._properties.resizepause=!1;b._properties.resizetimer=!1},c)}};p.prototype.refresh=function(){this._properties.loaded_content=-1;this._properties.loaded_images=[]};p.prototype.close=function(){var a=this;if(!a._properties.animating&&a._properties.isopen){if("function"===typeof a._settings.onClose)a._settings.onClose(a);a._properties.animating=!0;a.container.fadeOut(a._settings.fadeOutSpeed,function(){A(a,"close")});a.$window.off("resize.popbox.adjust");a._properties.isopen=!1;a.refresh();"gallery"==a._settings.mode&&a.update({content:""},!1);"function"===typeof a._settings.afterClose&&a._settings.afterClose(a)}};p.prototype.open=function(){var a=this;a.refresh();if(!a._properties.animating&&!a._properties.isopen){if("function"===typeof a._settings.onOpen)a._settings.onOpen(a);a._properties.animating=!0;var b=h(this._settings.close,!0)?a._settings.close:a._defaultSettings.close,c=h(this._settings.content,!0)?a._settings.content:"",e=h(this._settings.title,!0)?'<div class="popbox-title">'+a._settings.title+"</div>":"",g=h(this._settings.customClass,!0)?" "+a._settings.customClass:"",l=h(this._settings.gallery.loading,!0)?a._settings.gallery.loading:a._defaultSettings.gallery.loading;a._properties.stored_styles.htmlOverflow=u(a.$html,"overflow");a._properties.stored_styles.htmlHeight=u(a.$html,"height");a._properties.stored_styles.htmlMarginRight=u(a.$html,"margin-right");var m=a.$body.width();a.$html.css({overflow:"hidden",height:"100%"});var p=a.$body.width();p>m&&a.$html.css({"margin-right":p-m+"px"});a.$body.append('<div class="popbox-container'+g+'" style="display: none;"><div class="popbox-bottom-push"></div><a class="popbox-shadow" href="javascript:void(0);"></a><div class="popbox-popup">'+e+'<div class="popbox-content">'+c+'</div><div class="popbox-gallery-loading">'+l+'</div><a href="#" class="popbox-close">'+b+"</a></div></div>");a.container=q(".popbox-container");a.popup=a.container.find(".popbox-popup");a.shadow=a.container.find(".popbox-shadow");a.bottom_push=a.container.find(".popbox-bottom-push");a.close_button=a.container.find(".popbox-close");a.title_area=a.container.find(".popbox-title");a.content_area=a.container.find(".popbox-content");a.gallery_loading_area=a.container.find(".popbox-gallery-loading");a.container.css({display:"none",height:"100%",width:"100%",position:"fixed",left:"0px",top:"0px","z-index":"990","background-color":"rgba(0,0,0,0.4)","overflow-x":"hidden"});a.bottom_push.css({display:"block",position:"absolute",left:"0px",top:"0px",height:"0px",width:"1px","z-index":"992"});a.popup.css({display:"block",position:"absolute",top:"0px",left:"0px","z-index":"993","-webkit-box-sizing":"content-box","-moz-box-sizing":"content-box","box-sizing":"content-box"});a.shadow.css({display:"block",position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%","z-index":"991",background:"#fff",opacity:"0",cursor:"default"});a.content_area.css({overflow:"hidden",height:"auto"});a.gallery_loading_area.css({overflow:"hidden",height:"auto"});"gallery"==a._settings.mode&&J(a);a.container.fadeIn(a._settings.fadeInSpeed,function(){A(a,"open")});a.shadow.click(function(b){a.close();b.preventDefault()});a.close_button.click(function(b){a.close();b.preventDefault()});a.$window.on("resize.popbox.adjust",function(){a.adjust()});a._properties.isopen=!0;a._properties.newopen=!0;a._properties.newopentime=(new Date).getTime();a.adjust();"function"===typeof a._settings.afterOpen&&a._settings.afterOpen(a)}};p.prototype.update=function(a,b){a=m(a,{});b=m(b,!0);this._settings=q.extend(!0,{},this._settings,a);if(this._properties.isopen){var c=h(this._settings.close,!0)?this._settings.close:this._defaultSettings.close,e=h(this._settings.content,!0)?this._settings.content:"",g=h(this._settings.title,!0)?this._settings.title:"";0<this.close_button.length&&this.close_button.html(c);0<this.content_area.length&&this.content_area.html(e);0<this.title_area.length?""!=g?this.title_area.html(g):(this.title_area.remove(),this.title_area=this.popup.find(".popbox-title")):""!=g&&(this.popup.prepend('<div class="popbox-title">'+g+"</div>"),this.title_area=this.popup.find(".popbox-title"));"gallery"==this._settings.mode?J(this):K(this);b?this.adjust(!0):B(this)}};p.prototype.isOpen=function(){return!0==this._properties.isopen};p.prototype.isClose=function(){return!1==this._properties.isopen};p.prototype._defaultSettings={width:"auto",height:"auto",maxwidth:"none",maxheight:"none",innerOverflow:!1,scaleToContent:!1,content:"",close:"X",title:"",onOpen:!1,onClose:!1,afterOpen:!1,afterClose:!1,fadeInSpeed:400,fadeOutSpeed:400,updatePositionDelay:200,autoScale:!1,customClass:"",animateSpeed:400,mode:"normal",gallery:{loading:'<div style="padding:10px;">Loading...</div>',error:'<div style="padding:10px;">There was an error loading the image.</div>',name:"",next:"<span>&#x25B6;</span>",prev:"<span>&#x25C0;</span>"}};window.PopBox=p})(jQuery);