(function(i){function l(a,b){return"undefined"!==typeof a?a:b}function s(a,b){b=l(b,!1);return!isNaN(a-0)&&null!=a&&""!=a&&(!b||0<a)}function j(a,b){b=l(b,!1);return"string"===typeof a&&null!=a&&(!b||""!=a)}function n(a,b){var c=a.attr(b);if("undefined"===typeof c||!1===c||""===c)c="";return c}function x(a,b,c){c=c||!1;if(b instanceof Array)for(var d=0;d<b.length;d++)if(c){if(b[d]===a)return d}else if(b[d]==a)return d;return-1}function q(a,b){var c=n(a,"style");if(b&&c){var d=RegExp("(^|;)\\s*"+RegExp.escape(b)+
"\\s*:");if(c.match(d))return a.css(b)}return""}function y(a,b){if(a._properties.animating)switch(a._properties.animating=!1,b){case "close":a.container.remove();a.container=!1;a._properties.isopen=!1;a.popup=!1;a.shadow=!1;a.$html.css({overflow:a._properties.stored_styles.htmlOverflow,height:a._properties.stored_styles.htmlHeight,"margin-right":a._properties.stored_styles.htmlMarginRight});break;case "open":a._properties.isopen=!0}}function z(a){a.popup.find("img").css({"max-width":"100%",height:"auto"}).filter(":visible").css({display:"block"});
a.popup.find("iframe").css({"max-height":"100%","max-width":"100%"})}function A(a){(a=l(a,!1))&&a.popup&&a.update({content:'<img src="'+a._properties.gallery.images[a._properties.gallery.position]+'" style="display:none;" />'})}function B(a){var b=!1;a.content.find("img").each(function(){var a=i(this);if((0==a.width()||0==a.height())&&!1===this.complete)b=!0});return b}function C(a){var b="popbox-rsc-clone-"+(new Date).getTime(),c=a.container.clone().stop(!0,!0).addClass(b).css({display:"block",visibility:"hidden",
"z-index":"-1",overflow:"hidden"});c.find("iframe").attr("src","");c.appendTo(a.$body);a=a.$body.find("."+b);return{container:a,popup:a.find(".popbox-popup").eq(0),content:a.find(".popbox-content").eq(0),gallery_loading_area:a.find(".popbox-gallery-loading").eq(0)}}function D(a){if((a=l(a,!1))&&a.popup)"gallery"==a._settings.mode&&"ready"==a._properties.gallery.status&&a.content_area.find("img:hidden").fadeIn(300),a.popup.find(".popbox-btn-hover").removeClass("popbox-btn-hover")}function E(a){var a=
l(a,!1),b=!0;if(a&&a.popup){var c=a._settings,d=a.popup,f=a.container,r=a.content_area,t=a.shadow,v=a.gallery_loading_area;d.stop(!0,!1);f.css("overflow-y","hidden");z(a);var m=0,h=0,e=0,g=0,i=0,j=0,p=0,k=t.width(),u=f.outerHeight(!1),g=e=h=0,e=t=!1;if(c.autoScale&&("gallery"!=a._settings.mode||"ready"==a._properties.gallery.status)){r.css({height:"100%",width:"100%",overflow:"hidden"});e=C(a);e.popup.css({height:"auto",width:"auto",top:"auto",left:"auto"});e.content.attr("style","");e.content.find("img").css({"max-width":"none",
height:"auto",display:"block"});e.content.find("iframe").css({"max-height":"none","max-width":"none"});if(B(e))return!1;g=e.popup.width();i=e.popup.height();j=e.popup.outerWidth(!1)-g;p=e.popup.outerHeight(!1)-i;e&&e.container&&e.container.remove();h=0.8*k-j;e=0.8*u-p;h>c.maxwidth&&(h=c.maxwidth);e>c.maxheight&&(e=c.maxheight);i>e||g>h?i/g>e/h?(h=e,m=g*(e/i)):(m=h,h=i*(h/g)):(m=g,h=i)}else{h=0.8*k;e=0.8*u;j=d.outerWidth(!1)-d.width();p=d.outerHeight(!1)-d.height();m=h-j;h=e-p;e=C(a);e.popup.css({height:"auto",
width:"auto",top:"0",left:"0"});e.content.attr("style","");e.gallery_loading_area.attr("style","");g=e.content;"gallery"!=a._settings.mode||"ready"==a._properties.gallery.status?(e.content.css("display","block"),e.gallery_loading_area.css("display","none")):(e.content.css("display","none"),e.gallery_loading_area.css("display","block"),r=v,g=e.gallery_loading_area);if(s(c.width))m=c.width;else if((c.scaleToContent||"ready"!=a._properties.gallery.status)&&e.popup.width()<m)m=e.popup.width();s(c.maxwidth)&&
m>c.maxwidth&&(m=c.maxwidth);e.popup.css({width:m});s(c.height)?h=c.height:c.innerOverflow||(h=e.popup.height());s(c.maxheight)&&h>c.maxheight&&(h=c.maxheight);0==parseInt(g.css("margin-top"))&&g.css({"margin-top":"-1px",top:"1px"});B(e)&&(b=!1);var v=g.outerHeight(!0),i=v-g.height(),n=parseInt(e.popup.css("padding-top")),q=parseInt(e.popup.css("border-top-width")),w=parseInt(e.popup.css("margin-top"));isNaN(n)&&(n=0);isNaN(q)&&(q=0);isNaN(w)&&(w=0);g=h-(g.position().top-(n+q+w));!a._properties.newopen&&
0<c.animateSpeed?r.stop(!0,!1).height(r.height()).animate({height:g-i},c.animateSpeed):r.stop(!0,!1).css({height:g-i});v>g&&c.innerOverflow&&r.css("overflow-y","scroll");e&&e.container&&e.container.remove();g=0.05*u;e=h+p;e>0.9*u?(t=g,f.css("overflow-y","scroll"),a.bottom_push.css({top:g+e+"px",height:g+"px",width:"1px"}),a.shadow.css({height:2*g+e+"px"})):(a.bottom_push.css({top:"0px",height:"0px",width:"0px"}),a.shadow.css({height:"100%"}))}f=(k-(m+j))/2;p=(u-(h+p))/2;!1!==t&&(p=t);!a._properties.newopen&&
0<c.animateSpeed?d.animate({left:f,top:p,width:m,height:h},c.animateSpeed,function(){D(a)}).css("overflow",""):(d.css({left:f,top:p,width:m,height:h}),D(a))}return b}function F(a){a.content_area.show();a.gallery_loading_area.hide();a._properties.gallery.status="ready"}function G(a){var a=l(a,!1),b=!0;if(a&&a.popup){var c=a._properties.loaded_images;if(c.length)for(var d=0;d<c.length;d++){var f=c[d];!f.complete&&(4!==f.readyState&&"complete"!==f.readyState)&&(b=!1)}}b&&F(a);return b}function J(a){if((a=
l(a,!1))&&a.popup){a._properties.loaded_images=[];var b=a.content_area.find("img");if(0<b.length){var c=a;if("gallery"==c._settings.mode){var d=j(c._settings.gallery.loading,!0)?c._settings.gallery.loading:c._defaultSettings.gallery.loading;c.content_area.hide();c.gallery_loading_area.show();c.gallery_loading_area.html(d);c._properties.gallery.status="loading"}var f=0;b.each(function(b,c){if(c.src){var d=new Image;c.complete||4===c.readyState||"complete"===c.readyState?f++:("undefined"!==typeof d.onload?
d.onload=function(){setTimeout(function(){G(a)&&a.adjust(!0)},10)}:"undefined"!==typeof d.onreadystatechange&&(d.onreadystatechange=function(){setTimeout(function(){G(a)&&a.adjust(!0)},10)}),"undefined"!==typeof d.onerror&&(d.onerror=function(){setTimeout(function(){i(c).remove();var b=a;if("gallery"==b._settings.mode){var d=j(b._settings.gallery.error,!0)?b._settings.gallery.error:b._defaultSettings.gallery.error;b.content_area.hide();b.gallery_loading_area.show();b.gallery_loading_area.html(d);
b._properties.gallery.status="error";b.adjust(!0)}},10)}));d.src=c.src;a._properties.loaded_images.push(d)}});if(b.length==f)return!0}else return!0}return!1}function H(a){I(a);"gallery"==a._settings.mode&&(a._settings.autoScale=!0);a.content_area.find("img").hide();a.shadow.css({height:"100%"});a.container.scrollTop(0);if(a._settings.gallery.name){var b=i("."+a._settings.gallery.name);if(b.length&&(b.each(function(){var b=i(this);if(0==b.closest(".popbox-container").length){var c=n(b,"src"),b=n(b,
"href");(c=c?c:b)&&-1==x(c,a._properties.gallery.images)&&a._properties.gallery.images.push(c)}}),0<a._properties.gallery.images.length)){var b="",c=a.content_area.find("img:first");c.length&&(b=n(c.eq(0),"src"));c=x(b,a._properties.gallery.images);a._properties.gallery.position=0;""==b||-1==c?a._properties.gallery.images.unshift(b):-1<c&&(a._properties.gallery.position=c);var d=a;if((d=l(d,!1))&&d.popup&&1<d._properties.gallery.images.length){d.popup.append('<a href="#" class="popbox-gallery-next">&nbsp;'+
d._settings.gallery.next+"</a>");d.gallery_next=d.popup.find(".popbox-gallery-next");d.popup.append('<a href="#" class="popbox-gallery-prev">'+d._settings.gallery.prev+"&nbsp;</a>");d.gallery_prev=d.popup.find(".popbox-gallery-prev");var f=!1,j=!1;d.gallery_next.click(function(a){a.preventDefault();d._properties.gallery.position++;d._properties.gallery.position>=d._properties.gallery.images.length&&(d._properties.gallery.position=0);A(d)}).mousemove(function(){f||(d.gallery_next.addClass("popbox-btn-hover"),
f=!0,setTimeout(function(){f=!1},200))}).mouseleave(function(){d.gallery_next.removeClass("popbox-btn-hover")});d.gallery_prev.click(function(a){a.preventDefault();d._properties.gallery.position--;0>d._properties.gallery.position&&(d._properties.gallery.position=d._properties.gallery.images.length-1);A(d)}).mousemove(function(){j||(d.gallery_prev.addClass("popbox-btn-hover"),j=!0,setTimeout(function(){j=!1},200))}).mouseleave(function(){d.gallery_prev.removeClass("popbox-btn-hover")})}}}}function I(a){a.content_area.show();
a.gallery_loading_area.hide();a._properties.gallery.status="ready";a._properties.gallery.images=[];a._properties.gallery.position=0;if((a=l(a,!1))&&a.popup)a.gallery_next&&a.gallery_next.remove(),a.gallery_prev&&a.gallery_prev.remove(),a.gallery_next=!1,a.gallery_prev=!1}null!=RegExp&&null==RegExp.escape&&(RegExp.escape=function(a){return a.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")});var k=function(a){a=l(a,{});this.$window=i(window);this.$html=i("html");this.$body=i("body");this._settings=i.extend(!0,
{},this._defaultSettings,a);this.shadow=this.popup=this.container=!1;this._properties={animating:!1,isopen:!1,newopen:!0,newopentime:0,retrytime:0,resizepause:!1,loaded_content:-1,loaded_images:[],stored_styles:{htmlOverflow:"",htmlHeight:"",htmlMarginRight:""},gallery:{status:"ready",images:[],position:0}}};k.prototype.adjust=function(a){var a=l(a,!1),b=this;if(b._properties.isopen&&(a||!b._properties.resizepause)){var c=!1;b._properties.loaded_content!==b._settings.content&&(c=J(b),b._properties.loaded_content=
b._settings.content);c&&F(b);if(b._properties.newopen)E(b),b._properties.newopen=!1;else{var c=1,d="normal";"gallery"==b._settings.mode&&"loading"==b._properties.gallery.status?(c=100,d="loading"):s(a,!0)?c=a:a||(c=b._settings.updatePositionDelay);b._properties.resizepause=!0;b._properties.resizetimer=setTimeout(function(){if("normal"==d||"loading"==d&&"error"!=b._properties.gallery.status)E(b)?b._properties.retrytime=0:3E3<=b._properties.retrytime?b._properties.retrytime=0:(b.adjust(100),b._properties.retrytime+=
100);b._properties.resizepause=!1;b._properties.resizetimer=!1},c)}}};k.prototype.refresh=function(){this._properties.loaded_content=-1;this._properties.loaded_images=[]};k.prototype.close=function(){var a=this;if(!a._properties.animating&&a._properties.isopen){if("function"===typeof a._settings.onClose)a._settings.onClose(a);a._properties.animating=!0;a.container.fadeOut(a._settings.fadeOutSpeed,function(){y(a,"close")});a.$window.off("resize.popbox.adjust");a._properties.isopen=!1;a.refresh();"gallery"==
a._settings.mode&&a.update({content:""},!1);"function"===typeof a._settings.afterClose&&a._settings.afterClose(a)}};k.prototype.open=function(){var a=this;a.refresh();if(!a._properties.animating&&!a._properties.isopen){if("function"===typeof a._settings.onOpen)a._settings.onOpen(a);a._properties.animating=!0;var b=j(this._settings.close,!0)?a._settings.close:a._defaultSettings.close,c=j(this._settings.content,!0)?a._settings.content:"",d=j(this._settings.title,!0)?'<div class="popbox-title">'+a._settings.title+
"</div>":"",f=j(this._settings.customClass,!0)?" "+a._settings.customClass:"",l=j(this._settings.gallery.loading,!0)?a._settings.gallery.loading:a._defaultSettings.gallery.loading;a._properties.stored_styles.htmlOverflow=q(a.$html,"overflow");a._properties.stored_styles.htmlHeight=q(a.$html,"height");a._properties.stored_styles.htmlMarginRight=q(a.$html,"margin-right");var k=a.$body.width();a.$html.css({overflow:"hidden",height:"100%"});var n=a.$body.width();n>k&&a.$html.css({"margin-right":n-k+"px"});
a.$body.append('<div class="popbox-container'+f+'" style="display: none;"><div class="popbox-bottom-push"></div><a class="popbox-shadow" href="javascript:void(0);"></a><div class="popbox-popup">'+d+'<div class="popbox-content">'+c+'</div><div class="popbox-gallery-loading">'+l+'</div><a href="#" class="popbox-close">'+b+"</a></div></div>");a.container=i(".popbox-container");a.popup=a.container.find(".popbox-popup");a.shadow=a.container.find(".popbox-shadow");a.bottom_push=a.container.find(".popbox-bottom-push");
a.close_button=a.container.find(".popbox-close");a.title_area=a.container.find(".popbox-title");a.content_area=a.container.find(".popbox-content");a.gallery_loading_area=a.container.find(".popbox-gallery-loading");a.container.css({display:"none",height:"100%",width:"100%",position:"fixed",left:"0px",top:"0px","z-index":"990","background-color":"rgba(0,0,0,0.4)","overflow-x":"hidden"});a.bottom_push.css({display:"block",position:"absolute",left:"0px",top:"0px",height:"0px",width:"1px","z-index":"992"});
a.popup.css({display:"block",position:"absolute",top:"0px",left:"0px","z-index":"993","-webkit-box-sizing":"content-box","-moz-box-sizing":"content-box","box-sizing":"content-box"});a.shadow.css({display:"block",position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%","z-index":"991",background:"#fff",opacity:"0",cursor:"default"});a.content_area.css({overflow:"hidden",height:"auto"});a.gallery_loading_area.css({overflow:"hidden",height:"auto"});"gallery"==a._settings.mode&&H(a);a.container.fadeIn(a._settings.fadeInSpeed,
function(){y(a,"open")});a.shadow.click(function(b){a.close();b.preventDefault()});a.close_button.click(function(b){a.close();b.preventDefault()});a.$window.on("resize.popbox.adjust",function(){a.adjust()});a._properties.isopen=!0;a._properties.newopen=!0;a._properties.newopentime=(new Date).getTime();a.adjust();"function"===typeof a._settings.afterOpen&&a._settings.afterOpen(a)}};k.prototype.update=function(a,b){a=l(a,{});b=l(b,!0);this._settings=i.extend(!0,{},this._settings,a);if(this._properties.isopen){var c=
j(this._settings.close,!0)?this._settings.close:this._defaultSettings.close,d=j(this._settings.content,!0)?this._settings.content:"",f=j(this._settings.title,!0)?this._settings.title:"";0<this.close_button.length&&this.close_button.html(c);0<this.content_area.length&&this.content_area.html(d);0<this.title_area.length?""!=f?this.title_area.html(f):(this.title_area.remove(),this.title_area=this.popup.find(".popbox-title")):""!=f&&(this.popup.prepend('<div class="popbox-title">'+f+"</div>"),this.title_area=
this.popup.find(".popbox-title"));"gallery"==this._settings.mode?H(this):I(this);b?this.adjust(!0):z(this)}};k.prototype.isOpen=function(){return!0==this._properties.isopen};k.prototype.isClose=function(){return!1==this._properties.isopen};k.prototype._defaultSettings={width:"auto",height:"auto",maxwidth:"none",maxheight:"none",innerOverflow:!1,scaleToContent:!1,content:"",close:"X",title:"",onOpen:!1,onClose:!1,afterOpen:!1,afterClose:!1,fadeInSpeed:400,fadeOutSpeed:400,updatePositionDelay:200,autoScale:!1,
customClass:"",animateSpeed:400,mode:"normal",gallery:{loading:'<div style="padding:10px;">Loading...</div>',error:'<div style="padding:10px;">There was an error loading the image.</div>',name:"",next:"<span>&#x25B6;</span>",prev:"<span>&#x25C0;</span>"}};window.PopBox=k})(jQuery);
