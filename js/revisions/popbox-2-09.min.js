(function(g){function n(a,b){return"undefined"!==typeof a?a:b}function r(a,b){b=n(b,!1);return!isNaN(a-0)&&null!=a&&""!=a&&(!b||0<a)}function l(a,b){b=n(b,!1);return"string"===typeof a&&null!=a&&(!b||""!=a)}function x(a,b){if(a.properties.animating)switch(a.properties.animating=!1,b){case "close":a.container.remove();a.container=!1;a.properties.isopen=!1;a.popup=!1;a.shadow=!1;g("body").css({overflow:a.properties.bodyOverflow,"margin-right":a.properties.bodyMarginRight});g(document).off("scroll.popbox touchmove.popbox mousewheel.popbox");
break;case "open":a.properties.isopen=!0}}function p(a,b){var a=n(a,!1),b=n(b,!1),c=!0;if(a&&a.popup){var j=a.popup.find("img");0<j.length&&j.each(function(a,b){!b.complete&&(4!==b.readyState&&"complete"!==b.readyState)&&(c=!1)})}"gallery"==a.settings.mode&&(c?(a.content_area.show(),a.gallery_loading_area&&a.gallery_loading_area.hide(),a.properties.gallery.isloading=!1):(a.content_area.hide(),a.gallery_loading_area&&a.gallery_loading_area.show(),a.properties.gallery.isloading=!0));c&&b&&y(a);return c}
function z(a){a.popup.find("img").css({"max-width":"100%",height:"auto",display:"block"});a.popup.find("iframe").css({"max-height":"100%","max-width":"100%"})}function A(a){var b=g("body"),a=a.container.clone().stop(!0,!0).addClass("popbox-rsc-clone").css({display:"block",visibility:"hidden","z-index":"-1",overflow:"hidden"});a.find("iframe").attr("src","");a.appendTo(b);b=b.find(".popbox-rsc-clone");return{container:b,popup:b.find(".popbox-popup").eq(0),content:b.find(".popbox-content").eq(0),gallery_loading_area:b.find(".popbox-gallery-loading").eq(0)}}
function y(a,b){b=n(b,!1);if((a=n(a,!1))&&a.popup){var c=a.settings,j=a.popup,i=a.container,m=a.content_area,s=a.gallery_loading_area;j.stop(!0,!1);var k=0,f=0,d=0,e=0,g=0,l=0,q=0,h=i.outerWidth(!1),p=i.outerHeight(!1),e=d=f=0,t=!1,d=!1;z(a);if(c.autoScale&&!a.properties.gallery.isloading)m.css({height:"100%",width:"100%",overflow:"hidden"}),d=A(a),d.popup.css({height:"auto",width:"auto",top:"auto",left:"auto"}),d.content.attr("style",""),d.content.find("img").css({"max-width":"none",height:"auto",
display:"block"}),d.content.find("iframe").css({"max-height":"none","max-width":"none"}),e=d.popup.width(),g=d.popup.height(),l=d.popup.outerWidth(!1)-e,q=d.popup.outerHeight(!1)-g,d&&d.container&&d.container.remove(),f=0.8*h-l,d=0.8*p-q,f>c.maxwidth&&(f=c.maxwidth),d>c.maxheight&&(d=c.maxheight),g>d||e>f?g/e>d/f?(f=d,k=e*(d/g)):(k=f,f=g*(f/e)):(k=e,f=g);else{f=0.8*h;d=0.8*p;l=j.outerWidth(!1)-j.width();q=j.outerHeight(!1)-j.height();k=f-l;f=d-q;d=A(a);d.popup.css({height:"auto",width:"auto",top:"0",
left:"0"});d.content.attr("style","");d.gallery_loading_area.attr("style","");e=d.content;a.properties.gallery.isloading?(d.content.css("display","none"),d.gallery_loading_area.css("display","block"),m=s,e=d.gallery_loading_area):(d.content.css("display","block"),d.gallery_loading_area.css("display","none"));r(c.width)?k=c.width:d.popup.width()<k&&(k=d.popup.width());r(c.maxwidth)&&k>c.maxwidth&&(k=c.maxwidth);d.popup.css({width:k});r(c.height)?f=c.height:c.innerOverflow||(f=d.popup.height());r(c.maxheight)&&
f>c.maxheight&&(f=c.maxheight);0==parseInt(e.css("margin-top"))&&e.css({"margin-top":"-1px",top:"1px"});var s=e.outerHeight(!0),g=s-e.height(),u=parseInt(d.popup.css("padding-top")),v=parseInt(d.popup.css("border-top-width")),w=parseInt(d.popup.css("margin-top"));isNaN(u)&&(u=0);isNaN(v)&&(v=0);isNaN(w)&&(w=0);e=f-(e.position().top-(u+v+w));!0===b&&0<c.animateSpeed?m.stop(!0,!1).height(m.height()).animate({height:e-g},c.animateSpeed):m.css({height:e-g});s>e&&c.innerOverflow&&m.css("overflow-y","scroll");
d&&d.container&&d.container.remove();e=0.05*p;d=f+q;d>0.9*p?(t=e,i.css("overflow","auto"),a.bottom_push.css({top:e+d+"px",height:e+"px",width:"1px"}),a.shadow.css({height:2*e+d+"px"})):(i.css("overflow",""),a.bottom_push.css({top:"0px",height:"0px",width:"0px"}),a.shadow.css({height:"100%"}))}i=(h-(k+l))/2;q=(p-(f+q))/2;!1!==t&&(q=t);!0===b&&0<c.animateSpeed?j.animate({left:i,top:q,width:k,height:f},c.animateSpeed).css("overflow",""):j.css({left:i,top:q,width:k,height:f})}}var h=function(a){a=n(a,
{});"gallery"==a.mode&&null==a.autoScale&&(a.autoScale=!0);this.settings=g.extend({},this.defaultSettings,a);this.shadow=this.popup=this.container=!1;this.properties={animating:!1,isopen:!1,resizepause:!1,loaded_content:-1,bodyMarginRight:"",bodyOverflow:"",gallery:{isloading:!1}}};h.prototype.adjust=function(a){var a=n(a,!1),b=this;if(!b.properties.resizepause&&(!a||b.properties.isopen))if(b.properties.resizepause=!0,setTimeout(function(){y(b,a);b.properties.resizepause=!1},b.properties.updatePositionDelay),
b.properties.loaded_content!==b.settings.content){if(!p(b)){var c=b;if((c=n(c,!1))&&c.popup){var j=c.popup.find("img");if(0<j.length){var i=0;j.each(function(a,b){b.complete||4===b.readyState||"complete"===b.readyState?i++:("undefined"!==typeof b.onload?b.onload=function(){"undefined"!==typeof b.readyState?setTimeout(function(){p(c,!0)},10):p(c,!0)}:"undefined"!==typeof b.onreadystatechange&&(b.onreadystatechange=function(){setTimeout(function(){p(c,!0)},10)}),"gallery"==c.settings.mode&&c.gallery_loading_area&&
"undefined"!==typeof b.onerror&&(b.onerror=function(){var a=l(c.settings.gallery.error,!0)?c.settings.gallery.error:c.defaultSettings.gallery.error;c.gallery_loading_area.html(a);c.properties.gallery.isloading=!0;g(b).remove();c.adjust(!1)}))});j.length==i&&p(c,!0)}}}b.properties.loaded_content=b.settings.content}};h.prototype.checkImages=function(){this.properties.loaded_content=-1};h.prototype.close=function(){var a=this;if(!a.properties.animating&&a.properties.isopen){if("function"===typeof a.settings.onClose)a.settings.onClose(a);
a.properties.animating=!0;a.container.fadeOut(a.settings.fadeOutSpeed,function(){x(a,"close")});g(window).off("resize.popbox.adjust");a.properties.isopen=!1;a.checkImages();"function"===typeof a.settings.afterClose&&a.settings.afterClose(a)}};h.prototype.open=function(){var a=this;if(!a.properties.animating&&!a.properties.isopen){if("function"===typeof a.settings.onOpen)a.settings.onOpen(a);a.properties.animating=!0;var b=l(this.settings.close,!0)?a.settings.close:a.defaultSettings.close,c=l(this.settings.content,
!0)?a.settings.content:"",j=l(this.settings.title,!0)?'<div class="popbox-title">'+a.settings.title+"</div>":"",i=l(this.settings.customClass,!0)?" "+a.settings.customClass:"",m=g("body");a.properties.bodyOverflow=m.css("overflow");var h=m.width();m.css("overflow","hidden");var k=m.width();k>h&&(a.properties.bodyMarginRight=m.css("margin-right"),h=parseInt(a.properties.bodyMarginRight)+(k-h),m.css("margin-right",h+"px"));g(document).on("scroll.popbox touchmove.popbox mousewheel.popbox",function(){});
m.append('<div class="popbox-container'+i+'" style="display: none;"><div class="popbox-bottom-push"></div><a class="popbox-shadow" href="javascript:void(0);"></a><div class="popbox-popup">'+j+'<a class="popbox-close">'+b+'</a><div class="popbox-content">'+c+"</div></div></div>");a.container=g(".popbox-container");a.popup=a.container.find(".popbox-popup");a.shadow=a.container.find(".popbox-shadow");a.bottom_push=a.container.find(".popbox-bottom-push");a.close_button=a.container.find(".popbox-close");
a.title_area=a.container.find(".popbox-title");a.content_area=a.container.find(".popbox-content");a.gallery_loading_area=!1;a.container.css({display:"none",height:"100%",width:"100%",position:"fixed",left:"0px",top:"0px","z-index":"990","background-color":"rgba(0,0,0,0.4)"});a.bottom_push.css({display:"block",position:"absolute",left:"0px",top:"0px",height:"0px",width:"1px","z-index":"992"});a.popup.css({display:"block",position:"absolute",top:"0px",left:"0px","z-index":"993"});a.shadow.css({display:"block",
position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%","z-index":"991",background:"#fff",opacity:"0",cursor:"default"});a.content_area.css({overflow:"hidden",height:"auto"});"gallery"==a.settings.mode&&(a.content_area.hide(),b=l(this.settings.gallery.loading,!0)?a.settings.gallery.loading:a.defaultSettings.gallery.loading,a.content_area.after('<div class="popbox-gallery-loading">'+b+"</div>"),a.gallery_loading_area=a.container.find(".popbox-gallery-loading"),a.gallery_loading_area.css({overflow:"hidden",
height:"auto"}));a.adjust();a.container.fadeIn(a.settings.fadeInSpeed,function(){x(a,"open")});a.shadow.click(function(b){a.close();b.preventDefault()});a.close_button.click(function(b){a.close();b.preventDefault()});g(window).on("resize.popbox.adjust",function(){a.adjust(!0)});a.properties.isopen=!0;"function"===typeof a.settings.afterOpen&&a.settings.afterOpen(a)}};h.prototype.update=function(a,b,c){a=n(a,{});b=n(b,!0);c=n(c,!0);this.settings=g.extend({},this.settings,a);if(this.properties.isopen){var a=
l(this.settings.close,!0)?this.settings.close:this.defaultSettings.close,h=l(this.settings.content,!0)?this.settings.content:"",i=l(this.settings.title,!0)?this.settings.title:"";0<this.close_button.length&&this.close_button.html(a);0<this.content_area.length&&this.content_area.html(h);0<this.title_area.length?""!=i?this.title_area.html(i):(this.title_area.remove(),this.title_area=this.popup.find(".popbox-title")):""!=i&&(this.popup.prepend('<div class="popbox-title">'+i+"</div>"),this.title_area=
this.popup.find(".popbox-title"));b?this.adjust(c):z(this)}};h.prototype.isOpen=function(){return!0==this.properties.isopen};h.prototype.isClose=function(){return!1==this.properties.isopen};h.prototype.defaultSettings={width:"auto",height:"auto",maxwidth:"none",maxheight:"none",innerOverflow:!1,content:"",close:"X",title:"",onOpen:!1,onClose:!1,afterOpen:!1,afterClose:!1,fadeInSpeed:400,fadeOutSpeed:400,updatePositionDelay:200,autoScale:!1,customClass:"",animateSpeed:400,mode:"normal",gallery:{loading:"Loading",
error:"Error"}};window.PopBox=h})(jQuery);
