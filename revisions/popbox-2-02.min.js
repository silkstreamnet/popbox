(function(g){function e(a,b){return"undefined"!==typeof a?a:b}function m(a,b){b=e(b,!1);return!isNaN(a-0)&&null!=a&&""!=a&&(!b||0<a)}function k(a,b){b=e(b,!1);return"string"===typeof a&&null!=a&&(!b||""!=a)}function p(a,b){if(a.properties.animating)switch(a.properties.animating=!1,b){case "close":a.container.remove();a.properties.isopen=!1;a.container=!1;a.popup=!1;a.shadow=!1;break;case "open":a.properties.isopen=!0}}function n(a,b){var a=e(a,!1),b=e(b,!1),d=!0;if(a&&a.popup){var c=a.popup.find("img");0<c.length&&c.each(function(a,b){b.complete||(d=!1)})}b&&d&&q(a,!0);return d}function q(a,b){b=e(b,!1);if(a=e(a,!1)){var d=a.popup,c={forceAbsolute:!1,container:window,completeHandler:null,animate:!0,width:"auto",height:"auto",maxwidth:"none",maxheight:"none",push_obj:!1,shadow:!1};g.extend(c,{animate:b,container:a.container,width:a.settings.width,height:a.settings.height,maxwidth:a.settings.maxwidth,maxheight:a.settings.maxheight,push_obj:a.bottom_push,shadow:a.shadow});d.each(function(){var a=g(this),b=g(c.container),j=c.container==window;c.forceAbsolute&&(j?a.remove().appendTo("body"):a.remove().appendTo(b.get(0)));var e={position:a.css("position"),visibility:a.css("visibility"),display:a.css("display")},f={visibility:b.css("visibility"),display:b.css("display")},i={visibility:"hidden",display:"block"};a.css({position:"absolute",visibility:"hidden",display:"block"});j||b.css(i);var i=0.8*(j?b.width():b.outerWidth(!1)),h=a.outerWidth(!1)-a.width(),i=i-h;m(c.width)?a.width(c.width):m(c.maxwidth)&&i>c.maxwidth?a.width(c.maxwidth):a.width(i);m(c.height)&&a.height(c.height);var h=0.05*(j?b.height():b.outerHeight(!1)),l=0.9*(j?b.height():b.outerHeight(!1)),k=a.outerHeight(!1),i=!1;k>l?(i=h,b.css("overflow","auto"),c.push_obj.css({top:h+k+"px",height:h+"px",width:"1px"}),c.shadow.css({height:2*h+k+"px"})):(b.css("overflow",""),c.push_obj.css({top:"0px",height:"0px",width:"0px"}),c.shadow.css({height:"100%"}));h=((j?b.width():b.outerWidth(!1))-a.outerWidth(!1))/2;l=((j?b.height():b.outerHeight(!1))-a.outerHeight(!1))/2;!1!==i&&(l=i);j&&(h+=b.scrollLeft(),l+=b.scrollTop());a.css(e);j||b.css(f);!0===c.animate?a.stop(!0,!0).animate({left:h,top:l},500):a.stop(!0,!0).css({left:h,top:l});c.completeHandler&&c.completeHandler(d)})}}var f=function(a){a=e(a,{});this.settings=g.extend({},this.defaultSettings,a);this.shadow=this.container=!1;this.properties={animating:!1,isopen:!1,resizepause:!1,loaded_content:-1}};f.prototype.adjust=function(a){var a=e(a,!1),b=this;if(!b.properties.resizepause&&(!a||b.properties.isopen))if(b.properties.resizepause=!0,setTimeout(function(){q(b,a);b.properties.resizepause=!1},b.properties.updatePositionDelay),b.properties.loaded_content!==b.settings.content){if(!n(b)){var d=b;if((d=e(d,!1))&&d.popup){var c=d.popup.find("img");if(0<c.length){var f=0;c.each(function(a,b){b.complete?f++:g(b).load(function(){n(d,!0)})});c.length==f&&n(d,!0)}}}b.properties.loaded_content=b.settings.content}};f.prototype.checkImages=function(){this.properties.loaded_content=-1};f.prototype.close=function(){var a=this;if(!a.properties.animating&&a.properties.isopen&&("function"===typeof a.settings.beforeClose&&a.settings.beforeClose(a),a.properties.animating=!0,a.container.fadeOut(a.settings.fadeOutSpeed,function(){p(a,"close");g("body").css({overflow:"","margin-right":""})}),g(window).off("resize.popbox.adjust"),a.properties.isopen=!1,"function"===typeof a.settings.onClose))a.settings.onClose(a)};f.prototype.open=function(){var a=this;if(!a.properties.animating&&!a.properties.isopen){"function"===typeof a.settings.beforeOpen&&a.settings.beforeOpen(a);a.properties.animating=!0;var b=k(this.settings.close,!0)?a.settings.close:this.defaultSettings.close,d=k(this.settings.content,!0)?a.settings.content:"",c=g("body"),e=c.width();c.css("overflow","hidden");var f=c.width();f>e&&(e=parseInt(c.css("margin-right"))+(f-e),c.css("margin-right",e+"px"));c.append('<div class="popbox-container" style="display: none;"><div class="popbox-bottom-push"></div><a class="popbox-shadow" href="javascript:void(0);"></a><div class="popbox-popup"><a class="popbox-close">'+b+"</a>"+d+"</div></div>");a.container=g(".popbox-container");a.popup=a.container.find(".popbox-popup");a.shadow=a.container.find(".popbox-shadow");a.bottom_push=a.container.find(".popbox-bottom-push");a.close_button=a.container.find(".popbox-close");a.container.css({display:"none",height:"100%",width:"100%",position:"fixed",left:"0px",top:"0px","z-index":"990","background-color":"rgba(0,0,0,0.4)"});a.bottom_push.css({display:"block",position:"absolute",left:"0px",top:"0px",height:"0px",width:"1px","z-index":"992"});a.popup.css({display:"block",visibility:"visible",position:"absolute",top:"0px",left:"0px","z-index":"993"});a.shadow.css({display:"block",position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%","z-index":"991",background:"#fff",opacity:"0",filter:"alpha(opacity=0)",cursor:"default"});a.adjust();a.container.fadeIn(a.settings.fadeInSpeed,function(){p(a,"open")});a.shadow.click(function(b){a.close();b.preventDefault()});a.close_button.click(function(b){a.close();b.preventDefault()});g(window).on("resize.popbox.adjust",function(){a.adjust(!0)});a.properties.isopen=!0;if("function"===typeof a.settings.onOpen)a.settings.onOpen(a)}};f.prototype.setSettings=function(a,b){var d=this,c=!1,a=e(a,{}),b=e(b,!0);!1!==e(a.content,!1)&&a.content!=d.settings.content&&(c=!0);d.settings=g.extend({},d.settings,a);if(d.properties.isopen){if(c){var c=k(this.settings.close,!0)?d.settings.close:this.defaultSettings.close,f=k(this.settings.content,!0)?d.settings.content:"";d.popup.html('<a class="popbox-close">'+c+"</a>"+f);d.close_button=d.popup.find(".popbox-close");d.close_button.click(function(a){d.close();a.preventDefault()})}b&&d.adjust(!0)}};f.prototype.isOpen=function(){return!0==this.properties.isopen};f.prototype.isClose=function(){return!1==this.properties.isopen};f.prototype.defaultSettings={width:"auto",height:"auto",maxwidth:"none",maxheight:"none",content:"",close:"X",onOpen:!1,onClose:!1,beforeOpen:!1,beforeClose:!1,fadeInSpeed:400,fadeOutSpeed:400,updatePositionDelay:200};window.PopBox=f})(jQuery);
