(function(p){function l(a,b){return"undefined"!==typeof a?a:b}function q(a,b){b=l(b,!1);return!isNaN(a-0)&&null!=a&&""!=a&&(!b||0<a)}function k(a,b){b=l(b,!1);return"string"===typeof a&&null!=a&&(!b||""!=a)}function t(a,b){if(a.properties.animating)switch(a.properties.animating=!1,b){case "close":a.container.remove();a.properties.isopen=!1;a.container=!1;a.popup=!1;a.shadow=!1;break;case "open":a.properties.isopen=!0}}function v(a,b){var d={forceAbsolute:!1,container:window,completeHandler:null,animate:!0,width:"auto",height:"auto",maxwidth:"none",maxheight:"none",push_obj:!1,shadow:!1,autoScale:!1,innerOverflow:!1};p.extend(d,b);a.each(function(c){c=p(this);var b=p(d.container),h=d.container==window;d.forceAbsolute&&(h?c.remove().appendTo("body"):c.remove().appendTo(b.get(0)));var l={position:c.css("position"),visibility:c.css("visibility"),display:c.css("display")},g={visibility:b.css("visibility"),display:b.css("display")},r={visibility:"hidden",display:"block"};c.css({position:"absolute",visibility:"hidden",display:"block"});h||b.css(r);var f,e,n,m,r=!1;if(d.autoScale){c.css({height:"",width:""});f=.8*(h?b.width():b.outerWidth(!1));e=.8*(h?b.height():b.outerHeight(!1));var k=c.outerWidth(!1),s=c.outerHeight(!1);n=c.width();m=c.height();f-=k-n;e-=s-m;m>e||n>f?(k=1,m/n>e/f?(k=e/m,c.height(e),c.width(n*k)):(k=f/n,c.width(f),c.height(m*k))):(c.width(n),c.height(m));c.find("img").css({"max-width":"100%",height:"auto",display:"block"});c.find("iframe").css({"max-height":"100%","max-width":"100%"})}else{f=.8*(h?b.width():b.outerWidth(!1));e=.8*(h?b.height():b.outerHeight(!1));n=c.outerWidth(!1)-c.width();m=c.outerHeight(!1)-c.height();f-=n;e-=m;q(d.width)?c.width(d.width):q(d.maxwidth)&&f>d.maxwidth?c.width(d.maxwidth):c.width(f);if(q(d.height))c.height(d.height);else if(d.innerOverflow||q(d.maxheight))q(d.maxheight)&&e>d.maxheight?c.height(d.maxheight):c.height(e),e=c.find(".popbox-content"),1==e.length&&(e.css({"overflow-y":"",height:"",position:"relative"}),0==parseInt(e.css("margin-top"))&&e.css({"margin-top":"-1px",top:"1px"}),f=e.outerHeight(!0),m=f-e.height(),n=parseInt(c.css("padding-top"))+parseInt(c.css("border-top-width"))+parseInt(c.css("margin-top")),n=c.height()-(e.position().top-n),f>n&&(e.css("overflow-y","scroll"),e.height(n-m)));f=.05*(h?b.height():b.outerHeight(!1));e=.9*(h?b.height():b.outerHeight(!1));m=c.outerHeight(!1);m>e?(r=f,b.css("overflow","auto"),d.push_obj.css({top:f+m+"px",height:f+"px",width:"1px"}),d.shadow.css({height:2*f+m+"px"})):(b.css("overflow",""),d.push_obj.css({top:"0px",height:"0px",width:"0px"}),d.shadow.css({height:"100%"}))}e=((h?b.width():b.outerWidth(!1))-c.outerWidth(!1))/2;f=((h?b.height():b.outerHeight(!1))-c.outerHeight(!1))/2;!1!==r&&(f=r);h&&(e+=b.scrollLeft(),f+=b.scrollTop());c.css(l);h||b.css(g);!0===d.animate?c.stop(!0,!0).animate({left:e,top:f},500):c.stop(!0,!0).css({left:e,top:f});d.completeHandler&&d.completeHandler(a)})}function s(a,b){a=l(a,!1);b=l(b,!1);var d=!0;if(a&&a.popup){var c=a.popup.find("img");0<c.length&&c.each(function(a,b){b.complete||(d=!1)})}b&&d&&u(a,!0);return d}function w(a){if((a=l(a,!1))&&a.popup){var b=a.popup.find("img");if(0<b.length){var d=0;b.each(function(b,k){k.complete?d++:p(k).load(function(){s(a,!0)})});b.length==d&&s(a,!0)}}}function x(a){a.properties.loaded_content!==a.settings.content&&(s(a)||w(a),a.properties.loaded_content=a.settings.content)}function u(a,b){b=l(b,!1);(a=l(a,!1))&&v(a.popup,{animate:b,container:a.container,width:a.settings.width,height:a.settings.height,maxwidth:a.settings.maxwidth,maxheight:a.settings.maxheight,push_obj:a.bottom_push,shadow:a.shadow,autoScale:a.settings.autoScale,innerOverflow:a.settings.innerOverflow})}var g=function(a){a=l(a,{});this.settings=p.extend({},this.defaultSettings,a);this.shadow=this.container=!1;this.properties={animating:!1,isopen:!1,resizepause:!1,loaded_content:-1}};g.prototype.adjust=function(a){a=l(a,!1);var b=this;b.properties.resizepause||a&&!b.properties.isopen||(b.properties.resizepause=!0,setTimeout(function(){u(b,a);b.properties.resizepause=!1},b.properties.updatePositionDelay),x(b))};g.prototype.checkImages=function(){this.properties.loaded_content=-1};g.prototype.close=function(){var a=this;if(!a.properties.animating&&a.properties.isopen&&("function"===typeof a.settings.beforeClose&&a.settings.beforeClose(a),a.properties.animating=!0,a.container.fadeOut(a.settings.fadeOutSpeed,function(){t(a,"close");p("body").css({overflow:"","margin-right":""})}),p(window).off("resize.popbox.adjust"),a.properties.isopen=!1,a.checkImages(),"function"===typeof a.settings.onClose))a.settings.onClose(a)};g.prototype.open=function(){var a=this;if(!a.properties.animating&&!a.properties.isopen){"function"===typeof a.settings.beforeOpen&&a.settings.beforeOpen(a);a.properties.animating=!0;var b=k(this.settings.close,!0)?a.settings.close:this.defaultSettings.close,d=k(this.settings.content,!0)?a.settings.content:"",c=k(this.settings.title,!0)?'<div class="popbox-title">'+a.settings.title+"</div>":"",l=k(this.settings["class"],!0)?" "+a.settings["class"]:"",h=p("body"),g=h.width();h.css("overflow","hidden");var q=h.width();q>g&&(g=parseInt(h.css("margin-right"))+(q-g),h.css("margin-right",g+"px"));h.append('<div class="popbox-container'+l+'" style="display: none;"><div class="popbox-bottom-push"></div><a class="popbox-shadow" href="javascript:void(0);"></a><div class="popbox-popup">'+c+'<a class="popbox-close">'+b+'</a><div class="popbox-content">'+d+"</div></div></div>");a.container=p(".popbox-container");a.popup=a.container.find(".popbox-popup");a.shadow=a.container.find(".popbox-shadow");a.bottom_push=a.container.find(".popbox-bottom-push");a.close_button=a.container.find(".popbox-close");a.title_area=a.container.find(".popbox-title");a.content_area=a.container.find(".popbox-content");a.container.css({display:"none",height:"100%",width:"100%",position:"fixed",left:"0px",top:"0px","z-index":"990","background-color":"rgba(0,0,0,0.4)"});a.bottom_push.css({display:"block",position:"absolute",left:"0px",top:"0px",height:"0px",width:"1px","z-index":"992"});a.popup.css({display:"block",visibility:"visible",position:"absolute",top:"0px",left:"0px","z-index":"993"});a.shadow.css({display:"block",position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%","z-index":"991",background:"#fff",opacity:"0",filter:"alpha(opacity=0)",cursor:"default"});a.adjust();a.container.fadeIn(a.settings.fadeInSpeed,function(){t(a,"open")});a.shadow.click(function(b){a.close();b.preventDefault()});a.close_button.click(function(b){a.close();b.preventDefault()});p(window).on("resize.popbox.adjust",function(){a.adjust(!0)});a.properties.isopen=!0;if("function"===typeof a.settings.onOpen)a.settings.onOpen(a)}};g.prototype.update=function(a,b){a=l(a,{});b=l(b,!0);this.settings=p.extend({},this.settings,a);if(this.properties.isopen){var d=k(this.settings.close,!0)?this.settings.close:this.defaultSettings.close,c=k(this.settings.content,!0)?this.settings.content:"",g=k(this.settings.title,!0)?this.settings.title:"";0<this.close_button.length&&this.close_button.html(d);0<this.content_area.length&&this.content_area.html(c);0<this.title_area.length?""!=g?this.title_area.html(g):(this.title_area.remove(),this.title_area=this.popup.find(".popbox-title")):""!=g&&(this.popup.prepend('<div class="popbox-title">'+g+"</div>"),this.title_area=this.popup.find(".popbox-title"));b&&this.adjust(!0)}};g.prototype.isOpen=function(){return!0==this.properties.isopen};g.prototype.isClose=function(){return!1==this.properties.isopen};g.prototype.defaultSettings={width:"auto",height:"auto",maxwidth:"none",maxheight:"none",innerOverflow:!1,content:"",close:"X",title:"",onOpen:!1,onClose:!1,beforeOpen:!1,beforeClose:!1,fadeInSpeed:400,fadeOutSpeed:400,updatePositionDelay:200,autoScale:!1,"class":""};window.PopBox=g})(jQuery);
