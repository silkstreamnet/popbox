(function(j){function g(a,b){return"undefined"!==typeof a?a:b}function q(a,b){b=g(b,!1);return!isNaN(a-0)&&null!=a&&""!=a&&(!b||0<a)}function m(a,b){b=g(b,!1);return"string"===typeof a&&null!=a&&(!b||""!=a)}function s(a,b){if(a.properties.animating)switch(a.properties.animating=!1,b){case "close":a.container.remove();a.properties.isopen=!1;a.container=!1;a.popup=!1;a.shadow=!1;break;case "open":a.properties.isopen=!0}}function r(a,b){var a=g(a,!1),b=g(b,!1),e=!0;if(a&&a.popup){var c=a.popup.find("img");
0<c.length&&c.each(function(a,b){b.complete||(e=!1)})}b&&e&&t(a,!0);return e}function t(a,b){b=g(b,!1);if(a=g(a,!1)){var e=a.popup,c={forceAbsolute:!1,container:window,completeHandler:null,animate:!0,width:"auto",height:"auto",maxwidth:"none",maxheight:"none",push_obj:!1,shadow:!1,autoScale:!1};j.extend(c,{animate:b,container:a.container,width:a.settings.width,height:a.settings.height,maxwidth:a.settings.maxwidth,maxheight:a.settings.maxheight,push_obj:a.bottom_push,shadow:a.shadow,autoScale:a.settings.autoScale});
e.each(function(){var a=j(this),b=j(c.container),k=c.container==window;c.forceAbsolute&&(k?a.remove().appendTo("body"):a.remove().appendTo(b.get(0)));var g={position:a.css("position"),visibility:a.css("visibility"),display:a.css("display")},h={visibility:b.css("visibility"),display:b.css("display")},p={visibility:"hidden",display:"block"};a.css({position:"absolute",visibility:"hidden",display:"block"});k||b.css(p);var d,f,l,i,p=!1;if(c.autoScale){a.css({height:"",width:""});d=0.8*(k?b.width():b.outerWidth(!1));
f=0.8*(k?b.height():b.outerHeight(!1));var n=a.outerWidth(!1),m=a.outerHeight(!1);l=a.width();i=a.height();d-=n-l;f-=m-i;i>f||l>d?(n=1,i/l>f/d?(n=f/i,a.height(f),a.width(l*n)):(n=d/l,a.width(d),a.height(i*n))):(a.width(l),a.height(i));a.find("img").css({"max-width":"100%",height:"auto",display:"block"});a.find("iframe").css({"max-height":"100%","max-width":"100%"})}else d=0.8*(k?b.width():b.outerWidth(!1)),f=a.outerWidth(!1)-a.width(),d-=f,q(c.width)?a.width(c.width):q(c.maxwidth)&&d>c.maxwidth?a.width(c.maxwidth):
a.width(d),q(c.height)?a.height(c.height):q(c.maxheight)&&a.outerHeight(!1)>c.maxheight&&a.height(c.maxheight),d=a.find(".popbox-content"),1==d.length&&(f=d.outerHeight(!1),i=d.height(),l=a.height(),f>l?(d.css("overflow-y","scroll"),d.height(l-(f-i))):d.css({"overflow-y":"",height:""})),d=0.05*(k?b.height():b.outerHeight(!1)),f=0.9*(k?b.height():b.outerHeight(!1)),i=a.outerHeight(!1),i>f?(p=d,b.css("overflow","auto"),c.push_obj.css({top:d+i+"px",height:d+"px",width:"1px"}),c.shadow.css({height:2*
d+i+"px"})):(b.css("overflow",""),c.push_obj.css({top:"0px",height:"0px",width:"0px"}),c.shadow.css({height:"100%"}));d=((k?b.width():b.outerWidth(!1))-a.outerWidth(!1))/2;f=((k?b.height():b.outerHeight(!1))-a.outerHeight(!1))/2;!1!==p&&(f=p);k&&(d+=b.scrollLeft(),f+=b.scrollTop());a.css(g);k||b.css(h);!0===c.animate?a.stop(!0,!0).animate({left:d,top:f},500):a.stop(!0,!0).css({left:d,top:f});c.completeHandler&&c.completeHandler(e)})}}var h=function(a){a=g(a,{});this.settings=j.extend({},this.defaultSettings,
a);this.shadow=this.container=!1;this.properties={animating:!1,isopen:!1,resizepause:!1,loaded_content:-1}};h.prototype.adjust=function(a){var a=g(a,!1),b=this;if(!b.properties.resizepause&&(!a||b.properties.isopen))if(b.properties.resizepause=!0,setTimeout(function(){t(b,a);b.properties.resizepause=!1},b.properties.updatePositionDelay),b.properties.loaded_content!==b.settings.content){if(!r(b)){var e=b;if((e=g(e,!1))&&e.popup){var c=e.popup.find("img");if(0<c.length){var h=0;c.each(function(a,b){b.complete?
h++:j(b).load(function(){r(e,!0)})});c.length==h&&r(e,!0)}}}b.properties.loaded_content=b.settings.content}};h.prototype.checkImages=function(){this.properties.loaded_content=-1};h.prototype.close=function(){var a=this;if(!a.properties.animating&&a.properties.isopen&&("function"===typeof a.settings.beforeClose&&a.settings.beforeClose(a),a.properties.animating=!0,a.container.fadeOut(a.settings.fadeOutSpeed,function(){s(a,"close");j("body").css({overflow:"","margin-right":""})}),j(window).off("resize.popbox.adjust"),
a.properties.isopen=!1,a.checkImages(),"function"===typeof a.settings.onClose))a.settings.onClose(a)};h.prototype.open=function(){var a=this;if(!a.properties.animating&&!a.properties.isopen){"function"===typeof a.settings.beforeOpen&&a.settings.beforeOpen(a);a.properties.animating=!0;var b=m(this.settings.close,!0)?a.settings.close:this.defaultSettings.close,e=m(this.settings.content,!0)?a.settings.content:"",c=j("body"),g=c.width();c.css("overflow","hidden");var h=c.width();h>g&&(g=parseInt(c.css("margin-right"))+
(h-g),c.css("margin-right",g+"px"));c.append('<div class="popbox-container" style="display: none;"><div class="popbox-bottom-push"></div><a class="popbox-shadow" href="javascript:void(0);"></a><div class="popbox-popup"><a class="popbox-close">'+b+'</a><div class="popbox-content">'+e+"</div></div></div>");a.container=j(".popbox-container");a.popup=a.container.find(".popbox-popup");a.shadow=a.container.find(".popbox-shadow");a.bottom_push=a.container.find(".popbox-bottom-push");a.close_button=a.container.find(".popbox-close");
a.content_area=a.container.find(".popbox-content");a.container.css({display:"none",height:"100%",width:"100%",position:"fixed",left:"0px",top:"0px","z-index":"990","background-color":"rgba(0,0,0,0.4)"});a.bottom_push.css({display:"block",position:"absolute",left:"0px",top:"0px",height:"0px",width:"1px","z-index":"992"});a.popup.css({display:"block",visibility:"visible",position:"absolute",top:"0px",left:"0px","z-index":"993"});a.shadow.css({display:"block",position:"absolute",left:"0px",top:"0px",
width:"100%",height:"100%","z-index":"991",background:"#fff",opacity:"0",filter:"alpha(opacity=0)",cursor:"default"});a.adjust();a.container.fadeIn(a.settings.fadeInSpeed,function(){s(a,"open")});a.shadow.click(function(b){a.close();b.preventDefault()});a.close_button.click(function(b){a.close();b.preventDefault()});j(window).on("resize.popbox.adjust",function(){a.adjust(!0)});a.properties.isopen=!0;if("function"===typeof a.settings.onOpen)a.settings.onOpen(a)}};h.prototype.update=function(a,b){var e=
!1,a=g(a,{}),b=g(b,!0);!1!==g(a.content,!1)&&a.content!=this.settings.content&&(e=!0);this.settings=j.extend({},this.settings,a);if(this.properties.isopen){if(e){var e=m(this.settings.close,!0)?this.settings.close:this.defaultSettings.close,c=m(this.settings.content,!0)?this.settings.content:"";this.close_button.html(e);this.content_area.html(c)}b&&this.adjust(!0)}};h.prototype.isOpen=function(){return!0==this.properties.isopen};h.prototype.isClose=function(){return!1==this.properties.isopen};h.prototype.defaultSettings=
{width:"auto",height:"auto",maxwidth:"none",maxheight:"none",content:"",close:"X",onOpen:!1,onClose:!1,beforeOpen:!1,beforeClose:!1,fadeInSpeed:400,fadeOutSpeed:400,updatePositionDelay:200,autoScale:!1};window.PopBox=h})(jQuery);
