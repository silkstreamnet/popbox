!function(e){function t(e,t){return"undefined"!=typeof e?e:t}function o(e,o){return o=t(o,!1),!isNaN(e-0)&&null!=e&&""!=e&&(!o||e>0)}function i(e,o){return o=t(o,!1),"string"==typeof e&&null!=e&&(!o||""!=e)}function n(e,t){var o=e.attr(t);return("undefined"==typeof o||o===!1||""===o)&&(o=""),o}function s(e,t,o){if(o=o||!1,t instanceof Array)for(var i=0;i<t.length;i++)if(o){if(t[i]===e)return i}else if(t[i]==e)return i;return-1}function r(e,t){var o=n(e,"style");if(t&&o){var i=new RegExp("(^|;)\\s*"+RegExp.escape(t)+"\\s*:");if(o.match(i))return e.css(t)}return""}function p(e,t){if(e._properties.animating)switch(e._properties.animating=!1,t){case"close":e.container.remove(),e.container=!1,e._properties.isopen=!1,e.popup=!1,e.shadow=!1,e.$html.css({overflow:e._properties.stored_styles.htmlOverflow,height:e._properties.stored_styles.htmlHeight,"margin-right":e._properties.stored_styles.htmlMarginRight});break;case"open":e._properties.isopen=!0}}function a(e){e.popup.find("img").css({"max-width":"100%",height:"auto"}).filter(":visible").css({display:"block"}),e.popup.find("iframe").css({"max-height":"100%","max-width":"100%"})}function l(e){e=t(e,!1),e&&e.popup&&e.update({content:'<img src="'+e._properties.gallery.images[e._properties.gallery.position]+'" style="display:none;" />'})}function g(e){e=t(e,!1),e&&e.popup&&(e.gallery_next&&e.gallery_next.remove(),e.gallery_prev&&e.gallery_prev.remove(),e.gallery_next=!1,e.gallery_prev=!1)}function d(e){if(e=t(e,!1),e&&e.popup&&e._properties.gallery.images.length>1){e.popup.append('<a href="#" class="popbox-gallery-next">&nbsp;'+e._settings.gallery.next+"</a>"),e.gallery_next=e.popup.find(".popbox-gallery-next"),e.popup.append('<a href="#" class="popbox-gallery-prev">'+e._settings.gallery.prev+"&nbsp;</a>"),e.gallery_prev=e.popup.find(".popbox-gallery-prev");var o=!1,i=!1;e.gallery_next.click(function(t){t.preventDefault(),e._properties.gallery.position++,e._properties.gallery.position>=e._properties.gallery.images.length&&(e._properties.gallery.position=0),l(e)}).mousemove(function(t){o||(e.gallery_next.addClass("popbox-btn-hover"),o=!0,setTimeout(function(){o=!1},200))}).mouseleave(function(t){e.gallery_next.removeClass("popbox-btn-hover")}),e.gallery_prev.click(function(t){t.preventDefault(),e._properties.gallery.position--,e._properties.gallery.position<0&&(e._properties.gallery.position=e._properties.gallery.images.length-1),l(e)}).mousemove(function(t){i||(e.gallery_prev.addClass("popbox-btn-hover"),i=!0,setTimeout(function(){i=!1},200))}).mouseleave(function(t){e.gallery_prev.removeClass("popbox-btn-hover")})}}function c(e){var t="popbox-rsc-clone",o=e.container.clone().stop(!0,!0).addClass(t).css({display:"block",visibility:"hidden","z-index":"-1",overflow:"hidden"});o.find("iframe").attr("src",""),o.appendTo(e.$body);var i=e.$body.find("."+t);return{container:i,popup:i.find(".popbox-popup").eq(0),content:i.find(".popbox-content").eq(0),gallery_loading_area:i.find(".popbox-gallery-loading").eq(0)}}function h(e){e&&e.container&&e.container.remove()}function u(e){e=t(e,!1),e&&e.popup&&("gallery"==e._settings.mode&&"ready"==e._properties.gallery.status&&e.content_area.find("img:hidden").fadeIn(300),e.popup.find(".popbox-btn-hover").removeClass("popbox-btn-hover"))}function _(e){if(e=t(e,!1),e&&e.popup){var i=e._settings,n=e.popup,s=e.container,r=e.content_area,p=e.shadow,l=e.gallery_loading_area;n.stop(!0,!1),s.css("overflow-y","hidden"),a(e);var g=0,d=0,_=0,f=0,y=0,m=0,v=0,x=0,w=p.width(),b=s.outerHeight(!1),S=0,C=0,$=0,z=!1,k=!1;if(i.autoScale&&"ready"==e._properties.gallery.status)if(r.css({height:"100%",width:"100%",overflow:"hidden"}),k=c(e),k.popup.css({height:"auto",width:"auto",top:"auto",left:"auto"}),k.content.attr("style",""),k.content.find("img").css({"max-width":"none",height:"auto",display:"block"}),k.content.find("iframe").css({"max-height":"none","max-width":"none"}),y=k.popup.width(),m=k.popup.height(),v=k.popup.outerWidth(!1)-y,x=k.popup.outerHeight(!1)-m,h(k),S=.8*w-v,C=.8*b-x,S>i.maxwidth&&(S=i.maxwidth),C>i.maxheight&&(C=i.maxheight),m>C||y>S){var O=C/S,j=m/y,T=1;j>O?(T=C/m,d=C,g=y*T):(T=S/y,g=S,d=m*T)}else g=y,d=m;else{S=.8*w,C=.8*b,v=n.outerWidth(!1)-n.width(),x=n.outerHeight(!1)-n.height(),g=S-v,d=C-x,k=c(e),k.popup.css({height:"auto",width:"auto",top:"0",left:"0"}),k.content.attr("style",""),k.gallery_loading_area.attr("style","");var I=r,N=k.content;"ready"==e._properties.gallery.status?(k.content.css("display","block"),k.gallery_loading_area.css("display","none")):(k.content.css("display","none"),k.gallery_loading_area.css("display","block"),I=l,N=k.gallery_loading_area),o(i.width)?g=i.width:(i.scaleToContent||"ready"!=e._properties.gallery.status)&&k.popup.width()<g&&(g=k.popup.width()),o(i.maxwidth)&&g>i.maxwidth&&(g=i.maxwidth),k.popup.css({width:g}),o(i.height)?d=i.height:i.innerOverflow||(d=k.popup.height()),o(i.maxheight)&&d>i.maxheight&&(d=i.maxheight),0==parseInt(N.css("margin-top"))&&N.css({"margin-top":"-1px",top:"1px"});var R=N.outerHeight(!0),D=R-N.height(),H=parseInt(k.popup.css("padding-top")),E=parseInt(k.popup.css("border-top-width")),q=parseInt(k.popup.css("margin-top"));isNaN(H)&&(H=0),isNaN(E)&&(E=0),isNaN(q)&&(q=0);var M=H+E+q,P=d-(N.position().top-M);!e._properties.newopen&&i.animateSpeed>0?I.stop(!0,!1).height(I.height()).animate({height:P-D},i.animateSpeed):I.stop(!0,!1).css({height:P-D}),R>P&&i.innerOverflow&&I.css("overflow-y","scroll"),h(k),$=.05*b,C=.9*b,f=d+x,f>C?(z=$,s.css("overflow-y","scroll"),e.bottom_push.css({top:$+f+"px",height:$+"px",width:"1px"}),e.shadow.css({height:2*$+f+"px"})):(e.bottom_push.css({top:"0px",height:"0px",width:"0px"}),e.shadow.css({height:"100%"}))}_=g+v,f=d+x;var B=(w-_)/2,W=(b-f)/2;z!==!1&&(W=z),!e._properties.newopen&&i.animateSpeed>0?n.animate({left:B,top:W,width:g,height:d},i.animateSpeed,function(){u(e)}).css("overflow",""):(n.css({left:B,top:W,width:g,height:d}),u(e))}}function f(e){"gallery"==e._settings.mode&&(e.content_area.show(),e.gallery_loading_area.hide(),e._properties.gallery.status="ready")}function y(e){if("gallery"==e._settings.mode){var t=i(e._settings.gallery.loading,!0)?e._settings.gallery.loading:e._defaultSettings.gallery.loading;e.content_area.hide(),e.gallery_loading_area.show(),e.gallery_loading_area.html(t),e._properties.gallery.status="loading"}}function m(e){if("gallery"==e._settings.mode){var t=i(e._settings.gallery.error,!0)?e._settings.gallery.error:e._defaultSettings.gallery.error;e.content_area.hide(),e.gallery_loading_area.show(),e.gallery_loading_area.html(t),e._properties.gallery.status="error",e.adjust(!0)}}function v(e){e=t(e,!1);var o=!0;if(e&&e.popup){var i=e._properties.loaded_images;if(i.length)for(var n=0;n<i.length;n++){var s=i[n];s.complete||4===s.readyState||"complete"===s.readyState||(o=!1)}}return o&&f(e),o}function x(o){if(o=t(o,!1),o&&o.popup){o._properties.loaded_images=[];var i=o.popup.find("img");if(!(i.length>0))return!0;y(o);var n=0;if(i.each(function(t,i){if(i.src){var s=new Image;i.complete||4===i.readyState||"complete"===i.readyState?n++:("undefined"!=typeof s.onload?s.onload=function(){setTimeout(function(){v(o)&&o.adjust(!0)},10)}:"undefined"!=typeof s.onreadystatechange&&(s.onreadystatechange=function(){setTimeout(function(){v(o)&&o.adjust(!0)},10)}),"undefined"!=typeof s.onerror&&(s.onerror=function(){e(i).remove(),m(o)})),s.src=i.src,o._properties.loaded_images.push(s)}}),i.length==n)return!0}return!1}function w(e){var t=!1;return e._properties.loaded_content!==e._settings.content&&(t=x(e),e._properties.loaded_content=e._settings.content),t}function b(t){if(S(t),"gallery"==t._settings.mode&&(t._settings.autoScale=!0),t.content_area.find("img").hide(),t._settings.gallery.name){var o=e("."+t._settings.gallery.name);if(o.length&&(o.each(function(){var o=e(this);if(0==o.closest(".popbox-container").length){var i=n(o,"src"),r=n(o,"href"),p=i?i:r;p&&-1==s(p,t._properties.gallery.images)&&t._properties.gallery.images.push(p)}}),t._properties.gallery.images.length>0)){var i="",r=t.content_area.find("img:first");r.length&&(i=n(r.eq(0),"src"));var p=s(i,t._properties.gallery.images);t._properties.gallery.position=0,""==i||-1==p?t._properties.gallery.images.unshift(i):p>-1&&(t._properties.gallery.position=p),d(t)}}}function S(e){e.content_area.show(),e.gallery_loading_area.hide(),e._properties.gallery.status="ready",e._properties.gallery.images=[],e._properties.gallery.position=0,g(e)}null!=RegExp&&null==RegExp.escape&&(RegExp.escape=function(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")});var C=function(o){o=t(o,{}),this.$window=e(window),this.$html=e("html"),this.$body=e("body"),this._settings=e.extend(!0,{},this._defaultSettings,o),this.container=!1,this.popup=!1,this.shadow=!1,this._properties={animating:!1,isopen:!1,newopen:!0,newopentime:0,resizepause:!1,loaded_content:-1,loaded_images:[],stored_styles:{htmlOverflow:"",htmlHeight:"",htmlMarginRight:""},gallery:{status:"ready",images:[],position:0}}};C.prototype.adjust=function(e){e=t(e,!1);var o=this;if(o._properties.isopen&&(e||!o._properties.resizepause))if(w(o)&&f(o),o._properties.newopen)_(o),o._properties.newopen=!1;else{var i=1,n="normal";"gallery"==o._settings.mode&&"loading"==o._properties.gallery.status?(i=100,n="loading"):e||(i=o._settings.updatePositionDelay),o._properties.resizepause=!0,o._properties.resizetimer=setTimeout(function(){("normal"==n||"loading"==n&&"error"!=o._properties.gallery.status)&&(_(o),o._properties.resizepause=!1,o._properties.resizetimer=!1)},i)}},C.prototype.refresh=function(){this._properties.loaded_content=-1,this._properties.loaded_images=[]},C.prototype.close=function(){var e=this;!e._properties.animating&&e._properties.isopen&&("function"==typeof e._settings.onClose&&e._settings.onClose(e),e._properties.animating=!0,e.container.fadeOut(e._settings.fadeOutSpeed,function(){p(e,"close")}),e.$window.off("resize.popbox.adjust"),e._properties.isopen=!1,e.refresh(),"gallery"==e._settings.mode&&e.update({content:""},!1),"function"==typeof e._settings.afterClose&&e._settings.afterClose(e))},C.prototype.open=function(){var t=this;if(t.refresh(),!t._properties.animating&&!t._properties.isopen){"function"==typeof t._settings.onOpen&&t._settings.onOpen(t),t._properties.animating=!0;var o=i(this._settings.close,!0)?t._settings.close:t._defaultSettings.close,n=i(this._settings.content,!0)?t._settings.content:"",s=i(this._settings.title,!0)?'<div class="popbox-title">'+t._settings.title+"</div>":"",a=i(this._settings.customClass,!0)?" "+t._settings.customClass:"",l=i(this._settings.gallery.loading,!0)?t._settings.gallery.loading:t._defaultSettings.gallery.loading;t._properties.stored_styles.htmlOverflow=r(t.$html,"overflow"),t._properties.stored_styles.htmlHeight=r(t.$html,"height"),t._properties.stored_styles.htmlMarginRight=r(t.$html,"margin-right");var g=t.$body.width();t.$html.css({overflow:"hidden",height:"100%"});var d=t.$body.width();d>g&&t.$html.css({"margin-right":d-g+"px"}),t.$body.append('<div class="popbox-container'+a+'" style="display: none;"><div class="popbox-bottom-push"></div><a class="popbox-shadow" href="javascript:void(0);"></a><div class="popbox-popup">'+s+'<div class="popbox-content">'+n+'</div><div class="popbox-gallery-loading">'+l+'</div><a href="#" class="popbox-close">'+o+"</a></div></div>"),t.container=e(".popbox-container"),t.popup=t.container.find(".popbox-popup"),t.shadow=t.container.find(".popbox-shadow"),t.bottom_push=t.container.find(".popbox-bottom-push"),t.close_button=t.container.find(".popbox-close"),t.title_area=t.container.find(".popbox-title"),t.content_area=t.container.find(".popbox-content"),t.gallery_loading_area=t.container.find(".popbox-gallery-loading"),t.container.css({display:"none",height:"100%",width:"100%",position:"fixed",left:"0px",top:"0px","z-index":"990","background-color":"rgba(0,0,0,0.4)","overflow-x":"hidden"}),t.bottom_push.css({display:"block",position:"absolute",left:"0px",top:"0px",height:"0px",width:"1px","z-index":"992"}),t.popup.css({display:"block",position:"absolute",top:"0px",left:"0px","z-index":"993","-webkit-box-sizing":"content-box","-moz-box-sizing":"content-box","box-sizing":"content-box"}),t.shadow.css({display:"block",position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%","z-index":"991",background:"#fff",opacity:"0",cursor:"default"}),t.content_area.css({overflow:"hidden",height:"auto"}),t.gallery_loading_area.css({overflow:"hidden",height:"auto"}),"gallery"==t._settings.mode&&b(t),t.container.fadeIn(t._settings.fadeInSpeed,function(){p(t,"open")}),t.shadow.click(function(e){t.close(),e.preventDefault()}),t.close_button.click(function(e){t.close(),e.preventDefault()}),t.$window.on("resize.popbox.adjust",function(){t.adjust()}),t._properties.isopen=!0,t._properties.newopen=!0,t._properties.newopentime=(new Date).getTime(),t.adjust(),"function"==typeof t._settings.afterOpen&&t._settings.afterOpen(t)}},C.prototype.update=function(o,n){var s=this;if(o=t(o,{}),n=t(n,!0),s._settings=e.extend(!0,{},s._settings,o),s._properties.isopen){var r=i(s._settings.close,!0)?s._settings.close:s._defaultSettings.close,p=i(s._settings.content,!0)?s._settings.content:"",l=i(s._settings.title,!0)?s._settings.title:"";s.close_button.length>0&&s.close_button.html(r),s.content_area.length>0&&s.content_area.html(p),s.title_area.length>0?""!=l?s.title_area.html(l):(s.title_area.remove(),s.title_area=s.popup.find(".popbox-title")):""!=l&&(s.popup.prepend('<div class="popbox-title">'+l+"</div>"),s.title_area=s.popup.find(".popbox-title")),"gallery"==s._settings.mode?b(s):S(s),n?s.adjust(!0):a(s)}},C.prototype.isOpen=function(){return 1==this._properties.isopen},C.prototype.isClose=function(){return 0==this._properties.isopen},C.prototype._defaultSettings={width:"auto",height:"auto",maxwidth:"none",maxheight:"none",innerOverflow:!1,scaleToContent:!1,content:"",close:"X",title:"",onOpen:!1,onClose:!1,afterOpen:!1,afterClose:!1,fadeInSpeed:400,fadeOutSpeed:400,updatePositionDelay:200,autoScale:!1,customClass:"",animateSpeed:400,mode:"normal",gallery:{loading:'<div style="padding:10px;">Loading...</div>',error:'<div style="padding:10px;">There was an error loading the image.</div>',name:"",next:"<span>&#x25B6;</span>",prev:"<span>&#x25C0;</span>"}},window.PopBox=C}(jQuery);