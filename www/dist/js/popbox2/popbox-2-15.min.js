!function(e){function t(e,t){return"undefined"!=typeof e?e:t}function o(e,o){return o=t(o,!1),!isNaN(e-0)&&null!=e&&""!=e&&(!o||e>0)}function i(e,o){return o=t(o,!1),"string"==typeof e&&null!=e&&(!o||""!=e)}function n(e,t){var o=e.attr(t);return("undefined"==typeof o||o===!1||""===o)&&(o=""),o}function s(e,t,o){if(o=o||!1,t instanceof Array)for(var i=0;i<t.length;i++)if(o){if(t[i]===e)return i}else if(t[i]==e)return i;return-1}function r(e,t){var o=n(e,"style");if(t&&o){var i=new RegExp("(^|;)\\s*"+RegExp.escape(t)+"\\s*:");if(o.match(i))return e.css(t)}return""}function a(e,t){if(e._properties.animating)switch(e._properties.animating=!1,t){case"close":e.container.remove(),e.container=!1,e._properties.isopen=!1,e.popup=!1,e.shadow=!1,e.$html.css({overflow:e._properties.stored_styles.htmlOverflow,height:e._properties.stored_styles.htmlHeight,"margin-right":e._properties.stored_styles.htmlMarginRight});break;case"open":e._properties.isopen=!0}}function p(e){e.popup.find("img").css({"max-width":"100%",height:"auto"}).filter(":visible").css({display:"block"}),e.popup.find("iframe").css({"max-height":"100%","max-width":"100%"})}function l(e){e=t(e,!1),e&&e.popup&&e.update({content:'<img src="'+e._properties.gallery.images[e._properties.gallery.position]+'" style="display:none;" />'})}function g(e){e=t(e,!1),e&&e.popup&&(e.gallery_next&&e.gallery_next.remove(),e.gallery_prev&&e.gallery_prev.remove(),e.gallery_next=!1,e.gallery_prev=!1)}function d(e){if(e=t(e,!1),e&&e.popup&&e._properties.gallery.images.length>1){e.popup.append('<a href="#" class="popbox-gallery-next">&nbsp;'+e._settings.gallery.next+"</a>"),e.gallery_next=e.popup.find(".popbox-gallery-next"),e.popup.append('<a href="#" class="popbox-gallery-prev">'+e._settings.gallery.prev+"&nbsp;</a>"),e.gallery_prev=e.popup.find(".popbox-gallery-prev");var o=!1,i=!1;e.gallery_next.click(function(t){t.preventDefault(),e._properties.gallery.position++,e._properties.gallery.position>=e._properties.gallery.images.length&&(e._properties.gallery.position=0),l(e)}).mousemove(function(t){o||(e.gallery_next.addClass("popbox-btn-hover"),o=!0,setTimeout(function(){o=!1},200))}).mouseleave(function(t){e.gallery_next.removeClass("popbox-btn-hover")}),e.gallery_prev.click(function(t){t.preventDefault(),e._properties.gallery.position--,e._properties.gallery.position<0&&(e._properties.gallery.position=e._properties.gallery.images.length-1),l(e)}).mousemove(function(t){i||(e.gallery_prev.addClass("popbox-btn-hover"),i=!0,setTimeout(function(){i=!1},200))}).mouseleave(function(t){e.gallery_prev.removeClass("popbox-btn-hover")})}}function c(t){var o=!1;return t.content.find("img").each(function(){var t=e(this);0!=t.width()&&0!=t.height()||this.complete!==!1||(o=!0)}),o}function h(e){var t="popbox-rsc-clone-"+(new Date).getTime(),o=e.container.clone().stop(!0,!0).addClass(t).css({display:"block",visibility:"hidden","z-index":"-1",overflow:"hidden"});o.find("iframe").attr("src",""),o.appendTo(e.$body);var i=e.$body.find("."+t);return{container:i,popup:i.find(".popbox-popup").eq(0),content:i.find(".popbox-content").eq(0),gallery_loading_area:i.find(".popbox-gallery-loading").eq(0)}}function u(e){e&&e.container&&e.container.remove()}function _(e){e=t(e,!1),e&&e.popup&&("gallery"==e._settings.mode&&"ready"==e._properties.gallery.status&&e.content_area.find("img:hidden").fadeIn(300),e.popup.find(".popbox-btn-hover").removeClass("popbox-btn-hover"))}function f(e){e=t(e,!1);var i=!0;if(e&&e.popup){var n=e._settings,s=e.popup,r=e.container,a=e.content_area,l=e.shadow,g=e.gallery_loading_area;s.stop(!0,!1),r.css("overflow-y","hidden"),p(e);var d=0,f=0,y=0,m=0,v=0,x=0,w=0,b=0,S=l.width(),C=r.outerHeight(!1),$=0,z=0,k=0,O=!1,T=!1;if(!n.autoScale||"gallery"==e._settings.mode&&"ready"!=e._properties.gallery.status){$=.8*S,z=.8*C,w=s.outerWidth(!1)-s.width(),b=s.outerHeight(!1)-s.height(),d=$-w,f=z-b,T=h(e),T.popup.css({height:"auto",width:"auto",top:"0",left:"0"}),T.content.attr("style",""),T.gallery_loading_area.attr("style","");var j=a,I=T.content;"gallery"!=e._settings.mode||"ready"==e._properties.gallery.status?(T.content.css("display","block"),T.gallery_loading_area.css("display","none")):(T.content.css("display","none"),T.gallery_loading_area.css("display","block"),j=g,I=T.gallery_loading_area),o(n.width)?d=n.width:(n.scaleToContent||"ready"!=e._properties.gallery.status)&&T.popup.width()<d&&(d=T.popup.width()),o(n.maxwidth)&&d>n.maxwidth&&(d=n.maxwidth),T.popup.css({width:d}),o(n.height)?f=n.height:n.innerOverflow||(f=T.popup.height()),o(n.maxheight)&&f>n.maxheight&&(f=n.maxheight),0==parseInt(I.css("margin-top"))&&I.css({"margin-top":"-1px",top:"1px"}),c(T)&&(i=!1);var D=I.outerHeight(!0),N=D-I.height(),R=parseInt(T.popup.css("padding-top")),H=parseInt(T.popup.css("border-top-width")),E=parseInt(T.popup.css("margin-top"));isNaN(R)&&(R=0),isNaN(H)&&(H=0),isNaN(E)&&(E=0);var q=R+H+E,M=f-(I.position().top-q);!e._properties.newopen&&n.animateSpeed>0?j.stop(!0,!1).height(j.height()).animate({height:M-N},n.animateSpeed):j.stop(!0,!1).css({height:M-N}),D>M&&n.innerOverflow&&j.css("overflow-y","scroll"),u(T),k=.05*C,z=.9*C,m=f+b,m>z?(O=k,r.css("overflow-y","scroll"),e.bottom_push.css({top:k+m+"px",height:k+"px",width:"1px"}),e.shadow.css({height:2*k+m+"px"})):(e.bottom_push.css({top:"0px",height:"0px",width:"0px"}),e.shadow.css({height:"100%"}))}else{if(a.css({height:"100%",width:"100%",overflow:"hidden"}),T=h(e),T.popup.css({height:"auto",width:"auto",top:"auto",left:"auto"}),T.content.attr("style",""),T.content.find("img").css({"max-width":"none",height:"auto",display:"block"}),T.content.find("iframe").css({"max-height":"none","max-width":"none"}),c(T))return!1;if(v=T.popup.width(),x=T.popup.height(),w=T.popup.outerWidth(!1)-v,b=T.popup.outerHeight(!1)-x,u(T),$=.8*S-w,z=.8*C-b,$>n.maxwidth&&($=n.maxwidth),z>n.maxheight&&(z=n.maxheight),x>z||v>$){var P=z/$,B=x/v,W=1;B>P?(W=z/x,f=z,d=v*W):(W=$/v,d=$,f=x*W)}else d=v,f=x}y=d+w,m=f+b;var A=(S-y)/2,L=(C-m)/2;O!==!1&&(L=O),!e._properties.newopen&&n.animateSpeed>0?s.animate({left:A,top:L,width:d,height:f},n.animateSpeed,function(){_(e)}).css("overflow",""):(s.css({left:A,top:L,width:d,height:f}),_(e))}return i}function y(e){e.content_area.show(),e.gallery_loading_area.hide(),e._properties.gallery.status="ready"}function m(e){if("gallery"==e._settings.mode){var t=i(e._settings.gallery.loading,!0)?e._settings.gallery.loading:e._defaultSettings.gallery.loading;e.content_area.hide(),e.gallery_loading_area.show(),e.gallery_loading_area.html(t),e._properties.gallery.status="loading"}}function v(e){if("gallery"==e._settings.mode){var t=i(e._settings.gallery.error,!0)?e._settings.gallery.error:e._defaultSettings.gallery.error;e.content_area.hide(),e.gallery_loading_area.show(),e.gallery_loading_area.html(t),e._properties.gallery.status="error",e.adjust(!0)}}function x(e){e=t(e,!1);var o=!0;if(e&&e.popup){var i=e._properties.loaded_images;if(i.length)for(var n=0;n<i.length;n++){var s=i[n];s.complete||4===s.readyState||"complete"===s.readyState||(o=!1)}}return o&&y(e),o}function w(o){if(o=t(o,!1),o&&o.popup){o._properties.loaded_images=[];var i=o.content_area.find("img");if(!(i.length>0))return!0;m(o);var n=0;if(i.each(function(t,i){if(i.src){var s=new Image;i.complete||4===i.readyState||"complete"===i.readyState?n++:("undefined"!=typeof s.onload?s.onload=function(){setTimeout(function(){x(o)&&o.adjust(!0)},10)}:"undefined"!=typeof s.onreadystatechange&&(s.onreadystatechange=function(){setTimeout(function(){x(o)&&o.adjust(!0)},10)}),"undefined"!=typeof s.onerror&&(s.onerror=function(){setTimeout(function(){e(i).remove(),v(o)},10)})),s.src=i.src,o._properties.loaded_images.push(s)}}),i.length==n)return!0}return!1}function b(e){var t=!1;return e._properties.loaded_content!==e._settings.content&&(t=w(e),e._properties.loaded_content=e._settings.content),t}function S(t){if(C(t),"gallery"==t._settings.mode&&(t._settings.autoScale=!0),t.content_area.find("img").hide(),t.shadow.css({height:"100%"}),t.container.scrollTop(0),t._settings.gallery.name){var o=e("."+t._settings.gallery.name);if(o.length&&(o.each(function(){var o=e(this);if(0==o.closest(".popbox-container").length){var i=n(o,"src"),r=n(o,"href"),a=i?i:r;a&&-1==s(a,t._properties.gallery.images)&&t._properties.gallery.images.push(a)}}),t._properties.gallery.images.length>0)){var i="",r=t.content_area.find("img:first");r.length&&(i=n(r.eq(0),"src"));var a=s(i,t._properties.gallery.images);t._properties.gallery.position=0,""==i||-1==a?t._properties.gallery.images.unshift(i):a>-1&&(t._properties.gallery.position=a),d(t)}}}function C(e){e.content_area.show(),e.gallery_loading_area.hide(),e._properties.gallery.status="ready",e._properties.gallery.images=[],e._properties.gallery.position=0,g(e)}null!=RegExp&&null==RegExp.escape&&(RegExp.escape=function(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")});var $=function(o){o=t(o,{}),this.$window=e(window),this.$html=e("html"),this.$body=e("body"),this._settings=e.extend(!0,{},this._defaultSettings,o),this.container=!1,this.popup=!1,this.shadow=!1,this._properties={animating:!1,isopen:!1,newopen:!0,newopentime:0,retrytime:0,resizepause:!1,loaded_content:-1,loaded_images:[],stored_styles:{htmlOverflow:"",htmlHeight:"",htmlMarginRight:""},gallery:{status:"ready",images:[],position:0}}};$.prototype.adjust=function(e){e=t(e,!1);var i=this;if(i._properties.isopen&&(e||!i._properties.resizepause))if(b(i)&&y(i),i._properties.newopen)f(i),i._properties.newopen=!1;else{var n=1,s="normal";"gallery"==i._settings.mode&&"loading"==i._properties.gallery.status?(n=100,s="loading"):o(e,!0)?n=e:e||(n=i._settings.updatePositionDelay),i._properties.resizepause=!0,i._properties.resizetimer=setTimeout(function(){if("normal"==s||"loading"==s&&"error"!=i._properties.gallery.status)if(f(i))i._properties.retrytime=0;else if(i._properties.retrytime>=3e3)i._properties.retrytime=0;else{var e=100;i.adjust(e),i._properties.retrytime+=e}i._properties.resizepause=!1,i._properties.resizetimer=!1},n)}},$.prototype.refresh=function(){this._properties.loaded_content=-1,this._properties.loaded_images=[]},$.prototype.close=function(){var e=this;!e._properties.animating&&e._properties.isopen&&("function"==typeof e._settings.onClose&&e._settings.onClose(e),e._properties.animating=!0,e.container.fadeOut(e._settings.fadeOutSpeed,function(){a(e,"close")}),e.$window.off("resize.popbox.adjust"),e._properties.isopen=!1,e.refresh(),"gallery"==e._settings.mode&&e.update({content:""},!1),"function"==typeof e._settings.afterClose&&e._settings.afterClose(e))},$.prototype.open=function(){var t=this;if(t.refresh(),!t._properties.animating&&!t._properties.isopen){"function"==typeof t._settings.onOpen&&t._settings.onOpen(t),t._properties.animating=!0;var o=i(this._settings.close,!0)?t._settings.close:t._defaultSettings.close,n=i(this._settings.content,!0)?t._settings.content:"",s=i(this._settings.title,!0)?'<div class="popbox-title">'+t._settings.title+"</div>":"",p=i(this._settings.customClass,!0)?" "+t._settings.customClass:"",l=i(this._settings.gallery.loading,!0)?t._settings.gallery.loading:t._defaultSettings.gallery.loading;t._properties.stored_styles.htmlOverflow=r(t.$html,"overflow"),t._properties.stored_styles.htmlHeight=r(t.$html,"height"),t._properties.stored_styles.htmlMarginRight=r(t.$html,"margin-right");var g=t.$body.width();t.$html.css({overflow:"hidden",height:"100%"});var d=t.$body.width();d>g&&t.$html.css({"margin-right":d-g+"px"}),t.$body.append('<div class="popbox-container'+p+'" style="display: none;"><div class="popbox-bottom-push"></div><a class="popbox-shadow" href="javascript:void(0);"></a><div class="popbox-popup">'+s+'<div class="popbox-content">'+n+'</div><div class="popbox-gallery-loading">'+l+'</div><a href="#" class="popbox-close">'+o+"</a></div></div>"),t.container=e(".popbox-container"),t.popup=t.container.find(".popbox-popup"),t.shadow=t.container.find(".popbox-shadow"),t.bottom_push=t.container.find(".popbox-bottom-push"),t.close_button=t.container.find(".popbox-close"),t.title_area=t.container.find(".popbox-title"),t.content_area=t.container.find(".popbox-content"),t.gallery_loading_area=t.container.find(".popbox-gallery-loading"),t.container.css({display:"none",height:"100%",width:"100%",position:"fixed",left:"0px",top:"0px","z-index":"990","background-color":"rgba(0,0,0,0.4)","overflow-x":"hidden"}),t.bottom_push.css({display:"block",position:"absolute",left:"0px",top:"0px",height:"0px",width:"1px","z-index":"992"}),t.popup.css({display:"block",position:"absolute",top:"0px",left:"0px","z-index":"993","-webkit-box-sizing":"content-box","-moz-box-sizing":"content-box","box-sizing":"content-box"}),t.shadow.css({display:"block",position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%","z-index":"991",background:"#fff",opacity:"0",cursor:"default"}),t.content_area.css({overflow:"hidden",height:"auto"}),t.gallery_loading_area.css({overflow:"hidden",height:"auto"}),"gallery"==t._settings.mode&&S(t),t.container.fadeIn(t._settings.fadeInSpeed,function(){a(t,"open")}),t.shadow.click(function(e){t.close(),e.preventDefault()}),t.close_button.click(function(e){t.close(),e.preventDefault()}),t.$window.on("resize.popbox.adjust",function(){t.adjust()}),t._properties.isopen=!0,t._properties.newopen=!0,t._properties.newopentime=(new Date).getTime(),t.adjust(),"function"==typeof t._settings.afterOpen&&t._settings.afterOpen(t)}},$.prototype.update=function(o,n){var s=this;if(o=t(o,{}),n=t(n,!0),s._settings=e.extend(!0,{},s._settings,o),s._properties.isopen){var r=i(s._settings.close,!0)?s._settings.close:s._defaultSettings.close,a=i(s._settings.content,!0)?s._settings.content:"",l=i(s._settings.title,!0)?s._settings.title:"";s.close_button.length>0&&s.close_button.html(r),s.content_area.length>0&&s.content_area.html(a),s.title_area.length>0?""!=l?s.title_area.html(l):(s.title_area.remove(),s.title_area=s.popup.find(".popbox-title")):""!=l&&(s.popup.prepend('<div class="popbox-title">'+l+"</div>"),s.title_area=s.popup.find(".popbox-title")),"gallery"==s._settings.mode?S(s):C(s),n?s.adjust(!0):p(s)}},$.prototype.isOpen=function(){return 1==this._properties.isopen},$.prototype.isClose=function(){return 0==this._properties.isopen},$.prototype._defaultSettings={width:"auto",height:"auto",maxwidth:"none",maxheight:"none",innerOverflow:!1,scaleToContent:!1,content:"",close:"X",title:"",onOpen:!1,onClose:!1,afterOpen:!1,afterClose:!1,fadeInSpeed:400,fadeOutSpeed:400,updatePositionDelay:200,autoScale:!1,customClass:"",animateSpeed:400,mode:"normal",gallery:{loading:'<div style="padding:10px;">Loading...</div>',error:'<div style="padding:10px;">There was an error loading the image.</div>',name:"",next:"<span>&#x25B6;</span>",prev:"<span>&#x25C0;</span>"}},window.PopBox=$}(jQuery);