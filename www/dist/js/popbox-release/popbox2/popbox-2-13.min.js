!function(e){function t(e,t){return"undefined"!=typeof e?e:t}function o(e,o){return o=t(o,!1),!isNaN(e-0)&&null!=e&&""!=e&&(!o||e>0)}function i(e,o){return o=t(o,!1),"string"==typeof e&&null!=e&&(!o||""!=e)}function n(e,t){var o=e.attr(t);return("undefined"==typeof o||o===!1||""===o)&&(o=""),o}function s(e,t,o){if(o=o||!1,t instanceof Array)for(var i=0;i<t.length;i++)if(o){if(t[i]===e)return i}else if(t[i]==e)return i;return-1}function p(e,t){var o=n(e,"style");if(t&&o){var i=new RegExp("(^|;)\\s*"+RegExp.escape(t)+"\\s*:");if(o.match(i))return e.css(t)}return""}function a(t,o){if(t.properties.animating)switch(t.properties.animating=!1,o){case"close":t.container.remove(),t.container=!1,t.properties.isopen=!1,t.popup=!1,t.shadow=!1,e("html").css({overflow:t.properties.stored_styles.htmlOverflow,height:t.properties.stored_styles.htmlHeight,"margin-right":t.properties.stored_styles.htmlMarginRight});break;case"open":t.properties.isopen=!0}}function r(e){e=t(e,!1);var o=!0;if(e&&e.popup){var i=e.properties.loaded_images;if(i.length)for(var n=0;n<i.length;n++){var s=i[n];s.complete||4===s.readyState||"complete"===s.readyState||(o=!1)}else i=e.popup.find("img"),i.length>0&&i.each(function(e,t){t.complete||4===t.readyState||"complete"===t.readyState||(o=!1)})}return o&&g(e),o}function l(o){if(o=t(o,!1),o&&o.popup){o.properties.loaded_images=[];var n=o.popup.find("img");if(n.length>0){"gallery"==o.settings.mode&&(o.content_area.hide(),o.gallery_loading_area&&o.gallery_loading_area.show(),o.properties.gallery.isloading=!0);var s=0;n.each(function(t,n){if(n.complete||4===n.readyState||"complete"===n.readyState)s++;else if(n.src){var p=new Image;"undefined"!=typeof p.onload?p.onload=function(){r(o)||setTimeout(function(){r(o)},10)}:"undefined"!=typeof p.onreadystatechange&&(p.onreadystatechange=function(){r(o)||setTimeout(function(){r(o)},10)}),"gallery"==o.settings.mode&&o.gallery_loading_area&&"undefined"!=typeof p.onerror&&(p.onerror=function(){var t=i(o.settings.gallery.error,!0)?o.settings.gallery.error:o.defaultSettings.gallery.error;o.gallery_loading_area.html(t),o.properties.gallery.isloading=!0,e(n).remove(),x(o),o.properties.newopen=!1}),p.src=n.src,o.properties.loaded_images.push(p)}}),n.length==s&&g(o)}else g(o)}}function g(e){"gallery"==e.settings.mode&&(e.content_area.show(),e.gallery_loading_area&&e.gallery_loading_area.hide(),e.properties.gallery.isloading=!1),x(e),e.properties.newopen=!1}function d(e){e.properties.loaded_content!==e.settings.content&&(l(e),e.properties.loaded_content=e.settings.content)}function c(e){e.popup.find("img").css({"max-width":"100%",height:"auto"}).filter(":visible").css({display:"block"}),e.popup.find("iframe").css({"max-height":"100%","max-width":"100%"})}function h(e){e&&e.popup&&(e.properties.gallery.isloading=!0,e.update({content:'<img src="'+e.properties.gallery.images[e.properties.gallery.position]+'" style="display:none;" />'}))}function u(e){if(e&&e.popup){e.popup.append('<a href="#" class="popbox-gallery-next">&nbsp;'+e.settings.gallery.next+"</a>"),e.gallery_next=e.popup.find(".popbox-gallery-next"),e.popup.append('<a href="#" class="popbox-gallery-prev">'+e.settings.gallery.prev+"&nbsp;</a>"),e.gallery_prev=e.popup.find(".popbox-gallery-prev");var t=!1,o=!1;e.gallery_next.click(function(t){t.preventDefault(),e.properties.gallery.position++,e.properties.gallery.position>=e.properties.gallery.images.length&&(e.properties.gallery.position=0),h(e)}).mousemove(function(o){t||(e.gallery_next.addClass("popbox-btn-hover"),t=!0,setTimeout(function(){t=!1},200))}).mouseleave(function(t){e.gallery_next.removeClass("popbox-btn-hover")}),e.gallery_prev.click(function(t){t.preventDefault(),e.properties.gallery.position--,e.properties.gallery.position<0&&(e.properties.gallery.position=e.properties.gallery.images.length-1),h(e)}).mousemove(function(t){o||(e.gallery_prev.addClass("popbox-btn-hover"),o=!0,setTimeout(function(){o=!1},200))}).mouseleave(function(t){e.gallery_prev.removeClass("popbox-btn-hover")})}}function f(t){var o=e("body"),i="popbox-rsc-clone",n=t.container.clone().stop(!0,!0).addClass(i).css({display:"block",visibility:"hidden","z-index":"-1",overflow:"hidden"});n.find("iframe").attr("src",""),n.appendTo(o);var s=o.find("."+i);return{container:s,popup:s.find(".popbox-popup").eq(0),content:s.find(".popbox-content").eq(0),gallery_loading_area:s.find(".popbox-gallery-loading").eq(0)}}function y(e){e&&e.container&&e.container.remove()}function m(e){e&&e.popup&&("gallery"!=e.settings.mode||e.properties.gallery.isloading||e.content_area.find("img:hidden").fadeIn(300),e.popup.find(".popbox-btn-hover").removeClass("popbox-btn-hover"))}function x(e){if(e=t(e,!1),e&&e.popup){var i=e.settings,n=e.popup,s=e.container,p=e.content_area,a=e.shadow,r=e.gallery_loading_area;n.stop(!0,!1),s.css("overflow-y","hidden"),c(e);var l=0,g=0,d=0,h=0,u=0,x=0,v=0,b=0,w=a.width(),_=s.outerHeight(!1),S=0,C=0,k=0,O=!1,z=!1;if(i.autoScale&&!e.properties.gallery.isloading)if(p.css({height:"100%",width:"100%",overflow:"hidden"}),z=f(e),z.popup.css({height:"auto",width:"auto",top:"auto",left:"auto"}),z.content.attr("style",""),z.content.find("img").css({"max-width":"none",height:"auto",display:"block"}),z.content.find("iframe").css({"max-height":"none","max-width":"none"}),u=z.popup.width(),x=z.popup.height(),v=z.popup.outerWidth(!1)-u,b=z.popup.outerHeight(!1)-x,y(z),S=.8*w-v,C=.8*_-b,S>i.maxwidth&&(S=i.maxwidth),C>i.maxheight&&(C=i.maxheight),x>C||u>S){var T=C/S,I=x/u,j=1;I>T?(j=C/x,g=C,l=u*j):(j=S/u,l=S,g=x*j)}else l=u,g=x;else{S=.8*w,C=.8*_,v=n.outerWidth(!1)-n.width(),b=n.outerHeight(!1)-n.height(),l=S-v,g=C-b,z=f(e),z.popup.css({height:"auto",width:"auto",top:"0",left:"0"}),z.content.attr("style",""),z.gallery_loading_area.attr("style","");var N=p,R=z.content;e.properties.gallery.isloading?(z.content.css("display","none"),z.gallery_loading_area.css("display","block"),N=r,R=z.gallery_loading_area):(z.content.css("display","block"),z.gallery_loading_area.css("display","none")),o(i.width)?l=i.width:(i.scaleToContent||e.properties.gallery.isloading)&&z.popup.width()<l&&(l=z.popup.width()),o(i.maxwidth)&&l>i.maxwidth&&(l=i.maxwidth),z.popup.css({width:l}),o(i.height)?g=i.height:i.innerOverflow||(g=z.popup.height()),o(i.maxheight)&&g>i.maxheight&&(g=i.maxheight),0==parseInt(R.css("margin-top"))&&R.css({"margin-top":"-1px",top:"1px"});var D=R.outerHeight(!0),H=D-R.height(),E=parseInt(z.popup.css("padding-top")),q=parseInt(z.popup.css("border-top-width")),M=parseInt(z.popup.css("margin-top"));isNaN(E)&&(E=0),isNaN(q)&&(q=0),isNaN(M)&&(M=0);var P=E+q+M,B=g-(R.position().top-P);!e.properties.newopen&&i.animateSpeed>0?N.stop(!0,!1).height(N.height()).animate({height:B-H},i.animateSpeed):N.stop(!0,!1).css({height:B-H}),D>B&&i.innerOverflow&&N.css("overflow-y","scroll"),y(z),k=.05*_,C=.9*_,h=g+b,h>C?(O=k,s.css("overflow-y","scroll"),e.bottom_push.css({top:k+h+"px",height:k+"px",width:"1px"}),e.shadow.css({height:2*k+h+"px"})):(e.bottom_push.css({top:"0px",height:"0px",width:"0px"}),e.shadow.css({height:"100%"}))}d=l+v,h=g+b;var W=(w-d)/2,$=(_-h)/2;O!==!1&&($=O),!e.properties.newopen&&i.animateSpeed>0?n.animate({left:W,top:$,width:l,height:g},i.animateSpeed,function(){m(e)}).css("overflow",""):(n.css({left:W,top:$,width:l,height:g}),m(e))}}null!=RegExp&&null==RegExp.escape&&(RegExp.escape=function(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")});var v=function(o){o=t(o,{}),"gallery"==o.mode&&null==o.autoScale&&(o.autoScale=!0),this.settings=e.extend(!0,{},this.defaultSettings,o),this.container=!1,this.popup=!1,this.shadow=!1,this.properties={animating:!1,isopen:!1,newopen:!0,newopentime:0,resizepause:!1,loaded_content:-1,loaded_images:[],stored_styles:{htmlOverflow:"",htmlHeight:"",htmlMarginRight:""},gallery:{isloading:!1,images:[],position:0}}};v.prototype.adjust=function(e){e=t(e,!1);var o=this;if(o.properties.isopen&&(e||!o.properties.resizepause)){var i=1;o.properties.newopen||(o.properties.gallery.isloading?i=100:e||(i=o.settings.updatePositionDelay)),o.properties.resizepause=!0,setTimeout(function(){x(o),o.properties.resizepause=!1},i),d(o)}},v.prototype.refresh=function(){this.properties.loaded_content=-1,this.properties.loaded_images=[]},v.prototype.close=function(){var t=this;!t.properties.animating&&t.properties.isopen&&("function"==typeof t.settings.onClose&&t.settings.onClose(t),t.properties.animating=!0,t.container.fadeOut(t.settings.fadeOutSpeed,function(){a(t,"close")}),e(window).off("resize.popbox.adjust"),e(document).off("touchstart.popbox touchend.popbox"),t.properties.isopen=!1,t.refresh(),"gallery"==t.settings.mode&&t.update({content:""},!1),"function"==typeof t.settings.afterClose&&t.settings.afterClose(t))},v.prototype.open=function(){var t=this;if(t.refresh(),!t.properties.animating&&!t.properties.isopen){"function"==typeof t.settings.onOpen&&t.settings.onOpen(t),t.properties.animating=!0;var o=i(this.settings.close,!0)?t.settings.close:t.defaultSettings.close,r=i(this.settings.content,!0)?t.settings.content:"",l=i(this.settings.title,!0)?'<div class="popbox-title">'+t.settings.title+"</div>":"",g=i(this.settings.customClass,!0)?" "+t.settings.customClass:"",d=e("html"),c=e("body");t.properties.stored_styles.htmlOverflow=p(d,"overflow"),t.properties.stored_styles.htmlHeight=p(d,"height"),t.properties.stored_styles.htmlMarginRight=p(d,"margin-right");var h=c.width();d.css({overflow:"hidden",height:"100%"});var f=c.width();if(f>h&&d.css({"margin-right":f-h+"px"}),c.append('<div class="popbox-container'+g+'" style="display: none;"><div class="popbox-bottom-push"></div><a class="popbox-shadow" href="javascript:void(0);"></a><div class="popbox-popup">'+l+'<div class="popbox-content">'+r+'</div><a href="#" class="popbox-close">'+o+"</a></div></div>"),t.container=e(".popbox-container"),t.popup=t.container.find(".popbox-popup"),t.shadow=t.container.find(".popbox-shadow"),t.bottom_push=t.container.find(".popbox-bottom-push"),t.close_button=t.container.find(".popbox-close"),t.title_area=t.container.find(".popbox-title"),t.content_area=t.container.find(".popbox-content"),t.gallery_loading_area=!1,t.container.css({display:"none",height:"100%",width:"100%",position:"fixed",left:"0px",top:"0px","z-index":"990","background-color":"rgba(0,0,0,0.4)","overflow-x":"hidden"}),t.bottom_push.css({display:"block",position:"absolute",left:"0px",top:"0px",height:"0px",width:"1px","z-index":"992"}),t.popup.css({display:"block",position:"absolute",top:"0px",left:"0px","z-index":"993","-webkit-box-sizing":"content-box","-moz-box-sizing":"content-box","box-sizing":"content-box"}),t.shadow.css({display:"block",position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%","z-index":"991",background:"#fff",opacity:"0",cursor:"default"}),t.content_area.css({overflow:"hidden",height:"auto"}),"gallery"==t.settings.mode){t.content_area.hide();var y=i(this.settings.gallery.loading,!0)?t.settings.gallery.loading:t.defaultSettings.gallery.loading;if(t.content_area.after('<div class="popbox-gallery-loading">'+y+"</div>"),t.gallery_loading_area=t.container.find(".popbox-gallery-loading"),t.gallery_loading_area.css({overflow:"hidden",height:"auto"}),t.settings.gallery.name){var m=e("."+t.settings.gallery.name);if(m.length&&(m.each(function(){var o=e(this);if(0==o.closest(".popbox-container").length){var i=n(o,"src"),p=n(o,"href"),a=i?i:p;a&&-1==s(a,t.properties.gallery.images)&&t.properties.gallery.images.push(a)}}),t.properties.gallery.images.length>0)){var x="",v=t.content_area.find("img:first");v.length&&(x=n(v.eq(0),"src"));var b=s(x,t.properties.gallery.images);t.properties.gallery.position=0,""==x||-1==b?t.properties.gallery.images.unshift(x):b>-1&&(t.properties.gallery.position=b),u(t)}}}t.container.fadeIn(t.settings.fadeInSpeed,function(){a(t,"open")}),t.shadow.click(function(e){t.close(),e.preventDefault()}),t.close_button.click(function(e){t.close(),e.preventDefault()}),e(window).on("resize.popbox.adjust",function(){t.adjust()}),t.properties.isopen=!0,t.properties.newopen=!0,t.properties.newopentime=(new Date).getTime(),t.adjust(),"function"==typeof t.settings.afterOpen&&t.settings.afterOpen(t)}},v.prototype.update=function(o,n){var s=this;if(o=t(o,{}),n=t(n,!0),s.settings=e.extend({},s.settings,o),s.properties.isopen){var p=i(s.settings.close,!0)?s.settings.close:s.defaultSettings.close,a=i(s.settings.content,!0)?s.settings.content:"",r=i(s.settings.title,!0)?s.settings.title:"";s.close_button.length>0&&s.close_button.html(p),s.content_area.length>0&&s.content_area.html(a),s.title_area.length>0?""!=r?s.title_area.html(r):(s.title_area.remove(),s.title_area=s.popup.find(".popbox-title")):""!=r&&(s.popup.prepend('<div class="popbox-title">'+r+"</div>"),s.title_area=s.popup.find(".popbox-title")),n?s.adjust(!0):c(s)}},v.prototype.isOpen=function(){return 1==this.properties.isopen},v.prototype.isClose=function(){return 0==this.properties.isopen},v.prototype.defaultSettings={width:"auto",height:"auto",maxwidth:"none",maxheight:"none",innerOverflow:!1,scaleToContent:!1,content:"",close:"X",title:"",onOpen:!1,onClose:!1,afterOpen:!1,afterClose:!1,fadeInSpeed:400,fadeOutSpeed:400,updatePositionDelay:200,autoScale:!1,customClass:"",animateSpeed:400,mode:"normal",gallery:{loading:'<div style="padding:10px;">Loading...</div>',error:'<div style="padding:10px;">There was an error loading the image.</div>',name:"",next:"<span>&#x25B6;</span>",prev:"<span>&#x25C0;</span>"}},window.PopBox=v}(jQuery);