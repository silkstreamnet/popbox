!function(a){function b(a,b){return void 0!==a?a:b}function c(a,c){return c=b(c,!1),!isNaN(a-0)&&null!=a&&""!=a&&(!c||a>0)}function d(a,c){return c=b(c,!1),"string"==typeof a&&null!=a&&(!c||""!=a)}function e(a,b){var c=a.attr(b);return void 0!==c&&!1!==c&&""!==c||(c=""),c}function f(a,b,c){if(c=c||!1,b instanceof Array)for(var d=0;d<b.length;d++)if(c){if(b[d]===a)return d}else if(b[d]==a)return d;return-1}function g(a,b){var c=e(a,"style");if(b&&c){var d=new RegExp("(^|;)\\s*"+RegExp.escape(b)+"\\s*:");if(c.match(d))return a.css(b)}return""}function h(b,c){if(b.properties.animating)switch(b.properties.animating=!1,c){case"close":b.container.remove(),b.container=!1,b.properties.isopen=!1,b.popup=!1,b.shadow=!1,a("html").css({overflow:b.properties.stored_styles.htmlOverflow,height:b.properties.stored_styles.htmlHeight,"margin-right":b.properties.stored_styles.htmlMarginRight});break;case"open":b.properties.isopen=!0}}function i(a){a=b(a,!1);var c=!0;if(a&&a.popup){var d=a.properties.loaded_images;if(d.length)for(var e=0;e<d.length;e++){var f=d[e];f.complete||4===f.readyState||"complete"===f.readyState||(c=!1)}else d=a.popup.find("img"),d.length>0&&d.each(function(a,b){b.complete||4===b.readyState||"complete"===b.readyState||(c=!1)})}return c&&k(a),c}function j(c){if((c=b(c,!1))&&c.popup){c.properties.loaded_images=[];var e=c.popup.find("img");if(e.length>0){"gallery"==c.settings.mode&&(c.content_area.hide(),c.gallery_loading_area&&c.gallery_loading_area.show(),c.properties.gallery.isloading=!0);var f=0;e.each(function(b,e){if(e.complete||4===e.readyState||"complete"===e.readyState)f++;else if(e.src){var g=new Image;void 0!==g.onload?g.onload=function(){i(c)||setTimeout(function(){i(c)},10)}:void 0!==g.onreadystatechange&&(g.onreadystatechange=function(){i(c)||setTimeout(function(){i(c)},10)}),"gallery"==c.settings.mode&&c.gallery_loading_area&&void 0!==g.onerror&&(g.onerror=function(){var b=d(c.settings.gallery.error,!0)?c.settings.gallery.error:c.defaultSettings.gallery.error;c.gallery_loading_area.html(b),c.properties.gallery.isloading=!0,a(e).remove(),s(c),c.properties.newopen=!1}),g.src=e.src,c.properties.loaded_images.push(g)}}),e.length==f&&k(c)}else k(c)}}function k(a){"gallery"==a.settings.mode&&(a.content_area.show(),a.gallery_loading_area&&a.gallery_loading_area.hide(),a.properties.gallery.isloading=!1),s(a),a.properties.newopen=!1}function l(a){a.properties.loaded_content!==a.settings.content&&(j(a),a.properties.loaded_content=a.settings.content)}function m(a){a.popup.find("img").css({"max-width":"100%",height:"auto"}).filter(":visible").css({display:"block"}),a.popup.find("iframe").css({"max-height":"100%","max-width":"100%"})}function n(a){a&&a.popup&&(a.properties.gallery.isloading=!0,a.update({content:'<img src="'+a.properties.gallery.images[a.properties.gallery.position]+'" style="display:none;" />'}))}function o(a){if(a&&a.popup){a.popup.append('<a href="#" class="popbox-gallery-next">&nbsp;'+a.settings.gallery.next+"</a>"),a.gallery_next=a.popup.find(".popbox-gallery-next"),a.popup.append('<a href="#" class="popbox-gallery-prev">'+a.settings.gallery.prev+"&nbsp;</a>"),a.gallery_prev=a.popup.find(".popbox-gallery-prev");var b=!1,c=!1;a.gallery_next.click(function(b){b.preventDefault(),a.properties.gallery.position++,a.properties.gallery.position>=a.properties.gallery.images.length&&(a.properties.gallery.position=0),n(a)}).mousemove(function(c){b||(a.gallery_next.addClass("popbox-btn-hover"),b=!0,setTimeout(function(){b=!1},200))}).mouseleave(function(b){a.gallery_next.removeClass("popbox-btn-hover")}),a.gallery_prev.click(function(b){b.preventDefault(),a.properties.gallery.position--,a.properties.gallery.position<0&&(a.properties.gallery.position=a.properties.gallery.images.length-1),n(a)}).mousemove(function(b){c||(a.gallery_prev.addClass("popbox-btn-hover"),c=!0,setTimeout(function(){c=!1},200))}).mouseleave(function(b){a.gallery_prev.removeClass("popbox-btn-hover")})}}function p(b){var c=a("body"),d=b.container.clone().stop(!0,!0).addClass("popbox-rsc-clone").css({display:"block",visibility:"hidden","z-index":"-1",overflow:"hidden"});d.find("iframe").attr("src",""),d.appendTo(c);var e=c.find(".popbox-rsc-clone");return{container:e,popup:e.find(".popbox-popup").eq(0),content:e.find(".popbox-content").eq(0),gallery_loading_area:e.find(".popbox-gallery-loading").eq(0)}}function q(a){a&&a.container&&a.container.remove()}function r(a){a&&a.popup&&("gallery"!=a.settings.mode||a.properties.gallery.isloading||a.content_area.find("img:hidden").fadeIn(300),a.popup.find(".popbox-btn-hover").removeClass("popbox-btn-hover"))}function s(a){if((a=b(a,!1))&&a.popup){var d=a.settings,e=a.popup,f=a.container,g=a.content_area,h=a.shadow,i=a.gallery_loading_area;e.stop(!0,!1),f.css("overflow-y","hidden"),m(a);var j=0,k=0,l=0,n=0,o=0,s=0,t=0,u=0,v=h.width(),w=f.outerHeight(!1),x=0,y=0,z=0,A=!1,B=!1;if(d.autoScale&&!a.properties.gallery.isloading)if(g.css({height:"100%",width:"100%",overflow:"hidden"}),B=p(a),B.popup.css({height:"auto",width:"auto",top:"auto",left:"auto"}),B.content.attr("style",""),B.content.find("img").css({"max-width":"none",height:"auto",display:"block"}),B.content.find("iframe").css({"max-height":"none","max-width":"none"}),o=B.popup.width(),s=B.popup.height(),t=B.popup.outerWidth(!1)-o,u=B.popup.outerHeight(!1)-s,q(B),x=.8*v-t,y=.8*w-u,x>d.maxwidth&&(x=d.maxwidth),y>d.maxheight&&(y=d.maxheight),s>y||o>x){var C=y/x,D=s/o,E=1;D>C?(E=y/s,k=y,j=o*E):(E=x/o,j=x,k=s*E)}else j=o,k=s;else{x=.8*v,y=.8*w,t=e.outerWidth(!1)-e.width(),u=e.outerHeight(!1)-e.height(),j=x-t,k=y-u,B=p(a),B.popup.css({height:"auto",width:"auto",top:"0",left:"0"}),B.content.attr("style",""),B.gallery_loading_area.attr("style","");var F=g,G=B.content;a.properties.gallery.isloading?(B.content.css("display","none"),B.gallery_loading_area.css("display","block"),F=i,G=B.gallery_loading_area):(B.content.css("display","block"),B.gallery_loading_area.css("display","none")),c(d.width)?j=d.width:(d.scaleToContent||a.properties.gallery.isloading)&&B.popup.width()<j&&(j=B.popup.width()),c(d.maxwidth)&&j>d.maxwidth&&(j=d.maxwidth),B.popup.css({width:j}),c(d.height)?k=d.height:d.innerOverflow||(k=B.popup.height()),c(d.maxheight)&&k>d.maxheight&&(k=d.maxheight),0==parseInt(G.css("margin-top"))&&G.css({"margin-top":"-1px",top:"1px"});var H=G.outerHeight(!0),I=H-G.height(),J=parseInt(B.popup.css("padding-top")),K=parseInt(B.popup.css("border-top-width")),L=parseInt(B.popup.css("margin-top"));isNaN(J)&&(J=0),isNaN(K)&&(K=0),isNaN(L)&&(L=0);var M=J+K+L,N=k-(G.position().top-M);!a.properties.newopen&&d.animateSpeed>0?F.stop(!0,!1).height(F.height()).animate({height:N-I},d.animateSpeed):F.stop(!0,!1).css({height:N-I}),H>N&&d.innerOverflow&&F.css("overflow-y","scroll"),q(B),z=.05*w,y=.9*w,n=k+u,n>y?(A=z,f.css("overflow-y","scroll"),a.bottom_push.css({top:z+n+"px",height:z+"px",width:"1px"}),a.shadow.css({height:2*z+n+"px"})):(a.bottom_push.css({top:"0px",height:"0px",width:"0px"}),a.shadow.css({height:"100%"}))}l=j+t,n=k+u;var O=(v-l)/2,P=(w-n)/2;!1!==A&&(P=A),!a.properties.newopen&&d.animateSpeed>0?e.animate({left:O,top:P,width:j,height:k},d.animateSpeed,function(){r(a)}).css("overflow",""):(e.css({left:O,top:P,width:j,height:k}),r(a))}}null!=RegExp&&null==RegExp.escape&&(RegExp.escape=function(a){return a.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")});var t=function(c){c=b(c,{}),"gallery"==c.mode&&null==c.autoScale&&(c.autoScale=!0),this.settings=a.extend(!0,{},this.defaultSettings,c),this.container=!1,this.popup=!1,this.shadow=!1,this.properties={animating:!1,isopen:!1,newopen:!0,newopentime:0,resizepause:!1,loaded_content:-1,loaded_images:[],stored_styles:{htmlOverflow:"",htmlHeight:"",htmlMarginRight:""},gallery:{isloading:!1,images:[],position:0}}};t.prototype.adjust=function(a){a=b(a,!1);var c=this;if(c.properties.isopen&&(a||!c.properties.resizepause)){var d=1;c.properties.newopen||(c.properties.gallery.isloading?d=100:a||(d=c.settings.updatePositionDelay)),c.properties.resizepause=!0,setTimeout(function(){s(c),c.properties.resizepause=!1},d),l(c)}},t.prototype.refresh=function(){this.properties.loaded_content=-1,this.properties.loaded_images=[]},t.prototype.close=function(){var b=this;!b.properties.animating&&b.properties.isopen&&("function"==typeof b.settings.onClose&&b.settings.onClose(b),b.properties.animating=!0,b.container.fadeOut(b.settings.fadeOutSpeed,function(){h(b,"close")}),a(window).off("resize.popbox.adjust"),a(document).off("touchstart.popbox touchend.popbox"),b.properties.isopen=!1,b.refresh(),"gallery"==b.settings.mode&&b.update({content:""},!1),"function"==typeof b.settings.afterClose&&b.settings.afterClose(b))},t.prototype.open=function(){var b=this;if(b.refresh(),!b.properties.animating&&!b.properties.isopen){"function"==typeof b.settings.onOpen&&b.settings.onOpen(b),b.properties.animating=!0;var c=d(this.settings.close,!0)?b.settings.close:b.defaultSettings.close,i=d(this.settings.content,!0)?b.settings.content:"",j=d(this.settings.title,!0)?'<div class="popbox-title">'+b.settings.title+"</div>":"",k=d(this.settings.customClass,!0)?" "+b.settings.customClass:"",l=a("html"),m=a("body");b.properties.stored_styles.htmlOverflow=g(l,"overflow"),b.properties.stored_styles.htmlHeight=g(l,"height"),b.properties.stored_styles.htmlMarginRight=g(l,"margin-right");var n=m.width();l.css({overflow:"hidden",height:"100%"});var p=m.width();if(p>n&&l.css({"margin-right":p-n+"px"}),m.append('<div class="popbox-container'+k+'" style="display: none;"><div class="popbox-bottom-push"></div><a class="popbox-shadow" href="javascript:void(0);"></a><div class="popbox-popup">'+j+'<div class="popbox-content">'+i+'</div><a href="#" class="popbox-close">'+c+"</a></div></div>"),b.container=a(".popbox-container"),b.popup=b.container.find(".popbox-popup"),b.shadow=b.container.find(".popbox-shadow"),b.bottom_push=b.container.find(".popbox-bottom-push"),b.close_button=b.container.find(".popbox-close"),b.title_area=b.container.find(".popbox-title"),b.content_area=b.container.find(".popbox-content"),b.gallery_loading_area=!1,b.container.css({display:"none",height:"100%",width:"100%",position:"fixed",left:"0px",top:"0px","z-index":"990","background-color":"rgba(0,0,0,0.4)","overflow-x":"hidden"}),b.bottom_push.css({display:"block",position:"absolute",left:"0px",top:"0px",height:"0px",width:"1px","z-index":"992"}),b.popup.css({display:"block",position:"absolute",top:"0px",left:"0px","z-index":"993","-webkit-box-sizing":"content-box","-moz-box-sizing":"content-box","box-sizing":"content-box"}),b.shadow.css({display:"block",position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%","z-index":"991",background:"#fff",opacity:"0",cursor:"default"}),b.content_area.css({overflow:"hidden",height:"auto"}),"gallery"==b.settings.mode){b.content_area.hide();var q=d(this.settings.gallery.loading,!0)?b.settings.gallery.loading:b.defaultSettings.gallery.loading;if(b.content_area.after('<div class="popbox-gallery-loading">'+q+"</div>"),b.gallery_loading_area=b.container.find(".popbox-gallery-loading"),b.gallery_loading_area.css({overflow:"hidden",height:"auto"}),b.settings.gallery.name){var r=a("."+b.settings.gallery.name);if(r.length&&(r.each(function(){var c=a(this);if(0==c.closest(".popbox-container").length){var d=e(c,"src"),g=e(c,"href"),h=d||g;h&&-1==f(h,b.properties.gallery.images)&&b.properties.gallery.images.push(h)}}),b.properties.gallery.images.length>0)){var s="",t=b.content_area.find("img:first");t.length&&(s=e(t.eq(0),"src"));var u=f(s,b.properties.gallery.images);b.properties.gallery.position=0,""==s||-1==u?b.properties.gallery.images.unshift(s):u>-1&&(b.properties.gallery.position=u),o(b)}}}b.container.fadeIn(b.settings.fadeInSpeed,function(){h(b,"open")}),b.shadow.click(function(a){b.close(),a.preventDefault()}),b.close_button.click(function(a){b.close(),a.preventDefault()}),a(window).on("resize.popbox.adjust",function(){b.adjust()}),b.properties.isopen=!0,b.properties.newopen=!0,b.properties.newopentime=(new Date).getTime(),b.adjust(),"function"==typeof b.settings.afterOpen&&b.settings.afterOpen(b)}},t.prototype.update=function(c,e){var f=this;if(c=b(c,{}),e=b(e,!0),f.settings=a.extend({},f.settings,c),f.properties.isopen){var g=d(f.settings.close,!0)?f.settings.close:f.defaultSettings.close,h=d(f.settings.content,!0)?f.settings.content:"",i=d(f.settings.title,!0)?f.settings.title:"";f.close_button.length>0&&f.close_button.html(g),f.content_area.length>0&&f.content_area.html(h),f.title_area.length>0?""!=i?f.title_area.html(i):(f.title_area.remove(),f.title_area=f.popup.find(".popbox-title")):""!=i&&(f.popup.prepend('<div class="popbox-title">'+i+"</div>"),f.title_area=f.popup.find(".popbox-title")),e?f.adjust(!0):m(f)}},t.prototype.isOpen=function(){return 1==this.properties.isopen},t.prototype.isClose=function(){return 0==this.properties.isopen},t.prototype.defaultSettings={width:"auto",height:"auto",maxwidth:"none",maxheight:"none",innerOverflow:!1,scaleToContent:!1,content:"",close:"X",title:"",onOpen:!1,onClose:!1,afterOpen:!1,afterClose:!1,fadeInSpeed:400,fadeOutSpeed:400,updatePositionDelay:200,autoScale:!1,customClass:"",animateSpeed:400,mode:"normal",gallery:{loading:'<div style="padding:10px;">Loading...</div>',error:'<div style="padding:10px;">There was an error loading the image.</div>',name:"",next:"<span>&#x25B6;</span>",prev:"<span>&#x25C0;</span>"}},window.PopBox=t}(jQuery);