!function(a){function b(a,b){return void 0!==a?a:b}function c(a,c){return c=b(c,!1),!isNaN(a-0)&&null!=a&&""!=a&&(!c||a>0)}function d(a,c){return c=b(c,!1),"string"==typeof a&&null!=a&&(!c||""!=a)}function e(a,b){var c=a.attr(b);return void 0!==c&&!1!==c&&""!==c||(c=""),c}function f(a,b){var c=e(a,"style");if(b&&c){var d=new RegExp("(^|;)\\s*"+RegExp.escape(b)+"\\s*:");if(c.match(d))return a.css(b)}return""}function g(b,c){if(b.properties.animating)switch(b.properties.animating=!1,c){case"close":b.container.remove(),b.container=!1,b.properties.isopen=!1,b.popup=!1,b.shadow=!1,a("html").css({overflow:b.properties.bodyOverflow,"margin-right":b.properties.bodyMarginRight}),a(document).off("scroll.popbox touchmove.popbox mousewheel.popbox");break;case"open":b.properties.isopen=!0}}function h(a){a=b(a,!1);var c=!0;if(a&&a.popup){var d=a.popup.find("img");d.length>0&&d.each(function(a,b){b.complete||4===b.readyState||"complete"===b.readyState||(c=!1)})}return"gallery"==a.settings.mode&&(c?(a.content_area.show(),a.gallery_loading_area&&a.gallery_loading_area.hide(),a.properties.gallery.isloading=!1):(a.content_area.hide(),a.gallery_loading_area&&a.gallery_loading_area.show(),a.properties.gallery.isloading=!0)),c&&(n(a),a.properties.newopen=!1),c}function i(c){if((c=b(c,!1))&&c.popup){var e=c.popup.find("img");if(e.length>0){var f=0;e.each(function(b,e){e.complete||4===e.readyState||"complete"===e.readyState?f++:(void 0!==e.onload?e.onload=function(){void 0!==e.readyState?setTimeout(function(){h(c)},10):h(c)}:void 0!==e.onreadystatechange&&(e.onreadystatechange=function(){setTimeout(function(){h(c)},10)}),"gallery"==c.settings.mode&&c.gallery_loading_area&&void 0!==e.onerror&&(e.onerror=function(){var b=d(c.settings.gallery.error,!0)?c.settings.gallery.error:c.defaultSettings.gallery.error;c.gallery_loading_area.html(b),c.properties.gallery.isloading=!0,a(e).remove(),c.adjust()}))}),e.length==f&&h(c)}}}function j(a){a.properties.loaded_content!==a.settings.content&&(h(a)||i(a),a.properties.loaded_content=a.settings.content)}function k(a){a.popup.find("img").css({"max-width":"100%",height:"auto",display:"block"}),a.popup.find("iframe").css({"max-height":"100%","max-width":"100%"})}function l(b){var c=a("body"),d=b.container.clone().stop(!0,!0).addClass("popbox-rsc-clone").css({display:"block",visibility:"hidden","z-index":"-1",overflow:"hidden"});d.find("iframe").attr("src",""),d.appendTo(c);var e=c.find(".popbox-rsc-clone");return{container:e,popup:e.find(".popbox-popup").eq(0),content:e.find(".popbox-content").eq(0),gallery_loading_area:e.find(".popbox-gallery-loading").eq(0)}}function m(a){a&&a.container&&a.container.remove()}function n(a){if((a=b(a,!1))&&a.popup){var d=a.settings,e=a.popup,f=a.container,g=a.content_area,h=a.gallery_loading_area;e.stop(!0,!1);var i=0,j=0,n=0,o=0,p=0,q=0,r=0,s=0,t=f.outerWidth(!1),u=f.outerHeight(!1),v=0,w=0,x=0,y=!1,z=!1;if(k(a),d.autoScale&&!a.properties.gallery.isloading)if(g.css({height:"100%",width:"100%",overflow:"hidden"}),z=l(a),z.popup.css({height:"auto",width:"auto",top:"auto",left:"auto"}),z.content.attr("style",""),z.content.find("img").css({"max-width":"none",height:"auto",display:"block"}),z.content.find("iframe").css({"max-height":"none","max-width":"none"}),p=z.popup.width(),q=z.popup.height(),r=z.popup.outerWidth(!1)-p,s=z.popup.outerHeight(!1)-q,m(z),v=.8*t-r,w=.8*u-s,v>d.maxwidth&&(v=d.maxwidth),w>d.maxheight&&(w=d.maxheight),q>w||p>v){var A=w/v,B=q/p,C=1;B>A?(C=w/q,j=w,i=p*C):(C=v/p,i=v,j=q*C)}else i=p,j=q;else{v=.8*t,w=.8*u,r=e.outerWidth(!1)-e.width(),s=e.outerHeight(!1)-e.height(),i=v-r,j=w-s,z=l(a),z.popup.css({height:"auto",width:"auto",top:"0",left:"0"}),z.content.attr("style",""),z.gallery_loading_area.attr("style","");var D=g,E=z.content;a.properties.gallery.isloading?(z.content.css("display","none"),z.gallery_loading_area.css("display","block"),D=h,E=z.gallery_loading_area):(z.content.css("display","block"),z.gallery_loading_area.css("display","none")),c(d.width)?i=d.width:d.scaleToContent&&z.popup.width()<i&&(i=z.popup.width()),c(d.maxwidth)&&i>d.maxwidth&&(i=d.maxwidth),z.popup.css({width:i}),c(d.height)?j=d.height:d.innerOverflow||(j=z.popup.height()),c(d.maxheight)&&j>d.maxheight&&(j=d.maxheight),0==parseInt(E.css("margin-top"))&&E.css({"margin-top":"-1px",top:"1px"});var F=E.outerHeight(!0),G=F-E.height(),H=parseInt(z.popup.css("padding-top")),I=parseInt(z.popup.css("border-top-width")),J=parseInt(z.popup.css("margin-top"));isNaN(H)&&(H=0),isNaN(I)&&(I=0),isNaN(J)&&(J=0);var K=H+I+J,L=j-(E.position().top-K);!a.properties.newopen&&d.animateSpeed>0?D.stop(!0,!1).height(D.height()).animate({height:L-G},d.animateSpeed):D.stop(!0,!1).css({height:L-G}),F>L&&d.innerOverflow&&D.css("overflow-y","scroll"),m(z),x=.05*u,w=.9*u,o=j+s,o>w?(y=x,f.css("overflow","auto"),a.bottom_push.css({top:x+o+"px",height:x+"px",width:"1px"}),a.shadow.css({height:2*x+o+"px"})):(f.css("overflow",""),a.bottom_push.css({top:"0px",height:"0px",width:"0px"}),a.shadow.css({height:"100%"}))}n=i+r,o=j+s;var M=(t-n)/2,N=(u-o)/2;!1!==y&&(N=y),!a.properties.newopen&&d.animateSpeed>0?e.animate({left:M,top:N,width:i,height:j},d.animateSpeed).css("overflow",""):e.css({left:M,top:N,width:i,height:j})}}null!=RegExp&&null==RegExp.escape&&(RegExp.escape=function(a){return a.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")});var o=function(c){c=b(c,{}),"gallery"==c.mode&&null==c.autoScale&&(c.autoScale=!0),this.settings=a.extend({},this.defaultSettings,c),this.container=!1,this.popup=!1,this.shadow=!1,this.properties={animating:!1,isopen:!1,newopen:!0,newopentime:0,resizepause:!1,loaded_content:-1,bodyMarginRight:"",bodyOverflow:"",gallery:{isloading:!1}}};o.prototype.adjust=function(){var a=this;!a.properties.resizepause&&a.properties.isopen&&(a.properties.resizepause=!0,setTimeout(function(){n(a),a.properties.resizepause=!1},a.properties.updatePositionDelay),j(a))},o.prototype.checkImages=function(){this.properties.loaded_content=-1},o.prototype.close=function(){var b=this;!b.properties.animating&&b.properties.isopen&&("function"==typeof b.settings.onClose&&b.settings.onClose(b),b.properties.animating=!0,b.container.fadeOut(b.settings.fadeOutSpeed,function(){g(b,"close")}),a(window).off("resize.popbox.adjust,scroll.popbox.adjust"),b.properties.isopen=!1,b.checkImages(),"function"==typeof b.settings.afterClose&&b.settings.afterClose(b))},o.prototype.open=function(){var b=this;if(!b.properties.animating&&!b.properties.isopen){"function"==typeof b.settings.onOpen&&b.settings.onOpen(b),b.properties.animating=!0;var c=d(this.settings.close,!0)?b.settings.close:b.defaultSettings.close,e=d(this.settings.content,!0)?b.settings.content:"",h=d(this.settings.title,!0)?'<div class="popbox-title">'+b.settings.title+"</div>":"",i=d(this.settings.customClass,!0)?" "+b.settings.customClass:"",j=a("html"),k=a("body");b.properties.bodyOverflow=f(j,"overflow");var l=j.width();j.css("overflow","hidden");var m=j.width();if(m>l){var n=j.css("margin-right");b.properties.bodyMarginRight=f(j,"margin-right");var o=parseInt(n),p=o+(m-l);j.css("margin-right",p+"px")}if(a(document).on("scroll.popbox touchmove.popbox mousewheel.popbox",function(a){}),k.append('<div class="popbox-container'+i+'" style="display: none;"><div class="popbox-bottom-push"></div><a class="popbox-shadow" href="javascript:void(0);"></a><div class="popbox-popup">'+h+'<a class="popbox-close">'+c+'</a><div class="popbox-content">'+e+"</div></div></div>"),b.container=a(".popbox-container"),b.popup=b.container.find(".popbox-popup"),b.shadow=b.container.find(".popbox-shadow"),b.bottom_push=b.container.find(".popbox-bottom-push"),b.close_button=b.container.find(".popbox-close"),b.title_area=b.container.find(".popbox-title"),b.content_area=b.container.find(".popbox-content"),b.gallery_loading_area=!1,b.container.css({display:"none",height:"100%",width:"100%",position:"fixed",left:"0px",top:"0px","z-index":"990","background-color":"rgba(0,0,0,0.4)"}),b.bottom_push.css({display:"block",position:"absolute",left:"0px",top:"0px",height:"0px",width:"1px","z-index":"992"}),b.popup.css({display:"block",position:"absolute",top:"0px",left:"0px","z-index":"993","-webkit-box-sizing":"content-box","-moz-box-sizing":"content-box","box-sizing":"content-box"}),b.shadow.css({display:"block",position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%","z-index":"991",background:"#fff",opacity:"0",cursor:"default"}),b.content_area.css({overflow:"hidden",height:"auto"}),"gallery"==b.settings.mode){b.content_area.hide();var q=d(this.settings.gallery.loading,!0)?b.settings.gallery.loading:b.defaultSettings.gallery.loading;b.content_area.after('<div class="popbox-gallery-loading">'+q+"</div>"),b.gallery_loading_area=b.container.find(".popbox-gallery-loading"),b.gallery_loading_area.css({overflow:"hidden",height:"auto"})}b.container.fadeIn(b.settings.fadeInSpeed,function(){g(b,"open")}),b.shadow.click(function(a){b.close(),a.preventDefault()}),b.close_button.click(function(a){b.close(),a.preventDefault()}),a(window).on("resize.popbox.adjust,scroll.popbox.adjust",function(){b.adjust()}),b.properties.isopen=!0,b.properties.newopen=!0,b.properties.newopentime=(new Date).getTime(),b.adjust(),"function"==typeof b.settings.afterOpen&&b.settings.afterOpen(b)}},o.prototype.update=function(c,e){var f=this;if(c=b(c,{}),e=b(e,!0),f.settings=a.extend({},f.settings,c),f.properties.isopen){var g=d(f.settings.close,!0)?f.settings.close:f.defaultSettings.close,h=d(f.settings.content,!0)?f.settings.content:"",i=d(f.settings.title,!0)?f.settings.title:"";f.close_button.length>0&&f.close_button.html(g),f.content_area.length>0&&f.content_area.html(h),f.title_area.length>0?""!=i?f.title_area.html(i):(f.title_area.remove(),f.title_area=f.popup.find(".popbox-title")):""!=i&&(f.popup.prepend('<div class="popbox-title">'+i+"</div>"),f.title_area=f.popup.find(".popbox-title")),e?f.adjust():k(f)}},o.prototype.isOpen=function(){return 1==this.properties.isopen},o.prototype.isClose=function(){return 0==this.properties.isopen},o.prototype.defaultSettings={width:"auto",height:"auto",maxwidth:"none",maxheight:"none",innerOverflow:!1,scaleToContent:!1,content:"",close:"X",title:"",onOpen:!1,onClose:!1,afterOpen:!1,afterClose:!1,fadeInSpeed:400,fadeOutSpeed:400,updatePositionDelay:200,autoScale:!1,customClass:"",animateSpeed:400,mode:"normal",gallery:{loading:"Loading",error:"Error"}},window.PopBox=o}(jQuery);