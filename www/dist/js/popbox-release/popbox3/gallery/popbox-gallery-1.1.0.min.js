!function(a,b){!function(){for(var b="3.0.8".split("."),c=0,d=a.Popbox.prototype.version.split(".").length;c<d;c++)if(a.Popbox.prototype.version.split(".")[c]<b[c])return void console.log("Error: Popbox "+b.join(".")+"+ required.")}();var c=function(){},d=a.Popbox.prototype._static,e={gallery:{selector:"",clickable:!0,error:'<div class="popbox-gallery-error">There was an error loading the image.</div>',next:"<span>&#x25B6;</span>",prev:"<span>&#x25C0;</span>",items:[]}};d._gallery_event_namespace="PopboxGallery",a.extend(!0,a.Popbox.prototype.default_settings,e),c.prototype.attachSwipeEvents=function(){var b=this.self,c=this.self.popbox;if(c.elements.$popbox){var e=d._gallery_event_namespace+"Swipe",f=!1,g=!1,h=!1,i=0,j=0,k=0,l=0,m=function(a,b,d,e){return h=!1,g=c.elements.$popbox_popup.find(".popbox-gallery-image"),!!g.length&&(g.data("movement")||g.data("movement",0),i=a,j=b,k=i,l=j,n(a,b,d,e),!0)},n=function(b,e,f,m){k=b,l=e;var n=Math.abs(k-i)-8,p=Math.abs(l-j)-8;if(!h){if(!(n>0&&n>p))return void((n>0||p>0)&&p>n&&o(f,m));h=!0,a("<div/>").css({position:"absolute",top:"0",left:"0",right:"0",bottom:"0","z-index":c.settings.z_index+50}).addClass("popbox-swipe-shield").appendTo(c.elements.$popbox_popup)}d._support.transform3d?g.css("transform","translate3d("+(k-i+g.data("movement"))+"px,0px,0px"):g.css("transform","translate("+(k-i+g.data("movement"))+"px,0px")},o=function(a,j){return f=!1,d.$document.off("touchmove."+e),d.$document.off("touchend."+e),d.$document.off("mousemove."+e),d.$document.off("mouseup."+e),g.data("movement",k-i+g.data("movement")),h&&(a.stopImmediatePropagation(),a.preventDefault(),k>i?b.prev():k<i&&b.next()),c.elements.$popbox_popup.find(".popbox-swipe-shield").remove(),!h};c.elements.$popbox.off("dragstart."+e).on("dragstart."+e,".popbox-popup",function(a){a.preventDefault()}),c.elements.$popbox.off("touchstart."+e).on("touchstart."+e,".popbox-popup",function(a){f=!0,m(a.originalEvent.touches[0].pageX,a.originalEvent.touches[0].pageY,a,"touch")?(d.$document.off("touchmove."+e).on("touchmove."+e,function(a){n(a.originalEvent.touches[0].pageX,a.originalEvent.touches[0].pageY,a,"touch")}),d.$document.off("touchend."+e).on("touchend."+e,function(a){return o(a,"touch")})):f=!1}),c.elements.$popbox.off("mousedown."+e).on("mousedown."+e,".popbox-popup",function(a){f||1!==a.which||m(a.pageX,a.pageY,a,"mouse")&&(d.$document.off("mousemove."+e).on("mousemove."+e,function(a){n(a.pageX,a.pageY,a,"mouse")}),d.$document.off("mouseup."+e).on("mouseup."+e,function(a){if(1===a.which)return o(a,"mouse")}))}),c.elements.$popbox.off("click."+e).on("click."+e,".popbox-popup",function(a){if(h)return a.stopImmediatePropagation(),a.preventDefault(),!1})}},c.prototype.attachNavEvents=function(){var a=this.self,b=this.self.popbox;if(b.elements.$popbox){var c=d._gallery_event_namespace+"Nav";b.elements.$popbox.off("click."+c),b.elements.$popbox.on("click."+c,".popbox-gallery-next",function(b){b.preventDefault(),a.next()}),b.elements.$popbox.on("click."+c,".popbox-gallery-prev",function(b){b.preventDefault(),a.prev()})}};var f=function(a){var b=this;b.popbox=a,b._private=new c,b._private.self=b};f.prototype.refreshItems=function(){var b=this,c=this.popbox;if(d.isArray(c.settings.gallery.items)&&c.settings.gallery.items.length>0)for(var e=0;e<c.settings.gallery.items.length;e++)c.properties.gallery.items.push(c.settings.gallery.items[e]);if(c.settings.gallery.selector){var f=a(c.settings.gallery.selector);f.each(function(){var b=a(this),e=b.data("url"),f=b.attr("href"),g=b.attr("src"),h=!1;e?h=e:f?h=f:g?h=g:(b.find("a[href]").each(function(){var b=a(this).attr("href");b&&!b.match(/^#/)&&d.indexOf(b,c.properties.gallery.items,!0)<0&&c.properties.gallery.items.push(b)}),b.find("img[src]").each(function(){var b=a(this).attr("src");b&&d.indexOf(b,c.properties.gallery.items,!0)<0&&c.properties.gallery.items.push(b)})),h&&d.indexOf(h,c.properties.gallery.items,!0)<0&&c.properties.gallery.items.push(h)}),c.settings.gallery.clickable&&f.off("click.popbox_gallery_open").on("click.popbox_gallery_open",function(e){e.preventDefault();var f=a(this),g=f.data("url"),h=f.attr("href"),i=f.attr("src");if(b.refreshItems(),g)b.goTo(d.indexOf(g,c.properties.gallery.items,!0));else if(h)b.goTo(d.indexOf(h,c.properties.gallery.items,!0));else if(i)b.goTo(d.indexOf(i,c.properties.gallery.items,!0));else{var j=f.find("a[href]:first").attr("href"),k=f.find("img[src]:first").attr("src");j&&!j.match(/^#/)?b.goTo(d.indexOf(j,c.properties.gallery.items,!0)):k&&b.goTo(d.indexOf(k,c.properties.gallery.items,!0))}c.open()})}},f.prototype.addItem=function(a){this.addItems([a])},f.prototype.removeItem=function(a){this.removeItems([a])},f.prototype.addItems=function(a){var b=this.popbox;if(a){d.isArray(b.settings.gallery.items)||(b.settings.gallery.items=[]),d.isArray(a)||(a=[a]);for(var c=0;c<a.length;c++)b.settings.gallery.items.push(a[c])}},f.prototype.removeItems=function(a){var b=this.popbox;if(a&&d.isArray(b.settings.gallery.items)){d.isArray(a)||(a=[a]);for(var c=0;c<a.length;c++){var e=d.indexOf(a[c],b.settings.gallery.items);e>=0&&b.settings.gallery.items.splice(e,1)}}},f.prototype.goTo=function(a){var b=this.popbox;a=d.isNumber(a)?a:b.properties.gallery.current_index,b.properties.gallery.items.length>0&&(a>b.properties.gallery.items.length-1?a=0:a<0&&(a=b.properties.gallery.items.length>0?b.properties.gallery.items.length-1:0),b.properties.gallery.current_index=a,b.update({content:'<div class="popbox-gallery-container" style="overflow:hidden;"><div class="popbox-gallery-image"><img src="'+b.properties.gallery.items[b.properties.gallery.current_index]+'" /></div></div>'},!0))},f.prototype.next=function(){var a=this,b=this.popbox;a.goTo(b.properties.gallery.current_index+1)},f.prototype.prev=function(){var a=this,b=this.popbox;a.goTo(b.properties.gallery.current_index-1)},a.Popbox.prototype.gallery=f,d.addHook("initialize",function(){var a=this;a.gallery=new f(a)}),d.addHook("after_initialize",function(a){var b=this.gallery,c=this;"gallery"===c.settings.mode&&(a&&!d.isSet(a.aspect_fit)&&(c.settings.aspect_fit=!0),b.refreshItems())}),d.addHook("after_reset",function(){this.properties.gallery={items:[],current_index:0}}),d.addHook("after_create",function(){var a=this.gallery;"gallery"===this.settings.mode&&(a._private.attachSwipeEvents(),a._private.attachNavEvents())}),d.addHook("open",function(){var b=this.gallery,c=this;if("gallery"===c.settings.mode){b.refreshItems();var e=a("<div/>").html(c.settings.content).find("img[src]"),f=0;e.length&&(f=d.indexOf(e.attr("src"),c.properties.gallery.items,!0)),b.goTo(f)}}),d.addHook("image_error",function(a){var b=this;"gallery"===b.settings.mode&&(b.update({content:b.settings.gallery.error},!1),b.properties.image_cache[a]&&delete b.properties.image_cache[a])}),d.addHook("after_update",function(){var a=this.gallery,b=this;b.isOpen()||(b.properties.gallery.items=[],b.properties.gallery.current_index=0),"gallery"===b.settings.mode&&(a.refreshItems(),a.goTo())}),d.addHook("after_update_dom",function(){var b=this,c=!1;"gallery"===b.settings.mode&&(b.elements.$popbox.addClass("popbox-gallery"),b.properties.gallery.items.length>1&&(b.elements.$popbox_gallery_next||(b.elements.$popbox_gallery_next=a("<a/>",{class:"popbox-gallery-next",href:"javascript:void(0);"}).html(b.settings.gallery.next).appendTo(b.elements.$popbox_container)),b.elements.$popbox_gallery_prev||(b.elements.$popbox_gallery_prev=a("<a/>",{class:"popbox-gallery-prev",href:"javascript:void(0);"}).html(b.settings.gallery.prev).appendTo(b.elements.$popbox_container)),c=!0)),c||(b.elements.$popbox_gallery_next&&b.elements.$popbox_gallery_next.remove(),b.elements.$popbox_gallery_prev&&b.elements.$popbox_gallery_prev.remove(),b.elements.$popbox_gallery_next=!1,b.elements.$popbox_gallery_prev=!1)}),a.Popbox.prototype.plugins.gallery="1.1.0"}(jQuery,window);